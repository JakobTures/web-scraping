<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Transformation with dplyr | Web Scraping using R</title>
  <meta name="description" content="11 Transformation with dplyr | Web Scraping using R" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Transformation with dplyr | Web Scraping using R" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="jakobtures.github.io/web-scraping/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Transformation with dplyr | Web Scraping using R" />
  
  
  

<meta name="author" content="Jakob Tures" />


<meta name="date" content="2025-03-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="scraping.html"/>
<link rel="next" href="ggplot.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/echarts4r-4.8.0/echarts-en.min.js"></script>
<script src="libs/echarts4r-4.8.0/ecStat.min.js"></script>
<script src="libs/echarts4r-4.8.0/dataTool.min.js"></script>
<script src="libs/echarts4r-binding-0.4.5/echarts4r.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
Web Scraping using R

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-web-scraping"><i class="fa fa-check"></i>What is web scraping?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-contents"><i class="fa fa-check"></i>Course contents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#technical-requirements"><i class="fa fa-check"></i>Technical requirements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul></li>
<li class="part"><span><b>I R Basics, tidyverse &amp; R Markdown</b></span></li>
<li class="chapter" data-level="1" data-path="R1.html"><a href="R1.html"><i class="fa fa-check"></i><b>1</b> R &amp; R Studio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="R1.html"><a href="R1.html#installing-r"><i class="fa fa-check"></i><b>1.1</b> Installing R</a></li>
<li class="chapter" data-level="1.2" data-path="R1.html"><a href="R1.html#rstudio"><i class="fa fa-check"></i><b>1.2</b> RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="R1.html"><a href="R1.html#overview"><i class="fa fa-check"></i><b>1.2.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="R1.html"><a href="R1.html#hello-world"><i class="fa fa-check"></i><b>1.3</b> Hello World!</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="R1.html"><a href="R1.html#calculating-with-r"><i class="fa fa-check"></i><b>1.3.1</b> Calculating with R</a></li>
<li class="chapter" data-level="1.3.2" data-path="R1.html"><a href="R1.html#comparison"><i class="fa fa-check"></i><b>1.3.2</b> Comparison operators</a></li>
<li class="chapter" data-level="1.3.3" data-path="R1.html"><a href="R1.html#logical-operators"><i class="fa fa-check"></i><b>1.3.3</b> Logical operators</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="R1.html"><a href="R1.html#objects"><i class="fa fa-check"></i><b>1.4</b> Objects</a></li>
<li class="chapter" data-level="1.5" data-path="R1.html"><a href="R1.html#vectors"><i class="fa fa-check"></i><b>1.5</b> Vectors</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="R1.html"><a href="R1.html#subsetting"><i class="fa fa-check"></i><b>1.5.1</b> Subsetting</a></li>
<li class="chapter" data-level="1.5.2" data-path="R1.html"><a href="R1.html#types-of-vectors"><i class="fa fa-check"></i><b>1.5.2</b> Types of vectors</a></li>
<li class="chapter" data-level="1.5.3" data-path="R1.html"><a href="R1.html#a-brief-look-at-lists"><i class="fa fa-check"></i><b>1.5.3</b> A brief look at lists</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="R1.html"><a href="R1.html#functions"><i class="fa fa-check"></i><b>1.6</b> Functions</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="R1.html"><a href="R1.html#help"><i class="fa fa-check"></i><b>1.6.1</b> Help</a></li>
<li class="chapter" data-level="1.6.2" data-path="R1.html"><a href="R1.html#examples-basic-statistical-functions"><i class="fa fa-check"></i><b>1.6.2</b> Examples: Basic statistical functions</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="R1.html"><a href="R1.html#rstudio-workflow"><i class="fa fa-check"></i><b>1.7</b> RStudio Workflow</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="R1.html"><a href="R1.html#r-scripts"><i class="fa fa-check"></i><b>1.7.1</b> R Scripts</a></li>
<li class="chapter" data-level="1.7.2" data-path="R1.html"><a href="R1.html#projects"><i class="fa fa-check"></i><b>1.7.2</b> Projects</a></li>
<li class="chapter" data-level="1.7.3" data-path="R1.html"><a href="R1.html#comments"><i class="fa fa-check"></i><b>1.7.3</b> Comments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="R2.html"><a href="R2.html"><i class="fa fa-check"></i><b>2</b> Packages, the tidyverse and R Markdown</a>
<ul>
<li class="chapter" data-level="2.1" data-path="R2.html"><a href="R2.html#r-packages"><i class="fa fa-check"></i><b>2.1</b> R packages</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="R2.html"><a href="R2.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>2.1.1</b> Installing and loading packages</a></li>
<li class="chapter" data-level="2.1.2" data-path="R2.html"><a href="R2.html#namespaces"><i class="fa fa-check"></i><b>2.1.2</b> Namespaces</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="R2.html"><a href="R2.html#tidyverse"><i class="fa fa-check"></i><b>2.2</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="R2.html"><a href="R2.html#tibbles"><i class="fa fa-check"></i><b>2.2.1</b> Tibbles</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="R2.html"><a href="R2.html#additional-r-resources"><i class="fa fa-check"></i><b>2.3</b> Additional R resources</a></li>
<li class="chapter" data-level="2.4" data-path="R2.html"><a href="R2.html#intro-to-r-markdown"><i class="fa fa-check"></i><b>2.4</b> Intro to R Markdown</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="R2.html"><a href="R2.html#what-is-r-markdown"><i class="fa fa-check"></i><b>2.4.1</b> What is R Markdown?</a></li>
<li class="chapter" data-level="2.4.2" data-path="R2.html"><a href="R2.html#creating-a-r-markdown-file"><i class="fa fa-check"></i><b>2.4.2</b> Creating a R Markdown file</a></li>
<li class="chapter" data-level="2.4.3" data-path="R2.html"><a href="R2.html#writing-in-r-markdown"><i class="fa fa-check"></i><b>2.4.3</b> Writing in R Markdown</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Scraping</b></span></li>
<li class="chapter" data-level="3" data-path="html.html"><a href="html.html"><i class="fa fa-check"></i><b>3</b> HTML as a cornerstone of the internet</a>
<ul>
<li class="chapter" data-level="3.1" data-path="html.html"><a href="html.html#html-tags"><i class="fa fa-check"></i><b>3.1</b> HTML-Tags</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="html.html"><a href="html.html#hello_world.html"><i class="fa fa-check"></i><b>3.1.1</b> hello_world.html</a></li>
<li class="chapter" data-level="3.1.2" data-path="html.html"><a href="html.html#important-tags"><i class="fa fa-check"></i><b>3.1.2</b> Important tags</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="html.html"><a href="html.html#attribute"><i class="fa fa-check"></i><b>3.2</b> Attributes</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="html.html"><a href="html.html#links"><i class="fa fa-check"></i><b>3.2.1</b> Links</a></li>
<li class="chapter" data-level="3.2.2" data-path="html.html"><a href="html.html#images"><i class="fa fa-check"></i><b>3.2.2</b> Images</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="html.html"><a href="html.html#entities"><i class="fa fa-check"></i><b>3.3</b> Entities</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rvest1.html"><a href="rvest1.html"><i class="fa fa-check"></i><b>4</b> First scraping with rvest</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rvest1.html"><a href="rvest1.html#the-rvest-package"><i class="fa fa-check"></i><b>4.1</b> The rvest package</a></li>
<li class="chapter" data-level="4.2" data-path="rvest1.html"><a href="rvest1.html#hello_world.html-1"><i class="fa fa-check"></i><b>4.2</b> hello_world.html</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rvest1.html"><a href="rvest1.html#read_html"><i class="fa fa-check"></i><b>4.2.1</b> read_html()</a></li>
<li class="chapter" data-level="4.2.2" data-path="rvest1.html"><a href="rvest1.html#html_elements"><i class="fa fa-check"></i><b>4.2.2</b> html_elements()</a></li>
<li class="chapter" data-level="4.2.3" data-path="rvest1.html"><a href="rvest1.html#html_text"><i class="fa fa-check"></i><b>4.2.3</b> html_text()</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rvest1.html"><a href="rvest1.html#countries-of-the-world"><i class="fa fa-check"></i><b>4.3</b> Countries of the World</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rvest1.html"><a href="rvest1.html#country-names"><i class="fa fa-check"></i><b>4.3.1</b> Country names</a></li>
<li class="chapter" data-level="4.3.2" data-path="rvest1.html"><a href="rvest1.html#capitals-population-and-area"><i class="fa fa-check"></i><b>4.3.2</b> Capitals, population and area</a></li>
<li class="chapter" data-level="4.3.3" data-path="rvest1.html"><a href="rvest1.html#merge-into-one-tibble"><i class="fa fa-check"></i><b>4.3.3</b> Merge into one tibble</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html"><i class="fa fa-check"></i><b>5</b> CSS selectors &amp; Developer Tools</a>
<ul>
<li class="chapter" data-level="5.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#css"><i class="fa fa-check"></i><b>5.1</b> CSS selectors</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#classes"><i class="fa fa-check"></i><b>5.1.1</b> Classes</a></li>
<li class="chapter" data-level="5.1.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#ids"><i class="fa fa-check"></i><b>5.1.2</b> IDs</a></li>
<li class="chapter" data-level="5.1.3" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#attributes"><i class="fa fa-check"></i><b>5.1.3</b> Attributes</a></li>
<li class="chapter" data-level="5.1.4" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#hierarchy-levels"><i class="fa fa-check"></i><b>5.1.4</b> Hierarchy levels</a></li>
<li class="chapter" data-level="5.1.5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#further-selectors"><i class="fa fa-check"></i><b>5.1.5</b> Further selectors</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#developer-tools"><i class="fa fa-check"></i><b>5.2</b> Developer Tools</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rvest2.html"><a href="rvest2.html"><i class="fa fa-check"></i><b>6</b> Scraping of tables &amp; dynamic websites</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rvest2.html"><a href="rvest2.html#scraping-of-tables"><i class="fa fa-check"></i><b>6.1</b> Scraping of tables</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="rvest2.html"><a href="rvest2.html#table-with-css-selectors-from-wikipedia"><i class="fa fa-check"></i><b>6.1.1</b> Table with CSS selectors from Wikipedia</a></li>
<li class="chapter" data-level="6.1.2" data-path="rvest2.html"><a href="rvest2.html#scraping-multiple-tables"><i class="fa fa-check"></i><b>6.1.2</b> Scraping multiple tables</a></li>
<li class="chapter" data-level="6.1.3" data-path="rvest2.html"><a href="rvest2.html#tables-with-nas"><i class="fa fa-check"></i><b>6.1.3</b> Tables with NAs</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="rvest2.html"><a href="rvest2.html#dynamic-websites"><i class="fa fa-check"></i><b>6.2</b> Dynamic Websites</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rvest2.html"><a href="rvest2.html#html-forms-and-html-queries"><i class="fa fa-check"></i><b>6.2.1</b> HTML forms and HTML queries</a></li>
<li class="chapter" data-level="6.2.2" data-path="rvest2.html"><a href="rvest2.html#html-forms"><i class="fa fa-check"></i><b>6.2.2</b> HTML forms</a></li>
<li class="chapter" data-level="6.2.3" data-path="rvest2.html"><a href="rvest2.html#the-query"><i class="fa fa-check"></i><b>6.2.3</b> The query</a></li>
<li class="chapter" data-level="6.2.4" data-path="rvest2.html"><a href="rvest2.html#manipulating-the-query-and-scraping-the-result"><i class="fa fa-check"></i><b>6.2.4</b> Manipulating the query and scraping the result</a></li>
<li class="chapter" data-level="6.2.5" data-path="rvest2.html"><a href="rvest2.html#additional-resources"><i class="fa fa-check"></i><b>6.2.5</b> Additional resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rvest3.html"><a href="rvest3.html"><i class="fa fa-check"></i><b>7</b> Scraping of multi-page websites</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rvest3.html"><a href="rvest3.html#index-pages"><i class="fa fa-check"></i><b>7.1</b> Index-pages</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rvest3.html"><a href="rvest3.html#scraping-of-the-index"><i class="fa fa-check"></i><b>7.1.1</b> Scraping of the index</a></li>
<li class="chapter" data-level="7.1.2" data-path="rvest3.html"><a href="rvest3.html#iteration-with-map"><i class="fa fa-check"></i><b>7.1.2</b> Iteration with map()</a></li>
<li class="chapter" data-level="7.1.3" data-path="rvest3.html"><a href="rvest3.html#scraping-the-sub-pages"><i class="fa fa-check"></i><b>7.1.3</b> Scraping the sub-pages</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rvest3.html"><a href="rvest3.html#pagination"><i class="fa fa-check"></i><b>7.2</b> Pagination</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rvest3.html"><a href="rvest3.html#the-query-1"><i class="fa fa-check"></i><b>7.2.1</b> The query</a></li>
<li class="chapter" data-level="7.2.2" data-path="rvest3.html"><a href="rvest3.html#sub-pgs"><i class="fa fa-check"></i><b>7.2.2</b> Scraping the sub-pages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="files.html"><a href="files.html"><i class="fa fa-check"></i><b>8</b> Downloading and saving files</a>
<ul>
<li class="chapter" data-level="8.1" data-path="files.html"><a href="files.html#CSV"><i class="fa fa-check"></i><b>8.1</b> CSV files</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="files.html"><a href="files.html#parsing-a-csv-file"><i class="fa fa-check"></i><b>8.1.1</b> Parsing a CSV file</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="files.html"><a href="files.html#downloading-files"><i class="fa fa-check"></i><b>8.2</b> Downloading files</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="files.html"><a href="files.html#parsing-the-csv-files"><i class="fa fa-check"></i><b>8.2.1</b> Parsing the CSV files</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="files.html"><a href="files.html#saving-data-files"><i class="fa fa-check"></i><b>8.3</b> Saving data files</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="goodpractice.html"><a href="goodpractice.html"><i class="fa fa-check"></i><b>9</b> Good practice</a>
<ul>
<li class="chapter" data-level="9.1" data-path="goodpractice.html"><a href="goodpractice.html#we-aint-no-web-crawlers"><i class="fa fa-check"></i><b>9.1</b> We ain’t no web crawlers</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="goodpractice.html"><a href="goodpractice.html#on-robots.txt-files"><i class="fa fa-check"></i><b>9.1.1</b> On robots.txt files</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="goodpractice.html"><a href="goodpractice.html#reduce-traffic"><i class="fa fa-check"></i><b>9.2</b> Reduce traffic</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="goodpractice.html"><a href="goodpractice.html#waiting-times-in-action"><i class="fa fa-check"></i><b>9.2.1</b> Waiting times in action</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="goodpractice.html"><a href="goodpractice.html#citation-and-an-additional-resource"><i class="fa fa-check"></i><b>9.3</b> Citation and an additional resource</a></li>
</ul></li>
<li class="part"><span><b>III Sample project</b></span></li>
<li class="chapter" data-level="10" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>10</b> Scraping Berlin police reports</a>
<ul>
<li class="chapter" data-level="10.1" data-path="scraping.html"><a href="scraping.html#topic-and-data"><i class="fa fa-check"></i><b>10.1</b> Topic and data</a></li>
<li class="chapter" data-level="10.2" data-path="scraping.html"><a href="scraping.html#scraping-the-data"><i class="fa fa-check"></i><b>10.2</b> Scraping the data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="scraping.html"><a href="scraping.html#gathering-the-links"><i class="fa fa-check"></i><b>10.2.1</b> Gathering the links</a></li>
<li class="chapter" data-level="10.2.2" data-path="scraping.html"><a href="scraping.html#downloading-the-subpages"><i class="fa fa-check"></i><b>10.2.2</b> Downloading the subpages</a></li>
<li class="chapter" data-level="10.2.3" data-path="scraping.html"><a href="scraping.html#extracting-the-data-of-interest"><i class="fa fa-check"></i><b>10.2.3</b> Extracting the data of interest</a></li>
<li class="chapter" data-level="10.2.4" data-path="scraping.html"><a href="scraping.html#saving-the-data"><i class="fa fa-check"></i><b>10.2.4</b> Saving the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>11</b> Transformation with dplyr</a>
<ul>
<li class="chapter" data-level="11.1" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>11.1</b> <code>mutate()</code></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="dplyr.html"><a href="dplyr.html#computing-new-variables-from-existing-ones"><i class="fa fa-check"></i><b>11.1.1</b> Computing new variables from existing ones</a></li>
<li class="chapter" data-level="11.1.2" data-path="dplyr.html"><a href="dplyr.html#clean"><i class="fa fa-check"></i><b>11.1.2</b> Cleaning the data on police reports</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="dplyr.html"><a href="dplyr.html#select"><i class="fa fa-check"></i><b>11.2</b> <code>select()</code></a></li>
<li class="chapter" data-level="11.3" data-path="dplyr.html"><a href="dplyr.html#rename"><i class="fa fa-check"></i><b>11.3</b> <code>rename()</code></a></li>
<li class="chapter" data-level="11.4" data-path="dplyr.html"><a href="dplyr.html#filter"><i class="fa fa-check"></i><b>11.4</b> <code>filter()</code></a></li>
<li class="chapter" data-level="11.5" data-path="dplyr.html"><a href="dplyr.html#summarise-group_by"><i class="fa fa-check"></i><b>11.5</b> <code>summarise()</code> &amp; <code>group_by()</code></a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="dplyr.html"><a href="dplyr.html#number-of-reports-by-groups"><i class="fa fa-check"></i><b>11.5.1</b> Number of reports by groups</a></li>
<li class="chapter" data-level="11.5.2" data-path="dplyr.html"><a href="dplyr.html#summary-statistics-on-the-time"><i class="fa fa-check"></i><b>11.5.2</b> Summary statistics on the time</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="dplyr.html"><a href="dplyr.html#exporting-tables"><i class="fa fa-check"></i><b>11.6</b> Exporting tables</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="dplyr.html"><a href="dplyr.html#further-resources"><i class="fa fa-check"></i><b>11.6.1</b> Further resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>12</b> Graphical analysis with ggplot</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ggplot.html"><a href="ggplot.html#ggplot2-syntax"><i class="fa fa-check"></i><b>12.1</b> ggplot2 syntax</a></li>
<li class="chapter" data-level="12.2" data-path="ggplot.html"><a href="ggplot.html#geoms-and-aesthetics"><i class="fa fa-check"></i><b>12.2</b> Geoms and aesthetics</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="ggplot.html"><a href="ggplot.html#continuous-x-continuous-y"><i class="fa fa-check"></i><b>12.2.1</b> Continuous x, continuous y</a></li>
<li class="chapter" data-level="12.2.2" data-path="ggplot.html"><a href="ggplot.html#graphical-analysis-of-berlin-police-reports"><i class="fa fa-check"></i><b>12.2.2</b> Graphical analysis of Berlin police reports</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="ggplot.html"><a href="ggplot.html#exporting-plots"><i class="fa fa-check"></i><b>12.3</b> Exporting plots</a></li>
</ul></li>
<li class="part"><span><b>IV Regular expressions</b></span></li>
<li class="chapter" data-level="13" data-path="regex.html"><a href="regex.html"><i class="fa fa-check"></i><b>13</b> Regular expressions</a>
<ul>
<li class="chapter" data-level="13.1" data-path="regex.html"><a href="regex.html#cleaning-the-district-column"><i class="fa fa-check"></i><b>13.1</b> Cleaning the <code>district</code> column</a></li>
<li class="chapter" data-level="13.2" data-path="regex.html"><a href="regex.html#detecting-robberies-in-police-reports"><i class="fa fa-check"></i><b>13.2</b> Detecting robberies in police reports</a></li>
<li class="chapter" data-level="13.3" data-path="regex.html"><a href="regex.html#extracting-details-from-a-list-of-names"><i class="fa fa-check"></i><b>13.3</b> Extracting details from a list of names</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Web Scraping using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">11</span> Transformation with dplyr<a href="dplyr.html#dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter, we will use several functions from the tidyverse package
<strong>dplyr</strong> to clean the data we scraped in chapter <a href="scraping.html#scraping">10</a>. We will then
select the columns and filter the observations (rows) we need, as well as
compute some grouped summaries of the data.</p>
<p>First, let us load the required packages. <strong>dplyr</strong> is part of the core tidyverse;
the same is true for the package <strong>lubridate</strong>, which will enable us to deal with dates and
times.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="dplyr.html#cb196-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="mutate" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> <code>mutate()</code><a href="dplyr.html#mutate" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="computing-new-variables-from-existing-ones" class="section level3 hasAnchor" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Computing new variables from existing ones<a href="dplyr.html#computing-new-variables-from-existing-ones" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before we continue working on our scraped reports data, we will look at some simple
examples that will show how new variables can be computed in a tibble from
existing ones, using <code>mutate()</code> from <strong>dplyr</strong>.</p>
<p>For this purpose, let us create a new simple tibble on voter turnout. Note that
the entered data is purely illustrational and has no meaning.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="dplyr.html#cb197-1" tabindex="-1"></a>exmpl_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb197-2"><a href="dplyr.html#cb197-2" tabindex="-1"></a>  <span class="at">ybirth =</span> <span class="fu">c</span>(<span class="st">&quot;1993 - 2002&quot;</span>, <span class="st">&quot;1983 - 1992&quot;</span>, <span class="st">&quot;1973 - 1982&quot;</span>, <span class="st">&quot;1963 - 1972&quot;</span>),</span>
<span id="cb197-3"><a href="dplyr.html#cb197-3" tabindex="-1"></a>  <span class="at">eligible =</span> <span class="fu">c</span>(<span class="dv">100000</span>, <span class="dv">100000</span>, <span class="dv">100000</span>, <span class="dv">100000</span>),</span>
<span id="cb197-4"><a href="dplyr.html#cb197-4" tabindex="-1"></a>  <span class="at">turnout_person =</span> <span class="fu">c</span>(<span class="dv">40000</span>, <span class="dv">50000</span>, <span class="dv">60000</span>, <span class="dv">70000</span>),</span>
<span id="cb197-5"><a href="dplyr.html#cb197-5" tabindex="-1"></a>  <span class="at">turnout_mail =</span> <span class="fu">c</span> (<span class="dv">35000</span>, <span class="dv">30000</span>, <span class="dv">25000</span>, <span class="dv">20000</span>)</span>
<span id="cb197-6"><a href="dplyr.html#cb197-6" tabindex="-1"></a>)</span>
<span id="cb197-7"><a href="dplyr.html#cb197-7" tabindex="-1"></a></span>
<span id="cb197-8"><a href="dplyr.html#cb197-8" tabindex="-1"></a>exmpl_tbl</span>
<span id="cb197-9"><a href="dplyr.html#cb197-9" tabindex="-1"></a><span class="do">## # A tibble: 4 × 4</span></span>
<span id="cb197-10"><a href="dplyr.html#cb197-10" tabindex="-1"></a><span class="do">##   ybirth      eligible turnout_person turnout_mail</span></span>
<span id="cb197-11"><a href="dplyr.html#cb197-11" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb197-12"><a href="dplyr.html#cb197-12" tabindex="-1"></a><span class="do">## 1 1993 - 2002   100000          40000        35000</span></span>
<span id="cb197-13"><a href="dplyr.html#cb197-13" tabindex="-1"></a><span class="do">## 2 1983 - 1992   100000          50000        30000</span></span>
<span id="cb197-14"><a href="dplyr.html#cb197-14" tabindex="-1"></a><span class="do">## 3 1973 - 1982   100000          60000        25000</span></span>
<span id="cb197-15"><a href="dplyr.html#cb197-15" tabindex="-1"></a><span class="do">## 4 1963 - 1972   100000          70000        20000</span></span></code></pre></div>
<p>Here we have different columns for people who were eligible to vote, who voted in person and who voted by
mail, by their year of birth. We do not actually care about the difference in
the voting method in this example and want one column that combines both. We can
get there by using <code>mutate()</code>. The function takes the data to be manipulated as
its first argument, followed by one or multiple arguments defining the new
columns to be created. We can create this new columns as computations from the
columns already present.</p>
<p>To calculate the total turnout, we write:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="dplyr.html#cb198-1" tabindex="-1"></a>exmpl_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb198-2"><a href="dplyr.html#cb198-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">turnout =</span> turnout_person <span class="sc">+</span> turnout_mail)</span>
<span id="cb198-3"><a href="dplyr.html#cb198-3" tabindex="-1"></a><span class="do">## # A tibble: 4 × 5</span></span>
<span id="cb198-4"><a href="dplyr.html#cb198-4" tabindex="-1"></a><span class="do">##   ybirth      eligible turnout_person turnout_mail turnout</span></span>
<span id="cb198-5"><a href="dplyr.html#cb198-5" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb198-6"><a href="dplyr.html#cb198-6" tabindex="-1"></a><span class="do">## 1 1993 - 2002   100000          40000        35000   75000</span></span>
<span id="cb198-7"><a href="dplyr.html#cb198-7" tabindex="-1"></a><span class="do">## 2 1983 - 1992   100000          50000        30000   80000</span></span>
<span id="cb198-8"><a href="dplyr.html#cb198-8" tabindex="-1"></a><span class="do">## 3 1973 - 1982   100000          60000        25000   85000</span></span>
<span id="cb198-9"><a href="dplyr.html#cb198-9" tabindex="-1"></a><span class="do">## 4 1963 - 1972   100000          70000        20000   90000</span></span></code></pre></div>
<p>We can also immediately start calculating with new columns in the same <code>mutate()</code>
command. For this, we chain multiple operations in <code>mutate()</code> separated with <code>,</code>.
To calculate the turnout percentage in a second step, we write the following:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="dplyr.html#cb199-1" tabindex="-1"></a>exmpl_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb199-2"><a href="dplyr.html#cb199-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb199-3"><a href="dplyr.html#cb199-3" tabindex="-1"></a>    <span class="at">turnout =</span> turnout_person <span class="sc">+</span> turnout_mail,</span>
<span id="cb199-4"><a href="dplyr.html#cb199-4" tabindex="-1"></a>    <span class="at">turnout_pct =</span> turnout <span class="sc">/</span> eligible</span>
<span id="cb199-5"><a href="dplyr.html#cb199-5" tabindex="-1"></a>  )</span>
<span id="cb199-6"><a href="dplyr.html#cb199-6" tabindex="-1"></a><span class="do">## # A tibble: 4 × 6</span></span>
<span id="cb199-7"><a href="dplyr.html#cb199-7" tabindex="-1"></a><span class="do">##   ybirth      eligible turnout_person turnout_mail turnout turnout_pct</span></span>
<span id="cb199-8"><a href="dplyr.html#cb199-8" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb199-9"><a href="dplyr.html#cb199-9" tabindex="-1"></a><span class="do">## 1 1993 - 2002   100000          40000        35000   75000        0.75</span></span>
<span id="cb199-10"><a href="dplyr.html#cb199-10" tabindex="-1"></a><span class="do">## 2 1983 - 1992   100000          50000        30000   80000        0.8 </span></span>
<span id="cb199-11"><a href="dplyr.html#cb199-11" tabindex="-1"></a><span class="do">## 3 1973 - 1982   100000          60000        25000   85000        0.85</span></span>
<span id="cb199-12"><a href="dplyr.html#cb199-12" tabindex="-1"></a><span class="do">## 4 1963 - 1972   100000          70000        20000   90000        0.9</span></span></code></pre></div>
<p>Note that <code>mutate()</code> is not limited to basic arithmetic operations. Many
functions can be applied within <code>mutate()</code>: <code>sum()</code> or <code>mean()</code> are two examples
we already know.</p>
</div>
<div id="clean" class="section level3 hasAnchor" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Cleaning the data on police reports<a href="dplyr.html#clean" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now knowing the basic principle of working with <code>mutate()</code>, we can apply this to
the data on police reports we scraped in chapter <a href="scraping.html#scraping">10</a>.</p>
<p>First we have to load the data and examine what we are working with.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="dplyr.html#cb200-1" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;reports.RData&quot;</span>)</span>
<span id="cb200-2"><a href="dplyr.html#cb200-2" tabindex="-1"></a></span>
<span id="cb200-3"><a href="dplyr.html#cb200-3" tabindex="-1"></a>reports</span>
<span id="cb200-4"><a href="dplyr.html#cb200-4" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 3</span></span>
<span id="cb200-5"><a href="dplyr.html#cb200-5" tabindex="-1"></a><span class="do">##    Date                 Report                                          District</span></span>
<span id="cb200-6"><a href="dplyr.html#cb200-6" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                &lt;chr&gt;                                           &lt;chr&gt;   </span></span>
<span id="cb200-7"><a href="dplyr.html#cb200-7" tabindex="-1"></a><span class="do">##  1 06.03.2025 15:01 Uhr Heranwachsender mit mehreren Stichverletzungen  Ereigni…</span></span>
<span id="cb200-8"><a href="dplyr.html#cb200-8" tabindex="-1"></a><span class="do">##  2 06.03.2025 14:57 Uhr Kokstaxi-Fahrer festgenommen                    Ereigni…</span></span>
<span id="cb200-9"><a href="dplyr.html#cb200-9" tabindex="-1"></a><span class="do">##  3 06.03.2025 14:49 Uhr Mehrere Brände in einer Nacht                   Ereigni…</span></span>
<span id="cb200-10"><a href="dplyr.html#cb200-10" tabindex="-1"></a><span class="do">##  4 06.03.2025 11:40 Uhr Tourist bei Verkehrsunfall verletzt             Ereigni…</span></span>
<span id="cb200-11"><a href="dplyr.html#cb200-11" tabindex="-1"></a><span class="do">##  5 06.03.2025 10:49 Uhr Hausfriedensbruch begangen und Ladendetektiv b… Ereigni…</span></span>
<span id="cb200-12"><a href="dplyr.html#cb200-12" tabindex="-1"></a><span class="do">##  6 06.03.2025 10:46 Uhr Verkehrsunfall auf Kreuzung – Fußgänger im Kra… Ereigni…</span></span>
<span id="cb200-13"><a href="dplyr.html#cb200-13" tabindex="-1"></a><span class="do">##  7 06.03.2025 10:43 Uhr Auseinandersetzung im Park                      Ereigni…</span></span>
<span id="cb200-14"><a href="dplyr.html#cb200-14" tabindex="-1"></a><span class="do">##  8 06.03.2025 09:52 Uhr Mitarbeiter von Ladendieb verletzt              Ereigni…</span></span>
<span id="cb200-15"><a href="dplyr.html#cb200-15" tabindex="-1"></a><span class="do">##  9 06.03.2025 09:21 Uhr Motorrollerfahrerin bei Verkehrsunfall verletzt Ereigni…</span></span>
<span id="cb200-16"><a href="dplyr.html#cb200-16" tabindex="-1"></a><span class="do">## 10 05.03.2025 16:53 Uhr Mann zeigt Hitlergruß und äußert sich volksver… Ereigni…</span></span>
<span id="cb200-17"><a href="dplyr.html#cb200-17" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span></code></pre></div>
<p>We can leave the column containing the text of the police report as it is, but
the columns containing the districts, as well as the date and time, could use
some work.</p>
<p>The data in the column “District” includes the string “Ereignisort:” before
listing the actual name of the district the report refers to. This unnecessarily
clutters this column: we can use <code>substr()</code> to remove these leading characters
within <code>mutate()</code>. <code>substr()</code> extracts a part of a string we want
to keep, taking the data to be applied to, as its first argument – here the
name of the column –, the starting character position where the extraction
shall begin as its second, and the character position where it shall stop, as
its third argument. Character position here refers to the numeric position of a
character in a string: to begin extraction after “Ereignisort:” we have to
count the length of this substring including the whitespace after “:”, which is
<span class="math inline">\(13\)</span> and thus use <span class="math inline">\(14\)</span> as the starting position. For the position to stop
extraction, we could either use an unrealistically high number or use
<code>str_length(District)</code> to determine the exact length of each string.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="dplyr.html#cb201-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb201-2"><a href="dplyr.html#cb201-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">substr</span>(District, <span class="dv">14</span>, <span class="dv">99</span>))</span>
<span id="cb201-3"><a href="dplyr.html#cb201-3" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 3</span></span>
<span id="cb201-4"><a href="dplyr.html#cb201-4" tabindex="-1"></a><span class="do">##    Date                 Report                                          District</span></span>
<span id="cb201-5"><a href="dplyr.html#cb201-5" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                &lt;chr&gt;                                           &lt;chr&gt;   </span></span>
<span id="cb201-6"><a href="dplyr.html#cb201-6" tabindex="-1"></a><span class="do">##  1 06.03.2025 15:01 Uhr Heranwachsender mit mehreren Stichverletzungen  Mitte   </span></span>
<span id="cb201-7"><a href="dplyr.html#cb201-7" tabindex="-1"></a><span class="do">##  2 06.03.2025 14:57 Uhr Kokstaxi-Fahrer festgenommen                    Reinick…</span></span>
<span id="cb201-8"><a href="dplyr.html#cb201-8" tabindex="-1"></a><span class="do">##  3 06.03.2025 14:49 Uhr Mehrere Brände in einer Nacht                   Lichten…</span></span>
<span id="cb201-9"><a href="dplyr.html#cb201-9" tabindex="-1"></a><span class="do">##  4 06.03.2025 11:40 Uhr Tourist bei Verkehrsunfall verletzt             Mitte   </span></span>
<span id="cb201-10"><a href="dplyr.html#cb201-10" tabindex="-1"></a><span class="do">##  5 06.03.2025 10:49 Uhr Hausfriedensbruch begangen und Ladendetektiv b… Pankow  </span></span>
<span id="cb201-11"><a href="dplyr.html#cb201-11" tabindex="-1"></a><span class="do">##  6 06.03.2025 10:46 Uhr Verkehrsunfall auf Kreuzung – Fußgänger im Kra… Friedri…</span></span>
<span id="cb201-12"><a href="dplyr.html#cb201-12" tabindex="-1"></a><span class="do">##  7 06.03.2025 10:43 Uhr Auseinandersetzung im Park                      Pankow  </span></span>
<span id="cb201-13"><a href="dplyr.html#cb201-13" tabindex="-1"></a><span class="do">##  8 06.03.2025 09:52 Uhr Mitarbeiter von Ladendieb verletzt              Charlot…</span></span>
<span id="cb201-14"><a href="dplyr.html#cb201-14" tabindex="-1"></a><span class="do">##  9 06.03.2025 09:21 Uhr Motorrollerfahrerin bei Verkehrsunfall verletzt Mitte   </span></span>
<span id="cb201-15"><a href="dplyr.html#cb201-15" tabindex="-1"></a><span class="do">## 10 05.03.2025 16:53 Uhr Mann zeigt Hitlergruß und äußert sich volksver… Charlot…</span></span>
<span id="cb201-16"><a href="dplyr.html#cb201-16" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span>
<span id="cb201-17"><a href="dplyr.html#cb201-17" tabindex="-1"></a></span>
<span id="cb201-18"><a href="dplyr.html#cb201-18" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb201-19"><a href="dplyr.html#cb201-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">substr</span>(District, <span class="dv">14</span>, <span class="fu">str_length</span>(District)))</span>
<span id="cb201-20"><a href="dplyr.html#cb201-20" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 3</span></span>
<span id="cb201-21"><a href="dplyr.html#cb201-21" tabindex="-1"></a><span class="do">##    Date                 Report                                          District</span></span>
<span id="cb201-22"><a href="dplyr.html#cb201-22" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                &lt;chr&gt;                                           &lt;chr&gt;   </span></span>
<span id="cb201-23"><a href="dplyr.html#cb201-23" tabindex="-1"></a><span class="do">##  1 06.03.2025 15:01 Uhr Heranwachsender mit mehreren Stichverletzungen  Mitte   </span></span>
<span id="cb201-24"><a href="dplyr.html#cb201-24" tabindex="-1"></a><span class="do">##  2 06.03.2025 14:57 Uhr Kokstaxi-Fahrer festgenommen                    Reinick…</span></span>
<span id="cb201-25"><a href="dplyr.html#cb201-25" tabindex="-1"></a><span class="do">##  3 06.03.2025 14:49 Uhr Mehrere Brände in einer Nacht                   Lichten…</span></span>
<span id="cb201-26"><a href="dplyr.html#cb201-26" tabindex="-1"></a><span class="do">##  4 06.03.2025 11:40 Uhr Tourist bei Verkehrsunfall verletzt             Mitte   </span></span>
<span id="cb201-27"><a href="dplyr.html#cb201-27" tabindex="-1"></a><span class="do">##  5 06.03.2025 10:49 Uhr Hausfriedensbruch begangen und Ladendetektiv b… Pankow  </span></span>
<span id="cb201-28"><a href="dplyr.html#cb201-28" tabindex="-1"></a><span class="do">##  6 06.03.2025 10:46 Uhr Verkehrsunfall auf Kreuzung – Fußgänger im Kra… Friedri…</span></span>
<span id="cb201-29"><a href="dplyr.html#cb201-29" tabindex="-1"></a><span class="do">##  7 06.03.2025 10:43 Uhr Auseinandersetzung im Park                      Pankow  </span></span>
<span id="cb201-30"><a href="dplyr.html#cb201-30" tabindex="-1"></a><span class="do">##  8 06.03.2025 09:52 Uhr Mitarbeiter von Ladendieb verletzt              Charlot…</span></span>
<span id="cb201-31"><a href="dplyr.html#cb201-31" tabindex="-1"></a><span class="do">##  9 06.03.2025 09:21 Uhr Motorrollerfahrerin bei Verkehrsunfall verletzt Mitte   </span></span>
<span id="cb201-32"><a href="dplyr.html#cb201-32" tabindex="-1"></a><span class="do">## 10 05.03.2025 16:53 Uhr Mann zeigt Hitlergruß und äußert sich volksver… Charlot…</span></span>
<span id="cb201-33"><a href="dplyr.html#cb201-33" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span></code></pre></div>
<p>The column “Date” includes the date and the time of each report as a character
string. To be able to use this data in analysis, we have to extract the date and
time in a format R can understand. This is easily achieved using the parsing
functions from <strong>lubridate</strong>. As the character data are written in the format
“day.month.year hour:minute”, we have to use the function <code>dmy_hm()</code> on the
column.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="dplyr.html#cb202-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb202-2"><a href="dplyr.html#cb202-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_cmpl =</span> <span class="fu">dmy_hm</span>(Date))</span>
<span id="cb202-3"><a href="dplyr.html#cb202-3" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 4</span></span>
<span id="cb202-4"><a href="dplyr.html#cb202-4" tabindex="-1"></a><span class="do">##    Date                 Report                      District date_cmpl          </span></span>
<span id="cb202-5"><a href="dplyr.html#cb202-5" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                &lt;chr&gt;                       &lt;chr&gt;    &lt;dttm&gt;             </span></span>
<span id="cb202-6"><a href="dplyr.html#cb202-6" tabindex="-1"></a><span class="do">##  1 06.03.2025 15:01 Uhr Heranwachsender mit mehrer… Ereigni… 2025-03-06 15:01:00</span></span>
<span id="cb202-7"><a href="dplyr.html#cb202-7" tabindex="-1"></a><span class="do">##  2 06.03.2025 14:57 Uhr Kokstaxi-Fahrer festgenomm… Ereigni… 2025-03-06 14:57:00</span></span>
<span id="cb202-8"><a href="dplyr.html#cb202-8" tabindex="-1"></a><span class="do">##  3 06.03.2025 14:49 Uhr Mehrere Brände in einer Na… Ereigni… 2025-03-06 14:49:00</span></span>
<span id="cb202-9"><a href="dplyr.html#cb202-9" tabindex="-1"></a><span class="do">##  4 06.03.2025 11:40 Uhr Tourist bei Verkehrsunfall… Ereigni… 2025-03-06 11:40:00</span></span>
<span id="cb202-10"><a href="dplyr.html#cb202-10" tabindex="-1"></a><span class="do">##  5 06.03.2025 10:49 Uhr Hausfriedensbruch begangen… Ereigni… 2025-03-06 10:49:00</span></span>
<span id="cb202-11"><a href="dplyr.html#cb202-11" tabindex="-1"></a><span class="do">##  6 06.03.2025 10:46 Uhr Verkehrsunfall auf Kreuzun… Ereigni… 2025-03-06 10:46:00</span></span>
<span id="cb202-12"><a href="dplyr.html#cb202-12" tabindex="-1"></a><span class="do">##  7 06.03.2025 10:43 Uhr Auseinandersetzung im Park  Ereigni… 2025-03-06 10:43:00</span></span>
<span id="cb202-13"><a href="dplyr.html#cb202-13" tabindex="-1"></a><span class="do">##  8 06.03.2025 09:52 Uhr Mitarbeiter von Ladendieb … Ereigni… 2025-03-06 09:52:00</span></span>
<span id="cb202-14"><a href="dplyr.html#cb202-14" tabindex="-1"></a><span class="do">##  9 06.03.2025 09:21 Uhr Motorrollerfahrerin bei Ve… Ereigni… 2025-03-06 09:21:00</span></span>
<span id="cb202-15"><a href="dplyr.html#cb202-15" tabindex="-1"></a><span class="do">## 10 05.03.2025 16:53 Uhr Mann zeigt Hitlergruß und … Ereigni… 2025-03-05 16:53:00</span></span>
<span id="cb202-16"><a href="dplyr.html#cb202-16" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span></code></pre></div>
<p>At a later point we will do some analysis by year, month, weekday and time of
day. <strong>lubridate</strong> includes functions that extract the subparts of date and time
data.</p>
<p><code>year()</code> extracts the year, <code>month()</code> the month and <code>wday()</code> the day of the
week. The argument <code>label = TRUE</code> tells the function to use the names of months
and days instead of a numerical value ranging from <span class="math inline">\(1\)</span> to <span class="math inline">\(12\)</span> and <span class="math inline">\(1\)</span> to <span class="math inline">\(7\)</span>
respectively.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="dplyr.html#cb203-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb203-2"><a href="dplyr.html#cb203-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_cmpl =</span> <span class="fu">dmy_hm</span>(Date),</span>
<span id="cb203-3"><a href="dplyr.html#cb203-3" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(date_cmpl),</span>
<span id="cb203-4"><a href="dplyr.html#cb203-4" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">month</span>(date_cmpl, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb203-5"><a href="dplyr.html#cb203-5" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">wday</span>(date_cmpl, <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb203-6"><a href="dplyr.html#cb203-6" tabindex="-1"></a>         )</span>
<span id="cb203-7"><a href="dplyr.html#cb203-7" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 7</span></span>
<span id="cb203-8"><a href="dplyr.html#cb203-8" tabindex="-1"></a><span class="do">##    Date                 Report    District date_cmpl            year month day  </span></span>
<span id="cb203-9"><a href="dplyr.html#cb203-9" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;    &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt;</span></span>
<span id="cb203-10"><a href="dplyr.html#cb203-10" tabindex="-1"></a><span class="do">##  1 06.03.2025 15:01 Uhr Heranwac… Ereigni… 2025-03-06 15:01:00  2025 Mär   Do   </span></span>
<span id="cb203-11"><a href="dplyr.html#cb203-11" tabindex="-1"></a><span class="do">##  2 06.03.2025 14:57 Uhr Kokstaxi… Ereigni… 2025-03-06 14:57:00  2025 Mär   Do   </span></span>
<span id="cb203-12"><a href="dplyr.html#cb203-12" tabindex="-1"></a><span class="do">##  3 06.03.2025 14:49 Uhr Mehrere … Ereigni… 2025-03-06 14:49:00  2025 Mär   Do   </span></span>
<span id="cb203-13"><a href="dplyr.html#cb203-13" tabindex="-1"></a><span class="do">##  4 06.03.2025 11:40 Uhr Tourist … Ereigni… 2025-03-06 11:40:00  2025 Mär   Do   </span></span>
<span id="cb203-14"><a href="dplyr.html#cb203-14" tabindex="-1"></a><span class="do">##  5 06.03.2025 10:49 Uhr Hausfrie… Ereigni… 2025-03-06 10:49:00  2025 Mär   Do   </span></span>
<span id="cb203-15"><a href="dplyr.html#cb203-15" tabindex="-1"></a><span class="do">##  6 06.03.2025 10:46 Uhr Verkehrs… Ereigni… 2025-03-06 10:46:00  2025 Mär   Do   </span></span>
<span id="cb203-16"><a href="dplyr.html#cb203-16" tabindex="-1"></a><span class="do">##  7 06.03.2025 10:43 Uhr Auseinan… Ereigni… 2025-03-06 10:43:00  2025 Mär   Do   </span></span>
<span id="cb203-17"><a href="dplyr.html#cb203-17" tabindex="-1"></a><span class="do">##  8 06.03.2025 09:52 Uhr Mitarbei… Ereigni… 2025-03-06 09:52:00  2025 Mär   Do   </span></span>
<span id="cb203-18"><a href="dplyr.html#cb203-18" tabindex="-1"></a><span class="do">##  9 06.03.2025 09:21 Uhr Motorrol… Ereigni… 2025-03-06 09:21:00  2025 Mär   Do   </span></span>
<span id="cb203-19"><a href="dplyr.html#cb203-19" tabindex="-1"></a><span class="do">## 10 05.03.2025 16:53 Uhr Mann zei… Ereigni… 2025-03-05 16:53:00  2025 Mär   Mi   </span></span>
<span id="cb203-20"><a href="dplyr.html#cb203-20" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span></code></pre></div>
<p>To extract the time of day, we first have to extract the substring of “Date”
that contains the time and then apply the lubridate function <code>hm()</code> to it.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="dplyr.html#cb204-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb204-2"><a href="dplyr.html#cb204-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> </span>
<span id="cb204-3"><a href="dplyr.html#cb204-3" tabindex="-1"></a>           <span class="fu">substr</span>(Date, <span class="dv">12</span>, <span class="fu">str_length</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb204-4"><a href="dplyr.html#cb204-4" tabindex="-1"></a>           <span class="fu">hm</span>()</span>
<span id="cb204-5"><a href="dplyr.html#cb204-5" tabindex="-1"></a>         )</span>
<span id="cb204-6"><a href="dplyr.html#cb204-6" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 4</span></span>
<span id="cb204-7"><a href="dplyr.html#cb204-7" tabindex="-1"></a><span class="do">##    Date                 Report                               District time      </span></span>
<span id="cb204-8"><a href="dplyr.html#cb204-8" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                &lt;chr&gt;                                &lt;chr&gt;    &lt;Period&gt;  </span></span>
<span id="cb204-9"><a href="dplyr.html#cb204-9" tabindex="-1"></a><span class="do">##  1 06.03.2025 15:01 Uhr Heranwachsender mit mehreren Stichv… Ereigni… 15H 1M 0S </span></span>
<span id="cb204-10"><a href="dplyr.html#cb204-10" tabindex="-1"></a><span class="do">##  2 06.03.2025 14:57 Uhr Kokstaxi-Fahrer festgenommen         Ereigni… 14H 57M 0S</span></span>
<span id="cb204-11"><a href="dplyr.html#cb204-11" tabindex="-1"></a><span class="do">##  3 06.03.2025 14:49 Uhr Mehrere Brände in einer Nacht        Ereigni… 14H 49M 0S</span></span>
<span id="cb204-12"><a href="dplyr.html#cb204-12" tabindex="-1"></a><span class="do">##  4 06.03.2025 11:40 Uhr Tourist bei Verkehrsunfall verletzt  Ereigni… 11H 40M 0S</span></span>
<span id="cb204-13"><a href="dplyr.html#cb204-13" tabindex="-1"></a><span class="do">##  5 06.03.2025 10:49 Uhr Hausfriedensbruch begangen und Lade… Ereigni… 10H 49M 0S</span></span>
<span id="cb204-14"><a href="dplyr.html#cb204-14" tabindex="-1"></a><span class="do">##  6 06.03.2025 10:46 Uhr Verkehrsunfall auf Kreuzung – Fußgä… Ereigni… 10H 46M 0S</span></span>
<span id="cb204-15"><a href="dplyr.html#cb204-15" tabindex="-1"></a><span class="do">##  7 06.03.2025 10:43 Uhr Auseinandersetzung im Park           Ereigni… 10H 43M 0S</span></span>
<span id="cb204-16"><a href="dplyr.html#cb204-16" tabindex="-1"></a><span class="do">##  8 06.03.2025 09:52 Uhr Mitarbeiter von Ladendieb verletzt   Ereigni… 9H 52M 0S </span></span>
<span id="cb204-17"><a href="dplyr.html#cb204-17" tabindex="-1"></a><span class="do">##  9 06.03.2025 09:21 Uhr Motorrollerfahrerin bei Verkehrsunf… Ereigni… 9H 21M 0S </span></span>
<span id="cb204-18"><a href="dplyr.html#cb204-18" tabindex="-1"></a><span class="do">## 10 05.03.2025 16:53 Uhr Mann zeigt Hitlergruß und äußert si… Ereigni… 16H 53M 0S</span></span>
<span id="cb204-19"><a href="dplyr.html#cb204-19" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span></code></pre></div>
<p>We can combine all these individual steps in one <code>mutate()</code> command and apply
them to the object <code>reports</code>.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="dplyr.html#cb205-1" tabindex="-1"></a>reports <span class="ot">&lt;-</span> reports <span class="sc">%&gt;%</span> </span>
<span id="cb205-2"><a href="dplyr.html#cb205-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">substr</span>(District, <span class="dv">14</span>, <span class="fu">str_length</span>(District)),</span>
<span id="cb205-3"><a href="dplyr.html#cb205-3" tabindex="-1"></a>         <span class="at">date_cmpl =</span> <span class="fu">dmy_hm</span>(Date),</span>
<span id="cb205-4"><a href="dplyr.html#cb205-4" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(date_cmpl),</span>
<span id="cb205-5"><a href="dplyr.html#cb205-5" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">month</span>(date_cmpl, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb205-6"><a href="dplyr.html#cb205-6" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">wday</span>(date_cmpl, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb205-7"><a href="dplyr.html#cb205-7" tabindex="-1"></a>         <span class="at">time =</span> </span>
<span id="cb205-8"><a href="dplyr.html#cb205-8" tabindex="-1"></a>           <span class="fu">substr</span>(Date, <span class="dv">12</span>, <span class="fu">str_length</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-9"><a href="dplyr.html#cb205-9" tabindex="-1"></a>           <span class="fu">hm</span>()</span>
<span id="cb205-10"><a href="dplyr.html#cb205-10" tabindex="-1"></a>         )</span>
<span id="cb205-11"><a href="dplyr.html#cb205-11" tabindex="-1"></a></span>
<span id="cb205-12"><a href="dplyr.html#cb205-12" tabindex="-1"></a>reports</span>
<span id="cb205-13"><a href="dplyr.html#cb205-13" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 8</span></span>
<span id="cb205-14"><a href="dplyr.html#cb205-14" tabindex="-1"></a><span class="do">##    Date         Report District date_cmpl            year month day   time      </span></span>
<span id="cb205-15"><a href="dplyr.html#cb205-15" tabindex="-1"></a><span class="do">##    &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;    &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb205-16"><a href="dplyr.html#cb205-16" tabindex="-1"></a><span class="do">##  1 06.03.2025 … Heran… Mitte    2025-03-06 15:01:00  2025 Mär   Do    15H 1M 0S </span></span>
<span id="cb205-17"><a href="dplyr.html#cb205-17" tabindex="-1"></a><span class="do">##  2 06.03.2025 … Kokst… Reinick… 2025-03-06 14:57:00  2025 Mär   Do    14H 57M 0S</span></span>
<span id="cb205-18"><a href="dplyr.html#cb205-18" tabindex="-1"></a><span class="do">##  3 06.03.2025 … Mehre… Lichten… 2025-03-06 14:49:00  2025 Mär   Do    14H 49M 0S</span></span>
<span id="cb205-19"><a href="dplyr.html#cb205-19" tabindex="-1"></a><span class="do">##  4 06.03.2025 … Touri… Mitte    2025-03-06 11:40:00  2025 Mär   Do    11H 40M 0S</span></span>
<span id="cb205-20"><a href="dplyr.html#cb205-20" tabindex="-1"></a><span class="do">##  5 06.03.2025 … Hausf… Pankow   2025-03-06 10:49:00  2025 Mär   Do    10H 49M 0S</span></span>
<span id="cb205-21"><a href="dplyr.html#cb205-21" tabindex="-1"></a><span class="do">##  6 06.03.2025 … Verke… Friedri… 2025-03-06 10:46:00  2025 Mär   Do    10H 46M 0S</span></span>
<span id="cb205-22"><a href="dplyr.html#cb205-22" tabindex="-1"></a><span class="do">##  7 06.03.2025 … Ausei… Pankow   2025-03-06 10:43:00  2025 Mär   Do    10H 43M 0S</span></span>
<span id="cb205-23"><a href="dplyr.html#cb205-23" tabindex="-1"></a><span class="do">##  8 06.03.2025 … Mitar… Charlot… 2025-03-06 09:52:00  2025 Mär   Do    9H 52M 0S </span></span>
<span id="cb205-24"><a href="dplyr.html#cb205-24" tabindex="-1"></a><span class="do">##  9 06.03.2025 … Motor… Mitte    2025-03-06 09:21:00  2025 Mär   Do    9H 21M 0S </span></span>
<span id="cb205-25"><a href="dplyr.html#cb205-25" tabindex="-1"></a><span class="do">## 10 05.03.2025 … Mann … Charlot… 2025-03-05 16:53:00  2025 Mär   Mi    16H 53M 0S</span></span>
<span id="cb205-26"><a href="dplyr.html#cb205-26" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span></code></pre></div>
</div>
</div>
<div id="select" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> <code>select()</code><a href="dplyr.html#select" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As we have already extracted all we need from the “Date” and “date_cmpl” columns,
and we will not work with the “Report” column in this chapter, to keep the
tibble neat and free of clutter, we remove the three columns by using the
function <code>select()</code>. <code>select()</code> is used for selecting columns from a tibbble. The
function takes the data as its first argument – here provided by the pipe –
and one or several names of columns that should be kept. If columns follow after
each other in order, we can also use a “from:to” notation.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="dplyr.html#cb206-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb206-2"><a href="dplyr.html#cb206-2" tabindex="-1"></a>  <span class="fu">select</span>(District, year, month, day, time)</span>
<span id="cb206-3"><a href="dplyr.html#cb206-3" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 5</span></span>
<span id="cb206-4"><a href="dplyr.html#cb206-4" tabindex="-1"></a><span class="do">##    District                    year month day   time      </span></span>
<span id="cb206-5"><a href="dplyr.html#cb206-5" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb206-6"><a href="dplyr.html#cb206-6" tabindex="-1"></a><span class="do">##  1 Mitte                       2025 Mär   Do    15H 1M 0S </span></span>
<span id="cb206-7"><a href="dplyr.html#cb206-7" tabindex="-1"></a><span class="do">##  2 Reinickendorf               2025 Mär   Do    14H 57M 0S</span></span>
<span id="cb206-8"><a href="dplyr.html#cb206-8" tabindex="-1"></a><span class="do">##  3 Lichtenberg                 2025 Mär   Do    14H 49M 0S</span></span>
<span id="cb206-9"><a href="dplyr.html#cb206-9" tabindex="-1"></a><span class="do">##  4 Mitte                       2025 Mär   Do    11H 40M 0S</span></span>
<span id="cb206-10"><a href="dplyr.html#cb206-10" tabindex="-1"></a><span class="do">##  5 Pankow                      2025 Mär   Do    10H 49M 0S</span></span>
<span id="cb206-11"><a href="dplyr.html#cb206-11" tabindex="-1"></a><span class="do">##  6 Friedrichshain-Kreuzberg    2025 Mär   Do    10H 46M 0S</span></span>
<span id="cb206-12"><a href="dplyr.html#cb206-12" tabindex="-1"></a><span class="do">##  7 Pankow                      2025 Mär   Do    10H 43M 0S</span></span>
<span id="cb206-13"><a href="dplyr.html#cb206-13" tabindex="-1"></a><span class="do">##  8 Charlottenburg-Wilmersdorf  2025 Mär   Do    9H 52M 0S </span></span>
<span id="cb206-14"><a href="dplyr.html#cb206-14" tabindex="-1"></a><span class="do">##  9 Mitte                       2025 Mär   Do    9H 21M 0S </span></span>
<span id="cb206-15"><a href="dplyr.html#cb206-15" tabindex="-1"></a><span class="do">## 10 Charlottenburg-Wilmersdorf  2025 Mär   Mi    16H 53M 0S</span></span>
<span id="cb206-16"><a href="dplyr.html#cb206-16" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span>
<span id="cb206-17"><a href="dplyr.html#cb206-17" tabindex="-1"></a></span>
<span id="cb206-18"><a href="dplyr.html#cb206-18" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb206-19"><a href="dplyr.html#cb206-19" tabindex="-1"></a>  <span class="fu">select</span>(District, year<span class="sc">:</span>time)</span>
<span id="cb206-20"><a href="dplyr.html#cb206-20" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 5</span></span>
<span id="cb206-21"><a href="dplyr.html#cb206-21" tabindex="-1"></a><span class="do">##    District                    year month day   time      </span></span>
<span id="cb206-22"><a href="dplyr.html#cb206-22" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb206-23"><a href="dplyr.html#cb206-23" tabindex="-1"></a><span class="do">##  1 Mitte                       2025 Mär   Do    15H 1M 0S </span></span>
<span id="cb206-24"><a href="dplyr.html#cb206-24" tabindex="-1"></a><span class="do">##  2 Reinickendorf               2025 Mär   Do    14H 57M 0S</span></span>
<span id="cb206-25"><a href="dplyr.html#cb206-25" tabindex="-1"></a><span class="do">##  3 Lichtenberg                 2025 Mär   Do    14H 49M 0S</span></span>
<span id="cb206-26"><a href="dplyr.html#cb206-26" tabindex="-1"></a><span class="do">##  4 Mitte                       2025 Mär   Do    11H 40M 0S</span></span>
<span id="cb206-27"><a href="dplyr.html#cb206-27" tabindex="-1"></a><span class="do">##  5 Pankow                      2025 Mär   Do    10H 49M 0S</span></span>
<span id="cb206-28"><a href="dplyr.html#cb206-28" tabindex="-1"></a><span class="do">##  6 Friedrichshain-Kreuzberg    2025 Mär   Do    10H 46M 0S</span></span>
<span id="cb206-29"><a href="dplyr.html#cb206-29" tabindex="-1"></a><span class="do">##  7 Pankow                      2025 Mär   Do    10H 43M 0S</span></span>
<span id="cb206-30"><a href="dplyr.html#cb206-30" tabindex="-1"></a><span class="do">##  8 Charlottenburg-Wilmersdorf  2025 Mär   Do    9H 52M 0S </span></span>
<span id="cb206-31"><a href="dplyr.html#cb206-31" tabindex="-1"></a><span class="do">##  9 Mitte                       2025 Mär   Do    9H 21M 0S </span></span>
<span id="cb206-32"><a href="dplyr.html#cb206-32" tabindex="-1"></a><span class="do">## 10 Charlottenburg-Wilmersdorf  2025 Mär   Mi    16H 53M 0S</span></span>
<span id="cb206-33"><a href="dplyr.html#cb206-33" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span></code></pre></div>
<p>Instead of telling <code>select()</code> which columns we want to keep, we can also tell it
which ones not to keep by adding a <code>-</code> before the column names. If we want to
exclude multiple columns in one step, we combine them with the <code>c()</code> function
and write the <code>-</code> directly before it. In this last example we will assign the
result to <code>reports</code>.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="dplyr.html#cb207-1" tabindex="-1"></a>reports <span class="ot">&lt;-</span> reports <span class="sc">%&gt;%</span> </span>
<span id="cb207-2"><a href="dplyr.html#cb207-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Date, Report, date_cmpl))</span>
<span id="cb207-3"><a href="dplyr.html#cb207-3" tabindex="-1"></a></span>
<span id="cb207-4"><a href="dplyr.html#cb207-4" tabindex="-1"></a>reports</span>
<span id="cb207-5"><a href="dplyr.html#cb207-5" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 5</span></span>
<span id="cb207-6"><a href="dplyr.html#cb207-6" tabindex="-1"></a><span class="do">##    District                    year month day   time      </span></span>
<span id="cb207-7"><a href="dplyr.html#cb207-7" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb207-8"><a href="dplyr.html#cb207-8" tabindex="-1"></a><span class="do">##  1 Mitte                       2025 Mär   Do    15H 1M 0S </span></span>
<span id="cb207-9"><a href="dplyr.html#cb207-9" tabindex="-1"></a><span class="do">##  2 Reinickendorf               2025 Mär   Do    14H 57M 0S</span></span>
<span id="cb207-10"><a href="dplyr.html#cb207-10" tabindex="-1"></a><span class="do">##  3 Lichtenberg                 2025 Mär   Do    14H 49M 0S</span></span>
<span id="cb207-11"><a href="dplyr.html#cb207-11" tabindex="-1"></a><span class="do">##  4 Mitte                       2025 Mär   Do    11H 40M 0S</span></span>
<span id="cb207-12"><a href="dplyr.html#cb207-12" tabindex="-1"></a><span class="do">##  5 Pankow                      2025 Mär   Do    10H 49M 0S</span></span>
<span id="cb207-13"><a href="dplyr.html#cb207-13" tabindex="-1"></a><span class="do">##  6 Friedrichshain-Kreuzberg    2025 Mär   Do    10H 46M 0S</span></span>
<span id="cb207-14"><a href="dplyr.html#cb207-14" tabindex="-1"></a><span class="do">##  7 Pankow                      2025 Mär   Do    10H 43M 0S</span></span>
<span id="cb207-15"><a href="dplyr.html#cb207-15" tabindex="-1"></a><span class="do">##  8 Charlottenburg-Wilmersdorf  2025 Mär   Do    9H 52M 0S </span></span>
<span id="cb207-16"><a href="dplyr.html#cb207-16" tabindex="-1"></a><span class="do">##  9 Mitte                       2025 Mär   Do    9H 21M 0S </span></span>
<span id="cb207-17"><a href="dplyr.html#cb207-17" tabindex="-1"></a><span class="do">## 10 Charlottenburg-Wilmersdorf  2025 Mär   Mi    16H 53M 0S</span></span>
<span id="cb207-18"><a href="dplyr.html#cb207-18" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span></code></pre></div>
</div>
<div id="rename" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> <code>rename()</code><a href="dplyr.html#rename" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As you may have noticed, all newly created columns are written in lower case,
while “District” begins with an upper case letter. You may want to rename this
column to a lower case name – or all the others to upper case names, depending
on your preference.</p>
<p>One approach to renaming is using the function <code>rename()</code> from <strong>dplyr</strong>: the
function takes the data to be applied to as its first argument – again passed
on by the pipe here – followed by one or more arguments in the form
<code>new_name = old_name</code>.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="dplyr.html#cb208-1" tabindex="-1"></a>reports <span class="ot">&lt;-</span> reports <span class="sc">%&gt;%</span> </span>
<span id="cb208-2"><a href="dplyr.html#cb208-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">district =</span> District)</span>
<span id="cb208-3"><a href="dplyr.html#cb208-3" tabindex="-1"></a></span>
<span id="cb208-4"><a href="dplyr.html#cb208-4" tabindex="-1"></a>reports</span>
<span id="cb208-5"><a href="dplyr.html#cb208-5" tabindex="-1"></a><span class="do">## # A tibble: 12,412 × 5</span></span>
<span id="cb208-6"><a href="dplyr.html#cb208-6" tabindex="-1"></a><span class="do">##    district                    year month day   time      </span></span>
<span id="cb208-7"><a href="dplyr.html#cb208-7" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb208-8"><a href="dplyr.html#cb208-8" tabindex="-1"></a><span class="do">##  1 Mitte                       2025 Mär   Do    15H 1M 0S </span></span>
<span id="cb208-9"><a href="dplyr.html#cb208-9" tabindex="-1"></a><span class="do">##  2 Reinickendorf               2025 Mär   Do    14H 57M 0S</span></span>
<span id="cb208-10"><a href="dplyr.html#cb208-10" tabindex="-1"></a><span class="do">##  3 Lichtenberg                 2025 Mär   Do    14H 49M 0S</span></span>
<span id="cb208-11"><a href="dplyr.html#cb208-11" tabindex="-1"></a><span class="do">##  4 Mitte                       2025 Mär   Do    11H 40M 0S</span></span>
<span id="cb208-12"><a href="dplyr.html#cb208-12" tabindex="-1"></a><span class="do">##  5 Pankow                      2025 Mär   Do    10H 49M 0S</span></span>
<span id="cb208-13"><a href="dplyr.html#cb208-13" tabindex="-1"></a><span class="do">##  6 Friedrichshain-Kreuzberg    2025 Mär   Do    10H 46M 0S</span></span>
<span id="cb208-14"><a href="dplyr.html#cb208-14" tabindex="-1"></a><span class="do">##  7 Pankow                      2025 Mär   Do    10H 43M 0S</span></span>
<span id="cb208-15"><a href="dplyr.html#cb208-15" tabindex="-1"></a><span class="do">##  8 Charlottenburg-Wilmersdorf  2025 Mär   Do    9H 52M 0S </span></span>
<span id="cb208-16"><a href="dplyr.html#cb208-16" tabindex="-1"></a><span class="do">##  9 Mitte                       2025 Mär   Do    9H 21M 0S </span></span>
<span id="cb208-17"><a href="dplyr.html#cb208-17" tabindex="-1"></a><span class="do">## 10 Charlottenburg-Wilmersdorf  2025 Mär   Mi    16H 53M 0S</span></span>
<span id="cb208-18"><a href="dplyr.html#cb208-18" tabindex="-1"></a><span class="do">## # ℹ 12,402 more rows</span></span></code></pre></div>
</div>
<div id="filter" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> <code>filter()</code><a href="dplyr.html#filter" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Some of our analysis requires us to have complete years in our data. If we want
to compare the police reports by year, it makes no sense to compare the numbers
for an ongoing year with those that are complete, since the former will
obviously have fewer reports. Incomplete years would also impact analysis by
month, as some months will have more observations than others; therefore, we
should filter our data for complete years.</p>
<p>To filter the observations, we can use the function <code>filter()</code>. As always in
<strong>tidyverse</strong> functions, <code>filter()</code> takes the data to be filtered as its first
argument and one or multiple expressions that specify the rules by which to
filter. To write these expressions, we can make use of the comparison operators
discussed in subchapter <a href="R1.html#comparison">1.3.2</a>.</p>
<p>To filter for all years that are not 2025, we can write:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="dplyr.html#cb209-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb209-2"><a href="dplyr.html#cb209-2" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">!=</span> <span class="dv">2025</span>)</span>
<span id="cb209-3"><a href="dplyr.html#cb209-3" tabindex="-1"></a><span class="do">## # A tibble: 11,912 × 5</span></span>
<span id="cb209-4"><a href="dplyr.html#cb209-4" tabindex="-1"></a><span class="do">##    district                    year month day   time      </span></span>
<span id="cb209-5"><a href="dplyr.html#cb209-5" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb209-6"><a href="dplyr.html#cb209-6" tabindex="-1"></a><span class="do">##  1 Marzahn-Hellersdorf         2024 Okt   Fr    11H 25M 0S</span></span>
<span id="cb209-7"><a href="dplyr.html#cb209-7" tabindex="-1"></a><span class="do">##  2 Mitte                       2024 Sep   Do    11H 30M 0S</span></span>
<span id="cb209-8"><a href="dplyr.html#cb209-8" tabindex="-1"></a><span class="do">##  3 Lichtenberg                 2024 Mai   Mi    14H 7M 0S </span></span>
<span id="cb209-9"><a href="dplyr.html#cb209-9" tabindex="-1"></a><span class="do">##  4 Charlottenburg-Wilmersdorf  2024 Dez   Di    16H 59M 0S</span></span>
<span id="cb209-10"><a href="dplyr.html#cb209-10" tabindex="-1"></a><span class="do">##  5 Charlottenburg-Wilmersdorf  2024 Dez   Di    16H 7M 0S </span></span>
<span id="cb209-11"><a href="dplyr.html#cb209-11" tabindex="-1"></a><span class="do">##  6 Charlottenburg-Wilmersdorf  2024 Dez   Di    13H 46M 0S</span></span>
<span id="cb209-12"><a href="dplyr.html#cb209-12" tabindex="-1"></a><span class="do">##  7 Treptow-Köpenick            2024 Dez   Di    12H 18M 0S</span></span>
<span id="cb209-13"><a href="dplyr.html#cb209-13" tabindex="-1"></a><span class="do">##  8 Lichtenberg                 2024 Dez   Di    11H 56M 0S</span></span>
<span id="cb209-14"><a href="dplyr.html#cb209-14" tabindex="-1"></a><span class="do">##  9 Charlottenburg-Wilmersdorf  2024 Dez   Di    11H 5M 0S </span></span>
<span id="cb209-15"><a href="dplyr.html#cb209-15" tabindex="-1"></a><span class="do">## 10 Steglitz-Zehlendorf         2024 Dez   Mo    16H 58M 0S</span></span>
<span id="cb209-16"><a href="dplyr.html#cb209-16" tabindex="-1"></a><span class="do">## # ℹ 11,902 more rows</span></span></code></pre></div>
<p>Thus, only the observations where “year” does not equal “2025” remain in the
tibble; more accurately, those observations for which the expression
<code>year != 2025</code> is returned as <code>TRUE</code>.</p>
<p>This is all the filtering we will have to do here, but we should still look on
how to filter by multiple values at once, which is an important data
wrangling still to have.</p>
<p>We can chain multiple expressions when using <code>filter()</code> separated by commas.
o for example to reduce the data set to observations from 2024, 2023 and 2022 we
could write:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="dplyr.html#cb210-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb210-2"><a href="dplyr.html#cb210-2" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">!=</span> <span class="dv">2025</span>, year <span class="sc">!=</span> <span class="dv">2021</span>, year <span class="sc">!=</span> <span class="dv">2020</span>)</span>
<span id="cb210-3"><a href="dplyr.html#cb210-3" tabindex="-1"></a><span class="do">## # A tibble: 6,832 × 5</span></span>
<span id="cb210-4"><a href="dplyr.html#cb210-4" tabindex="-1"></a><span class="do">##    district                    year month day   time      </span></span>
<span id="cb210-5"><a href="dplyr.html#cb210-5" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb210-6"><a href="dplyr.html#cb210-6" tabindex="-1"></a><span class="do">##  1 Marzahn-Hellersdorf         2024 Okt   Fr    11H 25M 0S</span></span>
<span id="cb210-7"><a href="dplyr.html#cb210-7" tabindex="-1"></a><span class="do">##  2 Mitte                       2024 Sep   Do    11H 30M 0S</span></span>
<span id="cb210-8"><a href="dplyr.html#cb210-8" tabindex="-1"></a><span class="do">##  3 Lichtenberg                 2024 Mai   Mi    14H 7M 0S </span></span>
<span id="cb210-9"><a href="dplyr.html#cb210-9" tabindex="-1"></a><span class="do">##  4 Charlottenburg-Wilmersdorf  2024 Dez   Di    16H 59M 0S</span></span>
<span id="cb210-10"><a href="dplyr.html#cb210-10" tabindex="-1"></a><span class="do">##  5 Charlottenburg-Wilmersdorf  2024 Dez   Di    16H 7M 0S </span></span>
<span id="cb210-11"><a href="dplyr.html#cb210-11" tabindex="-1"></a><span class="do">##  6 Charlottenburg-Wilmersdorf  2024 Dez   Di    13H 46M 0S</span></span>
<span id="cb210-12"><a href="dplyr.html#cb210-12" tabindex="-1"></a><span class="do">##  7 Treptow-Köpenick            2024 Dez   Di    12H 18M 0S</span></span>
<span id="cb210-13"><a href="dplyr.html#cb210-13" tabindex="-1"></a><span class="do">##  8 Lichtenberg                 2024 Dez   Di    11H 56M 0S</span></span>
<span id="cb210-14"><a href="dplyr.html#cb210-14" tabindex="-1"></a><span class="do">##  9 Charlottenburg-Wilmersdorf  2024 Dez   Di    11H 5M 0S </span></span>
<span id="cb210-15"><a href="dplyr.html#cb210-15" tabindex="-1"></a><span class="do">## 10 Steglitz-Zehlendorf         2024 Dez   Mo    16H 58M 0S</span></span>
<span id="cb210-16"><a href="dplyr.html#cb210-16" tabindex="-1"></a><span class="do">## # ℹ 6,822 more rows</span></span></code></pre></div>
<p>Here we are excluding every observation that does not lie between 2022–2024.</p>
<p>Often there are multiple ways to formulate the filtering expressions. Here, we
could tell R which values for “year” we want to keep, instead of which we do not
want to keep. Instead of listing all those individual years, we can use <code>%in%</code>
to define a range of numerical values which should be kept when filtering. We
assign the result to a new object for later use.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="dplyr.html#cb211-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb211-2"><a href="dplyr.html#cb211-2" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="dv">2022</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb211-3"><a href="dplyr.html#cb211-3" tabindex="-1"></a><span class="do">## # A tibble: 6,832 × 5</span></span>
<span id="cb211-4"><a href="dplyr.html#cb211-4" tabindex="-1"></a><span class="do">##    district                    year month day   time      </span></span>
<span id="cb211-5"><a href="dplyr.html#cb211-5" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb211-6"><a href="dplyr.html#cb211-6" tabindex="-1"></a><span class="do">##  1 Marzahn-Hellersdorf         2024 Okt   Fr    11H 25M 0S</span></span>
<span id="cb211-7"><a href="dplyr.html#cb211-7" tabindex="-1"></a><span class="do">##  2 Mitte                       2024 Sep   Do    11H 30M 0S</span></span>
<span id="cb211-8"><a href="dplyr.html#cb211-8" tabindex="-1"></a><span class="do">##  3 Lichtenberg                 2024 Mai   Mi    14H 7M 0S </span></span>
<span id="cb211-9"><a href="dplyr.html#cb211-9" tabindex="-1"></a><span class="do">##  4 Charlottenburg-Wilmersdorf  2024 Dez   Di    16H 59M 0S</span></span>
<span id="cb211-10"><a href="dplyr.html#cb211-10" tabindex="-1"></a><span class="do">##  5 Charlottenburg-Wilmersdorf  2024 Dez   Di    16H 7M 0S </span></span>
<span id="cb211-11"><a href="dplyr.html#cb211-11" tabindex="-1"></a><span class="do">##  6 Charlottenburg-Wilmersdorf  2024 Dez   Di    13H 46M 0S</span></span>
<span id="cb211-12"><a href="dplyr.html#cb211-12" tabindex="-1"></a><span class="do">##  7 Treptow-Köpenick            2024 Dez   Di    12H 18M 0S</span></span>
<span id="cb211-13"><a href="dplyr.html#cb211-13" tabindex="-1"></a><span class="do">##  8 Lichtenberg                 2024 Dez   Di    11H 56M 0S</span></span>
<span id="cb211-14"><a href="dplyr.html#cb211-14" tabindex="-1"></a><span class="do">##  9 Charlottenburg-Wilmersdorf  2024 Dez   Di    11H 5M 0S </span></span>
<span id="cb211-15"><a href="dplyr.html#cb211-15" tabindex="-1"></a><span class="do">## 10 Steglitz-Zehlendorf         2024 Dez   Mo    16H 58M 0S</span></span>
<span id="cb211-16"><a href="dplyr.html#cb211-16" tabindex="-1"></a><span class="do">## # ℹ 6,822 more rows</span></span></code></pre></div>
<p>While the <code>,</code> behaves like the logical operator <code>&amp;</code>, we can also use <code>|</code> for
“OR” when combining expressions to be filtered upon.</p>
<p>For example we could use <code>|</code> to select the same years in this way:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="dplyr.html#cb212-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb212-2"><a href="dplyr.html#cb212-2" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2022</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">2023</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">2024</span>)</span>
<span id="cb212-3"><a href="dplyr.html#cb212-3" tabindex="-1"></a><span class="do">## # A tibble: 6,832 × 5</span></span>
<span id="cb212-4"><a href="dplyr.html#cb212-4" tabindex="-1"></a><span class="do">##    district                    year month day   time      </span></span>
<span id="cb212-5"><a href="dplyr.html#cb212-5" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb212-6"><a href="dplyr.html#cb212-6" tabindex="-1"></a><span class="do">##  1 Marzahn-Hellersdorf         2024 Okt   Fr    11H 25M 0S</span></span>
<span id="cb212-7"><a href="dplyr.html#cb212-7" tabindex="-1"></a><span class="do">##  2 Mitte                       2024 Sep   Do    11H 30M 0S</span></span>
<span id="cb212-8"><a href="dplyr.html#cb212-8" tabindex="-1"></a><span class="do">##  3 Lichtenberg                 2024 Mai   Mi    14H 7M 0S </span></span>
<span id="cb212-9"><a href="dplyr.html#cb212-9" tabindex="-1"></a><span class="do">##  4 Charlottenburg-Wilmersdorf  2024 Dez   Di    16H 59M 0S</span></span>
<span id="cb212-10"><a href="dplyr.html#cb212-10" tabindex="-1"></a><span class="do">##  5 Charlottenburg-Wilmersdorf  2024 Dez   Di    16H 7M 0S </span></span>
<span id="cb212-11"><a href="dplyr.html#cb212-11" tabindex="-1"></a><span class="do">##  6 Charlottenburg-Wilmersdorf  2024 Dez   Di    13H 46M 0S</span></span>
<span id="cb212-12"><a href="dplyr.html#cb212-12" tabindex="-1"></a><span class="do">##  7 Treptow-Köpenick            2024 Dez   Di    12H 18M 0S</span></span>
<span id="cb212-13"><a href="dplyr.html#cb212-13" tabindex="-1"></a><span class="do">##  8 Lichtenberg                 2024 Dez   Di    11H 56M 0S</span></span>
<span id="cb212-14"><a href="dplyr.html#cb212-14" tabindex="-1"></a><span class="do">##  9 Charlottenburg-Wilmersdorf  2024 Dez   Di    11H 5M 0S </span></span>
<span id="cb212-15"><a href="dplyr.html#cb212-15" tabindex="-1"></a><span class="do">## 10 Steglitz-Zehlendorf         2024 Dez   Mo    16H 58M 0S</span></span>
<span id="cb212-16"><a href="dplyr.html#cb212-16" tabindex="-1"></a><span class="do">## # ℹ 6,822 more rows</span></span></code></pre></div>
<p>It is important to keep in mind the differences between AND and OR here.
If we would have used <code>&amp;</code> or <code>,</code> to chain these expressions instead, the
following would have happened:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="dplyr.html#cb213-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb213-2"><a href="dplyr.html#cb213-2" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2022</span>, year <span class="sc">==</span> <span class="dv">2023</span>, year <span class="sc">==</span> <span class="dv">2024</span>)</span>
<span id="cb213-3"><a href="dplyr.html#cb213-3" tabindex="-1"></a><span class="do">## # A tibble: 0 × 5</span></span>
<span id="cb213-4"><a href="dplyr.html#cb213-4" tabindex="-1"></a><span class="do">## # ℹ 5 variables: district &lt;chr&gt;, year &lt;dbl&gt;, month &lt;ord&gt;, day &lt;ord&gt;,</span></span>
<span id="cb213-5"><a href="dplyr.html#cb213-5" tabindex="-1"></a><span class="do">## #   time &lt;Period&gt;</span></span></code></pre></div>
<p>We are left with nothing in our data set. This happens because the expression in
<code>filter()</code> is now searching for observations who are <strong>at the same time</strong> from
2022, 2023 <em>and</em> 2024. This is obviously impossible.</p>
<p>Let us now actually remove the observations for 2025 from the saved object.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="dplyr.html#cb214-1" tabindex="-1"></a>reports_fyears <span class="ot">&lt;-</span> reports <span class="sc">%&gt;%</span> </span>
<span id="cb214-2"><a href="dplyr.html#cb214-2" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">!=</span> <span class="dv">2025</span>)</span></code></pre></div>
</div>
<div id="summarise-group_by" class="section level2 hasAnchor" number="11.5">
<h2><span class="header-section-number">11.5</span> <code>summarise()</code> &amp; <code>group_by()</code><a href="dplyr.html#summarise-group_by" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can now begin computing some basic summary statistics for our data. You
should note though, that we do not know how the data we scraped is actually
created. Do the dates and times on the website refer to the instance in time
when a crime occurred – there are indications that this is not the case –,
when a report was filed, or even when the PR team of the Berlin police uploaded
the report to the website – which might even be the most plausible scenario?
Also, are all crimes reported on this website – the daily numbers are too low
for this to be the case – or is there an internal selection process? And if so,
on what criteria does the selection occur? If this was a real research project,
we would absolutely need to gain clarity on these and many other questions,
before we even begin with collecting the data. We do not have clarity here, but
we have to keep in mind that we may not analyse the statistical distribution of
crimes in Berlin, but rather the working practice of the PR team.</p>
<div id="number-of-reports-by-groups" class="section level3 hasAnchor" number="11.5.1">
<h3><span class="header-section-number">11.5.1</span> Number of reports by groups<a href="dplyr.html#number-of-reports-by-groups" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The dplyr function <code>summarise()</code> can be used to calculate summary statistics for
a whole tibble; the syntax being similar to <code>mutate()</code>. The result is a new
tibble, containing only the summary statistics we requested. The function we use
for the summary statistic here is <code>n()</code>, which returns the number of
observations. As each observation represents one police report, this equals the
overall number of reports.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="dplyr.html#cb215-1" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb215-2"><a href="dplyr.html#cb215-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb215-3"><a href="dplyr.html#cb215-3" tabindex="-1"></a><span class="do">## # A tibble: 1 × 1</span></span>
<span id="cb215-4"><a href="dplyr.html#cb215-4" tabindex="-1"></a><span class="do">##   reports</span></span>
<span id="cb215-5"><a href="dplyr.html#cb215-5" tabindex="-1"></a><span class="do">##     &lt;int&gt;</span></span>
<span id="cb215-6"><a href="dplyr.html#cb215-6" tabindex="-1"></a><span class="do">## 1   11912</span></span></code></pre></div>
<p>This worked, but is not very interesting, as the result is the same as the length
of the reports tibble. We are often more interested in summaries grouped by the
value of one or more other variables. We might ask ourselves, if there are
differences in the number of released police reports by year; for this purpose,
we can group the data by the values of the “year” column using <code>group_by()</code> and
then compute the summary statistic separately for each group. Here, <code>n()</code>
returns the number of observations for each group, i.e. the number of reports
per year. As always with <strong>dplyr</strong> functions, <code>group_by()</code> needs the data which
will be grouped as the first argument, followed by one or multiple columns to
group by.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="dplyr.html#cb216-1" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb216-2"><a href="dplyr.html#cb216-2" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb216-3"><a href="dplyr.html#cb216-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb216-4"><a href="dplyr.html#cb216-4" tabindex="-1"></a><span class="do">## # A tibble: 5 × 2</span></span>
<span id="cb216-5"><a href="dplyr.html#cb216-5" tabindex="-1"></a><span class="do">##    year reports</span></span>
<span id="cb216-6"><a href="dplyr.html#cb216-6" tabindex="-1"></a><span class="do">##   &lt;dbl&gt;   &lt;int&gt;</span></span>
<span id="cb216-7"><a href="dplyr.html#cb216-7" tabindex="-1"></a><span class="do">## 1  2020    2581</span></span>
<span id="cb216-8"><a href="dplyr.html#cb216-8" tabindex="-1"></a><span class="do">## 2  2021    2499</span></span>
<span id="cb216-9"><a href="dplyr.html#cb216-9" tabindex="-1"></a><span class="do">## 3  2022    2235</span></span>
<span id="cb216-10"><a href="dplyr.html#cb216-10" tabindex="-1"></a><span class="do">## 4  2023    2196</span></span>
<span id="cb216-11"><a href="dplyr.html#cb216-11" tabindex="-1"></a><span class="do">## 5  2024    2401</span></span></code></pre></div>
<p>While there are differences between the years, there does not seem to be a clear and
systematic pattern to it. We can do the same kind of analysis grouped by months
and weekdays.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="dplyr.html#cb217-1" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb217-2"><a href="dplyr.html#cb217-2" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> </span>
<span id="cb217-3"><a href="dplyr.html#cb217-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb217-4"><a href="dplyr.html#cb217-4" tabindex="-1"></a><span class="do">## # A tibble: 12 × 2</span></span>
<span id="cb217-5"><a href="dplyr.html#cb217-5" tabindex="-1"></a><span class="do">##    month reports</span></span>
<span id="cb217-6"><a href="dplyr.html#cb217-6" tabindex="-1"></a><span class="do">##    &lt;ord&gt;   &lt;int&gt;</span></span>
<span id="cb217-7"><a href="dplyr.html#cb217-7" tabindex="-1"></a><span class="do">##  1 Jan      1013</span></span>
<span id="cb217-8"><a href="dplyr.html#cb217-8" tabindex="-1"></a><span class="do">##  2 Feb       859</span></span>
<span id="cb217-9"><a href="dplyr.html#cb217-9" tabindex="-1"></a><span class="do">##  3 Mär      1020</span></span>
<span id="cb217-10"><a href="dplyr.html#cb217-10" tabindex="-1"></a><span class="do">##  4 Apr      1092</span></span>
<span id="cb217-11"><a href="dplyr.html#cb217-11" tabindex="-1"></a><span class="do">##  5 Mai      1089</span></span>
<span id="cb217-12"><a href="dplyr.html#cb217-12" tabindex="-1"></a><span class="do">##  6 Jun      1015</span></span>
<span id="cb217-13"><a href="dplyr.html#cb217-13" tabindex="-1"></a><span class="do">##  7 Jul      1006</span></span>
<span id="cb217-14"><a href="dplyr.html#cb217-14" tabindex="-1"></a><span class="do">##  8 Aug      1009</span></span>
<span id="cb217-15"><a href="dplyr.html#cb217-15" tabindex="-1"></a><span class="do">##  9 Sep       975</span></span>
<span id="cb217-16"><a href="dplyr.html#cb217-16" tabindex="-1"></a><span class="do">## 10 Okt       964</span></span>
<span id="cb217-17"><a href="dplyr.html#cb217-17" tabindex="-1"></a><span class="do">## 11 Nov       957</span></span>
<span id="cb217-18"><a href="dplyr.html#cb217-18" tabindex="-1"></a><span class="do">## 12 Dez       913</span></span>
<span id="cb217-19"><a href="dplyr.html#cb217-19" tabindex="-1"></a></span>
<span id="cb217-20"><a href="dplyr.html#cb217-20" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb217-21"><a href="dplyr.html#cb217-21" tabindex="-1"></a>  <span class="fu">group_by</span>(day) <span class="sc">%&gt;%</span> </span>
<span id="cb217-22"><a href="dplyr.html#cb217-22" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb217-23"><a href="dplyr.html#cb217-23" tabindex="-1"></a><span class="do">## # A tibble: 7 × 2</span></span>
<span id="cb217-24"><a href="dplyr.html#cb217-24" tabindex="-1"></a><span class="do">##   day   reports</span></span>
<span id="cb217-25"><a href="dplyr.html#cb217-25" tabindex="-1"></a><span class="do">##   &lt;ord&gt;   &lt;int&gt;</span></span>
<span id="cb217-26"><a href="dplyr.html#cb217-26" tabindex="-1"></a><span class="do">## 1 So       1568</span></span>
<span id="cb217-27"><a href="dplyr.html#cb217-27" tabindex="-1"></a><span class="do">## 2 Mo       1608</span></span>
<span id="cb217-28"><a href="dplyr.html#cb217-28" tabindex="-1"></a><span class="do">## 3 Di       1772</span></span>
<span id="cb217-29"><a href="dplyr.html#cb217-29" tabindex="-1"></a><span class="do">## 4 Mi       1834</span></span>
<span id="cb217-30"><a href="dplyr.html#cb217-30" tabindex="-1"></a><span class="do">## 5 Do       1870</span></span>
<span id="cb217-31"><a href="dplyr.html#cb217-31" tabindex="-1"></a><span class="do">## 6 Fr       1754</span></span>
<span id="cb217-32"><a href="dplyr.html#cb217-32" tabindex="-1"></a><span class="do">## 7 Sa       1506</span></span></code></pre></div>
<p>The analysis by month again shows no systematic variation (that February has less reports
will moist probably come down to the shorter length of the month). Looking at the
reports by day of the week on the other hand, shows a slight increase in reports
over the week, culminating on Thursday As stated above, we do not really know
how the data is created, so the main point to take away from this analysis might
be, that the PR team of the Berlin police also works on the weekend, but with fewer
working hours.</p>
<p>In the same manner, we can analyse the number of released police reports by
district.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="dplyr.html#cb218-1" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb218-2"><a href="dplyr.html#cb218-2" tabindex="-1"></a>  <span class="fu">group_by</span>(district) <span class="sc">%&gt;%</span> </span>
<span id="cb218-3"><a href="dplyr.html#cb218-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">reports =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb218-4"><a href="dplyr.html#cb218-4" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(reports))</span>
<span id="cb218-5"><a href="dplyr.html#cb218-5" tabindex="-1"></a><span class="do">## # A tibble: 16 × 2</span></span>
<span id="cb218-6"><a href="dplyr.html#cb218-6" tabindex="-1"></a><span class="do">##    district                   reports</span></span>
<span id="cb218-7"><a href="dplyr.html#cb218-7" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                        &lt;int&gt;</span></span>
<span id="cb218-8"><a href="dplyr.html#cb218-8" tabindex="-1"></a><span class="do">##  1 Mitte                         1723</span></span>
<span id="cb218-9"><a href="dplyr.html#cb218-9" tabindex="-1"></a><span class="do">##  2 Friedrichshain-Kreuzberg      1244</span></span>
<span id="cb218-10"><a href="dplyr.html#cb218-10" tabindex="-1"></a><span class="do">##  3 Neukölln                      1064</span></span>
<span id="cb218-11"><a href="dplyr.html#cb218-11" tabindex="-1"></a><span class="do">##  4 Charlottenburg-Wilmersdorf    1059</span></span>
<span id="cb218-12"><a href="dplyr.html#cb218-12" tabindex="-1"></a><span class="do">##  5 Tempelhof-Schöneberg           872</span></span>
<span id="cb218-13"><a href="dplyr.html#cb218-13" tabindex="-1"></a><span class="do">##  6 Pankow                         869</span></span>
<span id="cb218-14"><a href="dplyr.html#cb218-14" tabindex="-1"></a><span class="do">##  7 Lichtenberg                    757</span></span>
<span id="cb218-15"><a href="dplyr.html#cb218-15" tabindex="-1"></a><span class="do">##  8 Treptow-Köpenick               737</span></span>
<span id="cb218-16"><a href="dplyr.html#cb218-16" tabindex="-1"></a><span class="do">##  9 Spandau                        718</span></span>
<span id="cb218-17"><a href="dplyr.html#cb218-17" tabindex="-1"></a><span class="do">## 10 Marzahn-Hellersdorf            677</span></span>
<span id="cb218-18"><a href="dplyr.html#cb218-18" tabindex="-1"></a><span class="do">## 11 Reinickendorf                  650</span></span>
<span id="cb218-19"><a href="dplyr.html#cb218-19" tabindex="-1"></a><span class="do">## 12 Steglitz-Zehlendorf            566</span></span>
<span id="cb218-20"><a href="dplyr.html#cb218-20" tabindex="-1"></a><span class="do">## 13 bezirksübergreifend            463</span></span>
<span id="cb218-21"><a href="dplyr.html#cb218-21" tabindex="-1"></a><span class="do">## 14 berlinweit                     379</span></span>
<span id="cb218-22"><a href="dplyr.html#cb218-22" tabindex="-1"></a><span class="do">## 15 &lt;NA&gt;                            79</span></span>
<span id="cb218-23"><a href="dplyr.html#cb218-23" tabindex="-1"></a><span class="do">## 16 bundesweit                      55</span></span></code></pre></div>
<p>For the grouped summary we also included <code>arrange(desc())</code> which orders the values
from highest to lowest. If you omit <code>desc()</code> the results are ordered
ascending.</p>
<p>We might also be interested in the relative share of reports by district. To
compute those, one option is to add another column to the tibble resulting from
<code>summarise()</code>, in which we calculate the relative share by dividing the
“reports” columns values by the total of this column.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="dplyr.html#cb219-1" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb219-2"><a href="dplyr.html#cb219-2" tabindex="-1"></a>  <span class="fu">group_by</span>(district) <span class="sc">%&gt;%</span> </span>
<span id="cb219-3"><a href="dplyr.html#cb219-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">reports =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb219-4"><a href="dplyr.html#cb219-4" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(reports)) <span class="sc">%&gt;%</span> </span>
<span id="cb219-5"><a href="dplyr.html#cb219-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reports_rel =</span> reports <span class="sc">/</span> <span class="fu">sum</span>(reports))</span>
<span id="cb219-6"><a href="dplyr.html#cb219-6" tabindex="-1"></a><span class="do">## # A tibble: 16 × 3</span></span>
<span id="cb219-7"><a href="dplyr.html#cb219-7" tabindex="-1"></a><span class="do">##    district                   reports reports_rel</span></span>
<span id="cb219-8"><a href="dplyr.html#cb219-8" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                        &lt;int&gt;       &lt;dbl&gt;</span></span>
<span id="cb219-9"><a href="dplyr.html#cb219-9" tabindex="-1"></a><span class="do">##  1 Mitte                         1723     0.145  </span></span>
<span id="cb219-10"><a href="dplyr.html#cb219-10" tabindex="-1"></a><span class="do">##  2 Friedrichshain-Kreuzberg      1244     0.104  </span></span>
<span id="cb219-11"><a href="dplyr.html#cb219-11" tabindex="-1"></a><span class="do">##  3 Neukölln                      1064     0.0893 </span></span>
<span id="cb219-12"><a href="dplyr.html#cb219-12" tabindex="-1"></a><span class="do">##  4 Charlottenburg-Wilmersdorf    1059     0.0889 </span></span>
<span id="cb219-13"><a href="dplyr.html#cb219-13" tabindex="-1"></a><span class="do">##  5 Tempelhof-Schöneberg           872     0.0732 </span></span>
<span id="cb219-14"><a href="dplyr.html#cb219-14" tabindex="-1"></a><span class="do">##  6 Pankow                         869     0.0730 </span></span>
<span id="cb219-15"><a href="dplyr.html#cb219-15" tabindex="-1"></a><span class="do">##  7 Lichtenberg                    757     0.0635 </span></span>
<span id="cb219-16"><a href="dplyr.html#cb219-16" tabindex="-1"></a><span class="do">##  8 Treptow-Köpenick               737     0.0619 </span></span>
<span id="cb219-17"><a href="dplyr.html#cb219-17" tabindex="-1"></a><span class="do">##  9 Spandau                        718     0.0603 </span></span>
<span id="cb219-18"><a href="dplyr.html#cb219-18" tabindex="-1"></a><span class="do">## 10 Marzahn-Hellersdorf            677     0.0568 </span></span>
<span id="cb219-19"><a href="dplyr.html#cb219-19" tabindex="-1"></a><span class="do">## 11 Reinickendorf                  650     0.0546 </span></span>
<span id="cb219-20"><a href="dplyr.html#cb219-20" tabindex="-1"></a><span class="do">## 12 Steglitz-Zehlendorf            566     0.0475 </span></span>
<span id="cb219-21"><a href="dplyr.html#cb219-21" tabindex="-1"></a><span class="do">## 13 bezirksübergreifend            463     0.0389 </span></span>
<span id="cb219-22"><a href="dplyr.html#cb219-22" tabindex="-1"></a><span class="do">## 14 berlinweit                     379     0.0318 </span></span>
<span id="cb219-23"><a href="dplyr.html#cb219-23" tabindex="-1"></a><span class="do">## 15 &lt;NA&gt;                            79     0.00663</span></span>
<span id="cb219-24"><a href="dplyr.html#cb219-24" tabindex="-1"></a><span class="do">## 16 bundesweit                      55     0.00462</span></span></code></pre></div>
<p>The results show clear differences in the number of reports by
district, with “Mitte” leading by a substantial margin. Other districts with
high counts seem to be those that at least in part lie within the inner ring.
The outer districts all show lower numbers.
Again, we do not know how the data is created, so maybe it is just the
case that the crimes in the inner ring are more interesting than in other
districts and that the data does not necessarily point to a higher number of
crimes in central Berlin. To get a more complete picture, we would also have to
relate the number of reports to the citizens or even tourists per district. For
this we would need additional external data though.</p>
<p>Using <code>group_by()</code> we can also group by multiple columns. “Mitte” and
“Friedrichshain-Kreuzberg” showed the highest numbers among all districts. Let
us analyse if these numbers changed over the years for these two districts.
First we have to use <code>filter()</code> to use only the observations referring to those
districts and then group the data by the remaining districts and year before we
count the the number of released reports.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="dplyr.html#cb220-1" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb220-2"><a href="dplyr.html#cb220-2" tabindex="-1"></a>  <span class="fu">filter</span>(district <span class="sc">==</span> <span class="st">&quot;Mitte&quot;</span> <span class="sc">|</span> district <span class="sc">==</span> <span class="st">&quot;Friedrichshain-Kreuzberg&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb220-3"><a href="dplyr.html#cb220-3" tabindex="-1"></a>  <span class="fu">group_by</span>(district, year) <span class="sc">%&gt;%</span> </span>
<span id="cb220-4"><a href="dplyr.html#cb220-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb220-5"><a href="dplyr.html#cb220-5" tabindex="-1"></a><span class="do">## `summarise()` has grouped output by &#39;district&#39;. You can override using the</span></span>
<span id="cb220-6"><a href="dplyr.html#cb220-6" tabindex="-1"></a><span class="do">## `.groups` argument.</span></span>
<span id="cb220-7"><a href="dplyr.html#cb220-7" tabindex="-1"></a><span class="do">## # A tibble: 10 × 3</span></span>
<span id="cb220-8"><a href="dplyr.html#cb220-8" tabindex="-1"></a><span class="do">## # Groups:   district [2]</span></span>
<span id="cb220-9"><a href="dplyr.html#cb220-9" tabindex="-1"></a><span class="do">##    district                  year reports</span></span>
<span id="cb220-10"><a href="dplyr.html#cb220-10" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                    &lt;dbl&gt;   &lt;int&gt;</span></span>
<span id="cb220-11"><a href="dplyr.html#cb220-11" tabindex="-1"></a><span class="do">##  1 Friedrichshain-Kreuzberg  2020     301</span></span>
<span id="cb220-12"><a href="dplyr.html#cb220-12" tabindex="-1"></a><span class="do">##  2 Friedrichshain-Kreuzberg  2021     312</span></span>
<span id="cb220-13"><a href="dplyr.html#cb220-13" tabindex="-1"></a><span class="do">##  3 Friedrichshain-Kreuzberg  2022     190</span></span>
<span id="cb220-14"><a href="dplyr.html#cb220-14" tabindex="-1"></a><span class="do">##  4 Friedrichshain-Kreuzberg  2023     210</span></span>
<span id="cb220-15"><a href="dplyr.html#cb220-15" tabindex="-1"></a><span class="do">##  5 Friedrichshain-Kreuzberg  2024     231</span></span>
<span id="cb220-16"><a href="dplyr.html#cb220-16" tabindex="-1"></a><span class="do">##  6 Mitte                     2020     374</span></span>
<span id="cb220-17"><a href="dplyr.html#cb220-17" tabindex="-1"></a><span class="do">##  7 Mitte                     2021     328</span></span>
<span id="cb220-18"><a href="dplyr.html#cb220-18" tabindex="-1"></a><span class="do">##  8 Mitte                     2022     318</span></span>
<span id="cb220-19"><a href="dplyr.html#cb220-19" tabindex="-1"></a><span class="do">##  9 Mitte                     2023     333</span></span>
<span id="cb220-20"><a href="dplyr.html#cb220-20" tabindex="-1"></a><span class="do">## 10 Mitte                     2024     370</span></span></code></pre></div>
<p>Looking at “Friedrichshain-Kreuzberg” we can observe a substantial decrease in
reports starting from 2022. The same is not true for “Mitte” which despite of a
moderate temporal decrease seems to be relatively stable in the number of reports.
To analyse
this further, we had to go deeper into the data and look at the actual texts of
the police reports.</p>
<p>But we should briefly talk about a peculiarity to the way <code>group_by()</code> works
with <code>summarise()</code> that can cause headaches, if we are not aware of it. In
general, any <code>summarise()</code> function following a <code>group_by()</code> will calculate the
summary statistic and then remove one level of grouping. In the examples where
we only had one level of grouping, this essentially meant, that the data was
ungrouped after <code>summarise()</code>. In the last example we had two levels of
grouping. So, after the computation of the number of reports by “district” and
“year” the grouping by “year” was removed, but the grouping by “district”
remained in effect. We can see this in the output, where R informs us about the
column by which the data are grouped and the number of groups in the output:
<code># Groups:   district [2]</code>. Another <code>summarise()</code> function would compute the
statistic by “district” and then remove this level as well. We can also use
<code>ungroup()</code> to remove all grouping from a tibble. In the case of this example,
it does not make a practical difference as we only compute the summary and then
move on. But, if we assign the results of a summary to an object for later use,
we have to decide if we want to remove the grouping or keep it in effect,
depending on the goals of the analysis. In general, I would always ungroup the
data and group it again if the need arises, as this is less error prone and just
a minor increase in the amount of typing needed.</p>
</div>
<div id="summary-statistics-on-the-time" class="section level3 hasAnchor" number="11.5.2">
<h3><span class="header-section-number">11.5.2</span> Summary statistics on the time<a href="dplyr.html#summary-statistics-on-the-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The column “time” holds the time of day for each report in hours, minutes and
seconds as a representation of the actual values, which are seconds from
midnight.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="dplyr.html#cb221-1" tabindex="-1"></a>reports_fyears[[<span class="dv">1</span>, <span class="st">&#39;time&#39;</span>]]</span>
<span id="cb221-2"><a href="dplyr.html#cb221-2" tabindex="-1"></a><span class="do">## [1] &quot;11H 25M 0S&quot;</span></span>
<span id="cb221-3"><a href="dplyr.html#cb221-3" tabindex="-1"></a></span>
<span id="cb221-4"><a href="dplyr.html#cb221-4" tabindex="-1"></a>reports_fyears[[<span class="dv">1</span>, <span class="st">&#39;time&#39;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb221-5"><a href="dplyr.html#cb221-5" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb221-6"><a href="dplyr.html#cb221-6" tabindex="-1"></a><span class="do">## [1] 41100</span></span></code></pre></div>
<p>To calculate with the “time” column, we first have to tell R that we explicitly
want to use the data as seconds, then compute the summary statistic and after
this, transform the display of seconds back into the time of day. For the
transformations we can use the functions <code>period_to_seconds()</code> and
<code>seconds_to_period()</code>. We will calculate the mean and the median for the time of
day over all police reports in one call of <code>summarise()</code>.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="dplyr.html#cb222-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb222-2"><a href="dplyr.html#cb222-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">period_to_seconds</span>(time) <span class="sc">%&gt;%</span> </span>
<span id="cb222-3"><a href="dplyr.html#cb222-3" tabindex="-1"></a>              <span class="fu">mean</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb222-4"><a href="dplyr.html#cb222-4" tabindex="-1"></a>              <span class="fu">seconds_to_period</span>(),</span>
<span id="cb222-5"><a href="dplyr.html#cb222-5" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">period_to_seconds</span>(time) <span class="sc">%&gt;%</span> </span>
<span id="cb222-6"><a href="dplyr.html#cb222-6" tabindex="-1"></a>              <span class="fu">median</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb222-7"><a href="dplyr.html#cb222-7" tabindex="-1"></a>              <span class="fu">seconds_to_period</span>()</span>
<span id="cb222-8"><a href="dplyr.html#cb222-8" tabindex="-1"></a>  )</span>
<span id="cb222-9"><a href="dplyr.html#cb222-9" tabindex="-1"></a><span class="do">## # A tibble: 1 × 2</span></span>
<span id="cb222-10"><a href="dplyr.html#cb222-10" tabindex="-1"></a><span class="do">##   mean                      median   </span></span>
<span id="cb222-11"><a href="dplyr.html#cb222-11" tabindex="-1"></a><span class="do">##   &lt;Period&gt;                  &lt;Period&gt; </span></span>
<span id="cb222-12"><a href="dplyr.html#cb222-12" tabindex="-1"></a><span class="do">## 1 12H 31M 10.2336448598144S 12H 4M 0S</span></span></code></pre></div>
<p>The mean time of day over all police reports is about 12:28 while the median is
12:01. This may indicate that the mean is biased towards a later time by a high
number of very late reports. We will explore this further graphically in the next
chapter. Again, the results may represent the time when crimes occur, but it is
more likely, that we are actually analysing the time when the PR team posts
their police reports.</p>
</div>
</div>
<div id="exporting-tables" class="section level2 hasAnchor" number="11.6">
<h2><span class="header-section-number">11.6</span> Exporting tables<a href="dplyr.html#exporting-tables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Exporting the results of our analysis – e.g. summary statistics computed with
<code>summarise()</code> – sadly is not as straightforward as one might think or hope. We
can always copy and paste values from the output into Word or other pieces of
software we might use for writing a report. But this is cumbersome and error
prone.</p>
<p>One way of directly exporting tables we already know about is writing them to a
.csv file. For more on this please review section <a href="files.html#CSV">8.1</a>. These can be
imported into Excel and also directly into Word. This
may be a quick way of exporting the values of a table and importing them into
Office, but we have to do all the formatting in the external software and may
have to repeat the formatting procedure every time the values change. So we
should make sure that all errors have been fixed and the analysis is final
before exporting to .csv.</p>
<p>In this example we save the number of police reports by year for the districts
“Mitte” and “Friedrichshain-Kreuzberg” we computed earlier into a .csv file:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="dplyr.html#cb223-1" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb223-2"><a href="dplyr.html#cb223-2" tabindex="-1"></a>  <span class="fu">filter</span>(district <span class="sc">==</span> <span class="st">&quot;Mitte&quot;</span> <span class="sc">|</span> district <span class="sc">==</span> <span class="st">&quot;Friedrichshain-Kreuzberg&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb223-3"><a href="dplyr.html#cb223-3" tabindex="-1"></a>  <span class="fu">group_by</span>(district, year) <span class="sc">%&gt;%</span> </span>
<span id="cb223-4"><a href="dplyr.html#cb223-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">reports =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb223-5"><a href="dplyr.html#cb223-5" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;reports_year_M-FK.csv&quot;</span>)</span>
<span id="cb223-6"><a href="dplyr.html#cb223-6" tabindex="-1"></a><span class="do">## `summarise()` has grouped output by &#39;district&#39;. You can override using the</span></span>
<span id="cb223-7"><a href="dplyr.html#cb223-7" tabindex="-1"></a><span class="do">## `.groups` argument.</span></span></code></pre></div>
<p>For reasons unknown to anyone but Microsoft, importing a .csv file that uses
commas as the delimiter can actually be quite tricky on a German Windows
installation if you are using Microsoft Office. Using Libre Office fixes this,
but if you want to use Microsoft Office on a German system you might have to use
semicolons as the delimiter by saving the file with <code>write_csv2()</code>.</p>
<div id="further-resources" class="section level3 hasAnchor" number="11.6.1">
<h3><span class="header-section-number">11.6.1</span> Further resources<a href="dplyr.html#further-resources" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A multitude of packages that provide functions for formatting and writing tables
to different formats exist in the R world. To go into details is beyond the
scope of this introduction, but I want to give you some pointers at least.</p>
<p>If you want to skip importing a .csv into Microsoft Office, you may be
interested in packages that allow writing directly to .xlsx files. Two options
are:</p>
<ul>
<li><strong>writexl</strong>: <a href="https://cran.r-project.org/web/packages/writexl/index.html" target="_blank">https://cran.r-project.org/web/packages/writexl/index.html</a></li>
<li><strong>openxlsx</strong>: <a href="https://cran.r-project.org/web/packages/openxlsx/index.html" target="_blank">https://cran.r-project.org/web/packages/openxlsx/index.html</a></li>
</ul>
<p>A way to directly produce tables in the .docx format is provided by the
<strong>flextable</strong> package: <a href="https://davidgohel.github.io/flextable/" target="_blank">https://davidgohel.github.io/flextable/</a></p>
<p>If your are working with LaTeX, the <strong>huxtable</strong> package can directly output .tex
files, as well as HTML, Word, Excel and Powerpoint: <a href="https://hughjonesd.github.io/huxtable/" target="_blank">https://hughjonesd.github.io/huxtable/</a></p>
<p>If you want to circumvent using external software for producing reports
completely, <em>R Markdown</em> may be of interest to you. This allows you to write your
report and your R code in one document and write it to .pdf or a range of other
formats. The produced file includes all the output from your code that you want
to report, i.e. code, plots and tables. Some resources on R Markdown can be
found here:</p>
<ul>
<li>Introduction on the RStudio website: <a href="https://rmarkdown.rstudio.com/lesson-1.html" class="uri">https://rmarkdown.rstudio.com/lesson-1.html</a>{target_“blank”}</li>
<li>The R Markdown cheat sheet: <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/rmarkdown-2.0.pdf" target="_blank">https://raw.githubusercontent.com/rstudio/cheatsheets/master/rmarkdown-2.0.pdf</a></li>
<li>Chapter on R Markdown in “R for Data Science” by Hadley Wickham and Garrett Grolemund: <a href="https://r4ds.had.co.nz/r-markdown.html" target="_blank">https://r4ds.had.co.nz/r-markdown.html</a></li>
<li>“R Markdown Cookbook” by Yihui Xie, Christophe Dervieux, Emily Riederer: <a href="https://bookdown.org/yihui/rmarkdown-cookbook/" target="_blank">https://bookdown.org/yihui/rmarkdown-cookbook/</a></li>
</ul>
<p>The website your are viewing right now, as well as many of the linked resources,
are built with the <strong>bookdown</strong> package, which extends the functionality of R
Markdown and is suited for more large scale projects.</p>
<ul>
<li>“bookdown: Authoring Books and Technical Documents with R Markdown” by Yihui Xie: <a href="https://bookdown.org/yihui/bookdown/" target="_blank">https://bookdown.org/yihui/bookdown/</a></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="scraping.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ggplot.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": false,
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/webscraping-tures/webscraping-tures.github.io/11-dplyr.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
