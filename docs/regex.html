<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Regular expressions | Web Scraping using R</title>
  <meta name="description" content="13 Regular expressions | Web Scraping using R" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Regular expressions | Web Scraping using R" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="jakobtures.github.io/web-scraping/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Regular expressions | Web Scraping using R" />
  
  
  

<meta name="author" content="Jakob Tures" />


<meta name="date" content="2023-10-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ggplot.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/echarts4r-4.8.0/echarts-en.min.js"></script>
<script src="libs/echarts4r-4.8.0/ecStat.min.js"></script>
<script src="libs/echarts4r-4.8.0/dataTool.min.js"></script>
<script src="libs/echarts4r-binding-0.4.5/echarts4r.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
Web Scraping using R

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-web-scraping"><i class="fa fa-check"></i>What is web scraping?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-contents"><i class="fa fa-check"></i>Course contents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#technical-requirements"><i class="fa fa-check"></i>Technical requirements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul></li>
<li class="part"><span><b>I R Basics, tidyverse &amp; R Markdown</b></span></li>
<li class="chapter" data-level="1" data-path="R1.html"><a href="R1.html"><i class="fa fa-check"></i><b>1</b> R &amp; R Studio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="R1.html"><a href="R1.html#installing-r"><i class="fa fa-check"></i><b>1.1</b> Installing R</a></li>
<li class="chapter" data-level="1.2" data-path="R1.html"><a href="R1.html#rstudio"><i class="fa fa-check"></i><b>1.2</b> RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="R1.html"><a href="R1.html#overview"><i class="fa fa-check"></i><b>1.2.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="R1.html"><a href="R1.html#hello-world"><i class="fa fa-check"></i><b>1.3</b> Hello World!</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="R1.html"><a href="R1.html#calculating-with-r"><i class="fa fa-check"></i><b>1.3.1</b> Calculating with R</a></li>
<li class="chapter" data-level="1.3.2" data-path="R1.html"><a href="R1.html#comparison"><i class="fa fa-check"></i><b>1.3.2</b> Comparison operators</a></li>
<li class="chapter" data-level="1.3.3" data-path="R1.html"><a href="R1.html#logical-operators"><i class="fa fa-check"></i><b>1.3.3</b> Logical operators</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="R1.html"><a href="R1.html#objects"><i class="fa fa-check"></i><b>1.4</b> Objects</a></li>
<li class="chapter" data-level="1.5" data-path="R1.html"><a href="R1.html#vectors"><i class="fa fa-check"></i><b>1.5</b> Vectors</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="R1.html"><a href="R1.html#subsetting"><i class="fa fa-check"></i><b>1.5.1</b> Subsetting</a></li>
<li class="chapter" data-level="1.5.2" data-path="R1.html"><a href="R1.html#types-of-vectors"><i class="fa fa-check"></i><b>1.5.2</b> Types of vectors</a></li>
<li class="chapter" data-level="1.5.3" data-path="R1.html"><a href="R1.html#a-brief-look-at-lists"><i class="fa fa-check"></i><b>1.5.3</b> A brief look at lists</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="R1.html"><a href="R1.html#functions"><i class="fa fa-check"></i><b>1.6</b> Functions</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="R1.html"><a href="R1.html#help"><i class="fa fa-check"></i><b>1.6.1</b> Help</a></li>
<li class="chapter" data-level="1.6.2" data-path="R1.html"><a href="R1.html#examples-basic-statistical-functions"><i class="fa fa-check"></i><b>1.6.2</b> Examples: Basic statistical functions</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="R1.html"><a href="R1.html#rstudio-workflow"><i class="fa fa-check"></i><b>1.7</b> RStudio Workflow</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="R1.html"><a href="R1.html#r-scripts"><i class="fa fa-check"></i><b>1.7.1</b> R Scripts</a></li>
<li class="chapter" data-level="1.7.2" data-path="R1.html"><a href="R1.html#projects"><i class="fa fa-check"></i><b>1.7.2</b> Projects</a></li>
<li class="chapter" data-level="1.7.3" data-path="R1.html"><a href="R1.html#comments"><i class="fa fa-check"></i><b>1.7.3</b> Comments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="R2.html"><a href="R2.html"><i class="fa fa-check"></i><b>2</b> Packages, the tidyverse and R Markdown</a>
<ul>
<li class="chapter" data-level="2.1" data-path="R2.html"><a href="R2.html#r-packages"><i class="fa fa-check"></i><b>2.1</b> R packages</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="R2.html"><a href="R2.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>2.1.1</b> Installing and loading packages</a></li>
<li class="chapter" data-level="2.1.2" data-path="R2.html"><a href="R2.html#namespaces"><i class="fa fa-check"></i><b>2.1.2</b> Namespaces</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="R2.html"><a href="R2.html#tidyverse"><i class="fa fa-check"></i><b>2.2</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="R2.html"><a href="R2.html#tibbles"><i class="fa fa-check"></i><b>2.2.1</b> Tibbles</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="R2.html"><a href="R2.html#additional-r-resources"><i class="fa fa-check"></i><b>2.3</b> Additional R resources</a></li>
<li class="chapter" data-level="2.4" data-path="R2.html"><a href="R2.html#intro-to-r-markdown"><i class="fa fa-check"></i><b>2.4</b> Intro to R Markdown</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="R2.html"><a href="R2.html#what-is-r-markdown"><i class="fa fa-check"></i><b>2.4.1</b> What is R Markdown?</a></li>
<li class="chapter" data-level="2.4.2" data-path="R2.html"><a href="R2.html#creating-a-r-markdown-file"><i class="fa fa-check"></i><b>2.4.2</b> Creating a R Markdown file</a></li>
<li class="chapter" data-level="2.4.3" data-path="R2.html"><a href="R2.html#writing-in-r-markdown"><i class="fa fa-check"></i><b>2.4.3</b> Writing in R Markdown</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Scraping</b></span></li>
<li class="chapter" data-level="3" data-path="html.html"><a href="html.html"><i class="fa fa-check"></i><b>3</b> HTML as a cornerstone of the internet</a>
<ul>
<li class="chapter" data-level="3.1" data-path="html.html"><a href="html.html#html-tags"><i class="fa fa-check"></i><b>3.1</b> HTML-Tags</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="html.html"><a href="html.html#hello_world.html"><i class="fa fa-check"></i><b>3.1.1</b> hello_world.html</a></li>
<li class="chapter" data-level="3.1.2" data-path="html.html"><a href="html.html#important-tags"><i class="fa fa-check"></i><b>3.1.2</b> Important tags</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="html.html"><a href="html.html#attribute"><i class="fa fa-check"></i><b>3.2</b> Attributes</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="html.html"><a href="html.html#links"><i class="fa fa-check"></i><b>3.2.1</b> Links</a></li>
<li class="chapter" data-level="3.2.2" data-path="html.html"><a href="html.html#images"><i class="fa fa-check"></i><b>3.2.2</b> Images</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="html.html"><a href="html.html#entities"><i class="fa fa-check"></i><b>3.3</b> Entities</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rvest1.html"><a href="rvest1.html"><i class="fa fa-check"></i><b>4</b> First scraping with rvest</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rvest1.html"><a href="rvest1.html#the-rvest-package"><i class="fa fa-check"></i><b>4.1</b> The rvest package</a></li>
<li class="chapter" data-level="4.2" data-path="rvest1.html"><a href="rvest1.html#hello_world.html-1"><i class="fa fa-check"></i><b>4.2</b> hello_world.html</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rvest1.html"><a href="rvest1.html#read_html"><i class="fa fa-check"></i><b>4.2.1</b> read_html()</a></li>
<li class="chapter" data-level="4.2.2" data-path="rvest1.html"><a href="rvest1.html#html_elements"><i class="fa fa-check"></i><b>4.2.2</b> html_elements()</a></li>
<li class="chapter" data-level="4.2.3" data-path="rvest1.html"><a href="rvest1.html#html_text"><i class="fa fa-check"></i><b>4.2.3</b> html_text()</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rvest1.html"><a href="rvest1.html#countries-of-the-world"><i class="fa fa-check"></i><b>4.3</b> Countries of the World</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rvest1.html"><a href="rvest1.html#country-names"><i class="fa fa-check"></i><b>4.3.1</b> Country names</a></li>
<li class="chapter" data-level="4.3.2" data-path="rvest1.html"><a href="rvest1.html#capitals-population-and-area"><i class="fa fa-check"></i><b>4.3.2</b> Capitals, population and area</a></li>
<li class="chapter" data-level="4.3.3" data-path="rvest1.html"><a href="rvest1.html#merge-into-one-tibble"><i class="fa fa-check"></i><b>4.3.3</b> Merge into one tibble</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html"><i class="fa fa-check"></i><b>5</b> CSS selectors &amp; Developer Tools</a>
<ul>
<li class="chapter" data-level="5.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#css"><i class="fa fa-check"></i><b>5.1</b> CSS selectors</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#classes"><i class="fa fa-check"></i><b>5.1.1</b> Classes</a></li>
<li class="chapter" data-level="5.1.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#ids"><i class="fa fa-check"></i><b>5.1.2</b> IDs</a></li>
<li class="chapter" data-level="5.1.3" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#attributes"><i class="fa fa-check"></i><b>5.1.3</b> Attributes</a></li>
<li class="chapter" data-level="5.1.4" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#hierarchy-levels"><i class="fa fa-check"></i><b>5.1.4</b> Hierarchy levels</a></li>
<li class="chapter" data-level="5.1.5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#further-selectors"><i class="fa fa-check"></i><b>5.1.5</b> Further selectors</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#developer-tools"><i class="fa fa-check"></i><b>5.2</b> Developer Tools</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rvest2.html"><a href="rvest2.html"><i class="fa fa-check"></i><b>6</b> Scraping of tables &amp; dynamic websites</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rvest2.html"><a href="rvest2.html#scraping-of-tables"><i class="fa fa-check"></i><b>6.1</b> Scraping of tables</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="rvest2.html"><a href="rvest2.html#table-with-css-selectors-from-wikipedia"><i class="fa fa-check"></i><b>6.1.1</b> Table with CSS selectors from Wikipedia</a></li>
<li class="chapter" data-level="6.1.2" data-path="rvest2.html"><a href="rvest2.html#scraping-multiple-tables"><i class="fa fa-check"></i><b>6.1.2</b> Scraping multiple tables</a></li>
<li class="chapter" data-level="6.1.3" data-path="rvest2.html"><a href="rvest2.html#tabellen-mit-nas"><i class="fa fa-check"></i><b>6.1.3</b> Tabellen mit NAs</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="rvest2.html"><a href="rvest2.html#dynamic-websites"><i class="fa fa-check"></i><b>6.2</b> Dynamic Websites</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rvest2.html"><a href="rvest2.html#html-forms-and-html-queries"><i class="fa fa-check"></i><b>6.2.1</b> HTML forms and HTML queries</a></li>
<li class="chapter" data-level="6.2.2" data-path="rvest2.html"><a href="rvest2.html#html-forms"><i class="fa fa-check"></i><b>6.2.2</b> HTML forms</a></li>
<li class="chapter" data-level="6.2.3" data-path="rvest2.html"><a href="rvest2.html#the-query"><i class="fa fa-check"></i><b>6.2.3</b> The query</a></li>
<li class="chapter" data-level="6.2.4" data-path="rvest2.html"><a href="rvest2.html#manipulating-the-query-and-scraping-the-result"><i class="fa fa-check"></i><b>6.2.4</b> Manipulating the query and scraping the result</a></li>
<li class="chapter" data-level="6.2.5" data-path="rvest2.html"><a href="rvest2.html#additional-resources"><i class="fa fa-check"></i><b>6.2.5</b> Additional resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rvest3.html"><a href="rvest3.html"><i class="fa fa-check"></i><b>7</b> Scraping of multi-page websites</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rvest3.html"><a href="rvest3.html#index-pages"><i class="fa fa-check"></i><b>7.1</b> Index-pages</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rvest3.html"><a href="rvest3.html#scraping-of-the-index"><i class="fa fa-check"></i><b>7.1.1</b> Scraping of the index</a></li>
<li class="chapter" data-level="7.1.2" data-path="rvest3.html"><a href="rvest3.html#iteration-with-map"><i class="fa fa-check"></i><b>7.1.2</b> Iteration with map()</a></li>
<li class="chapter" data-level="7.1.3" data-path="rvest3.html"><a href="rvest3.html#scraping-the-sub-pages"><i class="fa fa-check"></i><b>7.1.3</b> Scraping the sub-pages</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rvest3.html"><a href="rvest3.html#pagination"><i class="fa fa-check"></i><b>7.2</b> Pagination</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rvest3.html"><a href="rvest3.html#the-query-1"><i class="fa fa-check"></i><b>7.2.1</b> The query</a></li>
<li class="chapter" data-level="7.2.2" data-path="rvest3.html"><a href="rvest3.html#sub-pgs"><i class="fa fa-check"></i><b>7.2.2</b> Scraping the sub-pages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="files.html"><a href="files.html"><i class="fa fa-check"></i><b>8</b> Downloading and saving files</a>
<ul>
<li class="chapter" data-level="8.1" data-path="files.html"><a href="files.html#CSV"><i class="fa fa-check"></i><b>8.1</b> CSV files</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="files.html"><a href="files.html#parsing-a-csv-file"><i class="fa fa-check"></i><b>8.1.1</b> Parsing a CSV file</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="files.html"><a href="files.html#downloading-files"><i class="fa fa-check"></i><b>8.2</b> Downloading files</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="files.html"><a href="files.html#parsing-the-csv-files"><i class="fa fa-check"></i><b>8.2.1</b> Parsing the CSV files</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="files.html"><a href="files.html#saving-data-files"><i class="fa fa-check"></i><b>8.3</b> Saving data files</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="goodpractice.html"><a href="goodpractice.html"><i class="fa fa-check"></i><b>9</b> Good practice</a>
<ul>
<li class="chapter" data-level="9.1" data-path="goodpractice.html"><a href="goodpractice.html#we-aint-no-web-crawlers"><i class="fa fa-check"></i><b>9.1</b> We ain’t no web crawlers</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="goodpractice.html"><a href="goodpractice.html#on-robots.txt-files"><i class="fa fa-check"></i><b>9.1.1</b> On robots.txt files</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="goodpractice.html"><a href="goodpractice.html#reduce-traffic"><i class="fa fa-check"></i><b>9.2</b> Reduce traffic</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="goodpractice.html"><a href="goodpractice.html#waiting-times-in-action"><i class="fa fa-check"></i><b>9.2.1</b> Waiting times in action</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="goodpractice.html"><a href="goodpractice.html#citation-and-an-additional-resource"><i class="fa fa-check"></i><b>9.3</b> Citation and an additional resource</a></li>
</ul></li>
<li class="part"><span><b>III Sample project</b></span></li>
<li class="chapter" data-level="10" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>10</b> Scraping Berlin police reports</a>
<ul>
<li class="chapter" data-level="10.1" data-path="scraping.html"><a href="scraping.html#topic-and-data"><i class="fa fa-check"></i><b>10.1</b> Topic and data</a></li>
<li class="chapter" data-level="10.2" data-path="scraping.html"><a href="scraping.html#scraping-the-data"><i class="fa fa-check"></i><b>10.2</b> Scraping the data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="scraping.html"><a href="scraping.html#gathering-the-links"><i class="fa fa-check"></i><b>10.2.1</b> Gathering the links</a></li>
<li class="chapter" data-level="10.2.2" data-path="scraping.html"><a href="scraping.html#downloading-the-subpages"><i class="fa fa-check"></i><b>10.2.2</b> Downloading the subpages</a></li>
<li class="chapter" data-level="10.2.3" data-path="scraping.html"><a href="scraping.html#extracting-the-data-of-interest"><i class="fa fa-check"></i><b>10.2.3</b> Extracting the data of interest</a></li>
<li class="chapter" data-level="10.2.4" data-path="scraping.html"><a href="scraping.html#saving-the-data"><i class="fa fa-check"></i><b>10.2.4</b> Saving the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>11</b> Transformation with dplyr</a>
<ul>
<li class="chapter" data-level="11.1" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>11.1</b> <code>mutate()</code></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="dplyr.html"><a href="dplyr.html#computing-new-variables-from-existing-ones"><i class="fa fa-check"></i><b>11.1.1</b> Computing new variables from existing ones</a></li>
<li class="chapter" data-level="11.1.2" data-path="dplyr.html"><a href="dplyr.html#clean"><i class="fa fa-check"></i><b>11.1.2</b> Cleaning the data on police reports</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="dplyr.html"><a href="dplyr.html#select"><i class="fa fa-check"></i><b>11.2</b> <code>select()</code></a></li>
<li class="chapter" data-level="11.3" data-path="dplyr.html"><a href="dplyr.html#rename"><i class="fa fa-check"></i><b>11.3</b> <code>rename()</code></a></li>
<li class="chapter" data-level="11.4" data-path="dplyr.html"><a href="dplyr.html#filter"><i class="fa fa-check"></i><b>11.4</b> <code>filter()</code></a></li>
<li class="chapter" data-level="11.5" data-path="dplyr.html"><a href="dplyr.html#summarise-group_by"><i class="fa fa-check"></i><b>11.5</b> <code>summarise()</code> &amp; <code>group_by()</code></a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="dplyr.html"><a href="dplyr.html#number-of-reports-by-groups"><i class="fa fa-check"></i><b>11.5.1</b> Number of reports by groups</a></li>
<li class="chapter" data-level="11.5.2" data-path="dplyr.html"><a href="dplyr.html#summary-statistics-on-the-time"><i class="fa fa-check"></i><b>11.5.2</b> Summary statistics on the time</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="dplyr.html"><a href="dplyr.html#exporting-tables"><i class="fa fa-check"></i><b>11.6</b> Exporting tables</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="dplyr.html"><a href="dplyr.html#further-resources"><i class="fa fa-check"></i><b>11.6.1</b> Further resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>12</b> Graphical analysis with ggplot</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ggplot.html"><a href="ggplot.html#ggplot2-syntax"><i class="fa fa-check"></i><b>12.1</b> ggplot2 syntax</a></li>
<li class="chapter" data-level="12.2" data-path="ggplot.html"><a href="ggplot.html#geoms-and-aesthetics"><i class="fa fa-check"></i><b>12.2</b> Geoms and aesthetics</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="ggplot.html"><a href="ggplot.html#continuous-x-continuous-y"><i class="fa fa-check"></i><b>12.2.1</b> Continuous x, continuous y</a></li>
<li class="chapter" data-level="12.2.2" data-path="ggplot.html"><a href="ggplot.html#graphical-analysis-of-berlin-police-reports"><i class="fa fa-check"></i><b>12.2.2</b> Graphical analysis of Berlin police reports</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="ggplot.html"><a href="ggplot.html#exporting-plots"><i class="fa fa-check"></i><b>12.3</b> Exporting plots</a></li>
</ul></li>
<li class="part"><span><b>IV Regular expressions</b></span></li>
<li class="chapter" data-level="13" data-path="regex.html"><a href="regex.html"><i class="fa fa-check"></i><b>13</b> Regular expressions</a>
<ul>
<li class="chapter" data-level="13.1" data-path="regex.html"><a href="regex.html#cleaning-the-district-column"><i class="fa fa-check"></i><b>13.1</b> Cleaning the <code>district</code> column</a></li>
<li class="chapter" data-level="13.2" data-path="regex.html"><a href="regex.html#detecting-robberies-in-police-reports"><i class="fa fa-check"></i><b>13.2</b> Detecting robberies in police reports</a></li>
<li class="chapter" data-level="13.3" data-path="regex.html"><a href="regex.html#extracting-details-from-a-list-of-names"><i class="fa fa-check"></i><b>13.3</b> Extracting details from a list of names</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Web Scraping using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="regex" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">13</span> Regular expressions<a href="regex.html#regex" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In web scraping, we are often dealing with text data that has been collected
from a website and may include information that is not easily accessible and
usable in data analysis. We are interested either in detecting the occurrence of
certain words or in extracting some information from the strings in our data.
For these purposes we will use some functions from the core tidyverse package
<strong>stringr</strong>. We will also use <em>regular expressions</em>, a powerful and flexible formal
representation of characters that we can use to select substrings by their
content.</p>
<p>This chapter will make use of some practical examples, introducing the basics of
regular expressions and <strong>stringr</strong>. This can only be a starting point; if you want
to follow the road of web scraping, you most probably will have to further your
knowledge on regular expressions at some point. I would recommended reading the
chapter on strings from “R for Data Science” by Wickham and Grolemund as a next
step: <a href="https://r4ds.had.co.nz/strings.html" target="_blank">https://r4ds.had.co.nz/strings.html</a>, as well as the
RStudio Cheat Sheet on stringr:
<a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/strings.pdf" target="_blank">https://raw.githubusercontent.com/rstudio/cheatsheets/master/strings.pdf</a>.</p>
<div id="cleaning-the-district-column" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Cleaning the <code>district</code> column<a href="regex.html#cleaning-the-district-column" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can use the data on Berlin police reports scraped earlier (<a href="scraping.html#scraping">10</a>)
for our examples.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="regex.html#cb240-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb240-2"><a href="regex.html#cb240-2" tabindex="-1"></a></span>
<span id="cb240-3"><a href="regex.html#cb240-3" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;reports.RData&quot;</span>)</span></code></pre></div>
<p>In our example the data on police reports contain the district a report refers
to as a column which needs some cleaning to be usable. We have already done this
in subchapter <a href="dplyr.html#clean">11.1.2</a>, but we will use some alternative and more advanced
approaches here.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="regex.html#cb241-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span></span>
<span id="cb241-2"><a href="regex.html#cb241-2" tabindex="-1"></a>  <span class="fu">select</span>(District) <span class="sc">%&gt;%</span></span>
<span id="cb241-3"><a href="regex.html#cb241-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb241-4"><a href="regex.html#cb241-4" tabindex="-1"></a><span class="do">## # A tibble: 10 × 1</span></span>
<span id="cb241-5"><a href="regex.html#cb241-5" tabindex="-1"></a><span class="do">##    District                             </span></span>
<span id="cb241-6"><a href="regex.html#cb241-6" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                                </span></span>
<span id="cb241-7"><a href="regex.html#cb241-7" tabindex="-1"></a><span class="do">##  1 Ereignisort: Spandau                 </span></span>
<span id="cb241-8"><a href="regex.html#cb241-8" tabindex="-1"></a><span class="do">##  2 Ereignisort: Neukölln                </span></span>
<span id="cb241-9"><a href="regex.html#cb241-9" tabindex="-1"></a><span class="do">##  3 Ereignisort: Friedrichshain-Kreuzberg</span></span>
<span id="cb241-10"><a href="regex.html#cb241-10" tabindex="-1"></a><span class="do">##  4 Ereignisort: Friedrichshain-Kreuzberg</span></span>
<span id="cb241-11"><a href="regex.html#cb241-11" tabindex="-1"></a><span class="do">##  5 Ereignisort: Spandau                 </span></span>
<span id="cb241-12"><a href="regex.html#cb241-12" tabindex="-1"></a><span class="do">##  6 Ereignisort: Marzahn-Hellersdorf     </span></span>
<span id="cb241-13"><a href="regex.html#cb241-13" tabindex="-1"></a><span class="do">##  7 Ereignisort: Treptow-Köpenick        </span></span>
<span id="cb241-14"><a href="regex.html#cb241-14" tabindex="-1"></a><span class="do">##  8 Ereignisort: Steglitz-Zehlendorf     </span></span>
<span id="cb241-15"><a href="regex.html#cb241-15" tabindex="-1"></a><span class="do">##  9 Ereignisort: Tempelhof-Schöneberg    </span></span>
<span id="cb241-16"><a href="regex.html#cb241-16" tabindex="-1"></a><span class="do">## 10 Ereignisort: Lichtenberg</span></span></code></pre></div>
<p>One problem we encounter here is that each string begins with “Ereignisort:”.
We want to get rid of this substring, as it does not contain any useful
information. With <code>str_remove()</code> we can remove substrings from a string. Like
all stringr functions we will use here, <code>str_remove()</code> takes the string(s) to be
applied to, as its first argument. The argument <code>pattern =</code> specifies a regular
expression for the pattern that is to be matched and removed. In the code block
below, the substring <code>"Ereignisort:</code> is removed for all values in the “District”
column. We are using the most basic form of a regular
expression here which is the exact matching of characters. In general, the
complete regular expression is enclosed by <code>"</code>. Please note, that the whitespace
following <code>:</code> is part of the regular expression.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="regex.html#cb242-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span></span>
<span id="cb242-2"><a href="regex.html#cb242-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">str_remove</span>(District, <span class="at">pattern =</span> <span class="st">&quot;Ereignisort: &quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb242-3"><a href="regex.html#cb242-3" tabindex="-1"></a>  <span class="fu">select</span>(District) <span class="sc">%&gt;%</span> </span>
<span id="cb242-4"><a href="regex.html#cb242-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb242-5"><a href="regex.html#cb242-5" tabindex="-1"></a><span class="do">## # A tibble: 10 × 1</span></span>
<span id="cb242-6"><a href="regex.html#cb242-6" tabindex="-1"></a><span class="do">##    District                </span></span>
<span id="cb242-7"><a href="regex.html#cb242-7" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                   </span></span>
<span id="cb242-8"><a href="regex.html#cb242-8" tabindex="-1"></a><span class="do">##  1 Spandau                 </span></span>
<span id="cb242-9"><a href="regex.html#cb242-9" tabindex="-1"></a><span class="do">##  2 Neukölln                </span></span>
<span id="cb242-10"><a href="regex.html#cb242-10" tabindex="-1"></a><span class="do">##  3 Friedrichshain-Kreuzberg</span></span>
<span id="cb242-11"><a href="regex.html#cb242-11" tabindex="-1"></a><span class="do">##  4 Friedrichshain-Kreuzberg</span></span>
<span id="cb242-12"><a href="regex.html#cb242-12" tabindex="-1"></a><span class="do">##  5 Spandau                 </span></span>
<span id="cb242-13"><a href="regex.html#cb242-13" tabindex="-1"></a><span class="do">##  6 Marzahn-Hellersdorf     </span></span>
<span id="cb242-14"><a href="regex.html#cb242-14" tabindex="-1"></a><span class="do">##  7 Treptow-Köpenick        </span></span>
<span id="cb242-15"><a href="regex.html#cb242-15" tabindex="-1"></a><span class="do">##  8 Steglitz-Zehlendorf     </span></span>
<span id="cb242-16"><a href="regex.html#cb242-16" tabindex="-1"></a><span class="do">##  9 Tempelhof-Schöneberg    </span></span>
<span id="cb242-17"><a href="regex.html#cb242-17" tabindex="-1"></a><span class="do">## 10 Lichtenberg</span></span></code></pre></div>
<p>We could also keep the substring but translate it to English. For this, we use
<code>str_replace()</code> which also matches a regular expression, but replaces it with a
string specified in <code>replacement =</code>. Here, the pattern is shortened to
<code>"Ereignisort"</code>, as we want to keep the <code>": "</code>.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="regex.html#cb243-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span></span>
<span id="cb243-2"><a href="regex.html#cb243-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">str_replace</span>(District, <span class="at">pattern =</span> <span class="st">&quot;Ereignisort&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;District&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="regex.html#cb243-3" tabindex="-1"></a>  <span class="fu">select</span>(District) <span class="sc">%&gt;%</span> </span>
<span id="cb243-4"><a href="regex.html#cb243-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb243-5"><a href="regex.html#cb243-5" tabindex="-1"></a><span class="do">## # A tibble: 10 × 1</span></span>
<span id="cb243-6"><a href="regex.html#cb243-6" tabindex="-1"></a><span class="do">##    District                          </span></span>
<span id="cb243-7"><a href="regex.html#cb243-7" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                             </span></span>
<span id="cb243-8"><a href="regex.html#cb243-8" tabindex="-1"></a><span class="do">##  1 District: Spandau                 </span></span>
<span id="cb243-9"><a href="regex.html#cb243-9" tabindex="-1"></a><span class="do">##  2 District: Neukölln                </span></span>
<span id="cb243-10"><a href="regex.html#cb243-10" tabindex="-1"></a><span class="do">##  3 District: Friedrichshain-Kreuzberg</span></span>
<span id="cb243-11"><a href="regex.html#cb243-11" tabindex="-1"></a><span class="do">##  4 District: Friedrichshain-Kreuzberg</span></span>
<span id="cb243-12"><a href="regex.html#cb243-12" tabindex="-1"></a><span class="do">##  5 District: Spandau                 </span></span>
<span id="cb243-13"><a href="regex.html#cb243-13" tabindex="-1"></a><span class="do">##  6 District: Marzahn-Hellersdorf     </span></span>
<span id="cb243-14"><a href="regex.html#cb243-14" tabindex="-1"></a><span class="do">##  7 District: Treptow-Köpenick        </span></span>
<span id="cb243-15"><a href="regex.html#cb243-15" tabindex="-1"></a><span class="do">##  8 District: Steglitz-Zehlendorf     </span></span>
<span id="cb243-16"><a href="regex.html#cb243-16" tabindex="-1"></a><span class="do">##  9 District: Tempelhof-Schöneberg    </span></span>
<span id="cb243-17"><a href="regex.html#cb243-17" tabindex="-1"></a><span class="do">## 10 District: Lichtenberg</span></span></code></pre></div>
<p>In the same way, we can replace the <code>": "</code> substring with a dash.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="regex.html#cb244-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span></span>
<span id="cb244-2"><a href="regex.html#cb244-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">str_replace</span>(District, <span class="at">pattern =</span> <span class="st">&quot;: &quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;-&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb244-3"><a href="regex.html#cb244-3" tabindex="-1"></a>  <span class="fu">select</span>(District) <span class="sc">%&gt;%</span> </span>
<span id="cb244-4"><a href="regex.html#cb244-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb244-5"><a href="regex.html#cb244-5" tabindex="-1"></a><span class="do">## # A tibble: 10 × 1</span></span>
<span id="cb244-6"><a href="regex.html#cb244-6" tabindex="-1"></a><span class="do">##    District                            </span></span>
<span id="cb244-7"><a href="regex.html#cb244-7" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                               </span></span>
<span id="cb244-8"><a href="regex.html#cb244-8" tabindex="-1"></a><span class="do">##  1 Ereignisort-Spandau                 </span></span>
<span id="cb244-9"><a href="regex.html#cb244-9" tabindex="-1"></a><span class="do">##  2 Ereignisort-Neukölln                </span></span>
<span id="cb244-10"><a href="regex.html#cb244-10" tabindex="-1"></a><span class="do">##  3 Ereignisort-Friedrichshain-Kreuzberg</span></span>
<span id="cb244-11"><a href="regex.html#cb244-11" tabindex="-1"></a><span class="do">##  4 Ereignisort-Friedrichshain-Kreuzberg</span></span>
<span id="cb244-12"><a href="regex.html#cb244-12" tabindex="-1"></a><span class="do">##  5 Ereignisort-Spandau                 </span></span>
<span id="cb244-13"><a href="regex.html#cb244-13" tabindex="-1"></a><span class="do">##  6 Ereignisort-Marzahn-Hellersdorf     </span></span>
<span id="cb244-14"><a href="regex.html#cb244-14" tabindex="-1"></a><span class="do">##  7 Ereignisort-Treptow-Köpenick        </span></span>
<span id="cb244-15"><a href="regex.html#cb244-15" tabindex="-1"></a><span class="do">##  8 Ereignisort-Steglitz-Zehlendorf     </span></span>
<span id="cb244-16"><a href="regex.html#cb244-16" tabindex="-1"></a><span class="do">##  9 Ereignisort-Tempelhof-Schöneberg    </span></span>
<span id="cb244-17"><a href="regex.html#cb244-17" tabindex="-1"></a><span class="do">## 10 Ereignisort-Lichtenberg</span></span></code></pre></div>
<p>In chapter <a href="dplyr.html#dplyr">11</a> we saw district names with two parts that are sometimes
written with and sometimes without whitespace around the dash, as seen here:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="regex.html#cb245-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span></span>
<span id="cb245-2"><a href="regex.html#cb245-2" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">%&gt;%</span></span>
<span id="cb245-3"><a href="regex.html#cb245-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb245-4"><a href="regex.html#cb245-4" tabindex="-1"></a><span class="do">## # A tibble: 22 × 2</span></span>
<span id="cb245-5"><a href="regex.html#cb245-5" tabindex="-1"></a><span class="do">##    District                                  reports</span></span>
<span id="cb245-6"><a href="regex.html#cb245-6" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                                       &lt;int&gt;</span></span>
<span id="cb245-7"><a href="regex.html#cb245-7" tabindex="-1"></a><span class="do">##  1 Ereignisort: Charlottenburg - Wilmersdorf     579</span></span>
<span id="cb245-8"><a href="regex.html#cb245-8" tabindex="-1"></a><span class="do">##  2 Ereignisort: Charlottenburg-Wilmersdorf      1421</span></span>
<span id="cb245-9"><a href="regex.html#cb245-9" tabindex="-1"></a><span class="do">##  3 Ereignisort: Friedrichshain - Kreuzberg       661</span></span>
<span id="cb245-10"><a href="regex.html#cb245-10" tabindex="-1"></a><span class="do">##  4 Ereignisort: Friedrichshain-Kreuzberg        1694</span></span>
<span id="cb245-11"><a href="regex.html#cb245-11" tabindex="-1"></a><span class="do">##  5 Ereignisort: Lichtenberg                     1231</span></span>
<span id="cb245-12"><a href="regex.html#cb245-12" tabindex="-1"></a><span class="do">##  6 Ereignisort: Marzahn - Hellersdorf            253</span></span>
<span id="cb245-13"><a href="regex.html#cb245-13" tabindex="-1"></a><span class="do">##  7 Ereignisort: Marzahn-Hellersdorf              878</span></span>
<span id="cb245-14"><a href="regex.html#cb245-14" tabindex="-1"></a><span class="do">##  8 Ereignisort: Mitte                           3303</span></span>
<span id="cb245-15"><a href="regex.html#cb245-15" tabindex="-1"></a><span class="do">##  9 Ereignisort: Neukölln                        1949</span></span>
<span id="cb245-16"><a href="regex.html#cb245-16" tabindex="-1"></a><span class="do">## 10 Ereignisort: Pankow                          1624</span></span>
<span id="cb245-17"><a href="regex.html#cb245-17" tabindex="-1"></a><span class="do">## # ℹ 12 more rows</span></span></code></pre></div>
<p>We can easily unify those names using <code>str_replace</code> and regular expressions.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="regex.html#cb246-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span></span>
<span id="cb246-2"><a href="regex.html#cb246-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">str_replace</span>(District, <span class="at">pattern =</span> <span class="st">&quot; - &quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;-&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb246-3"><a href="regex.html#cb246-3" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">%&gt;%</span></span>
<span id="cb246-4"><a href="regex.html#cb246-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb246-5"><a href="regex.html#cb246-5" tabindex="-1"></a><span class="do">## # A tibble: 16 × 2</span></span>
<span id="cb246-6"><a href="regex.html#cb246-6" tabindex="-1"></a><span class="do">##    District                                reports</span></span>
<span id="cb246-7"><a href="regex.html#cb246-7" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                                     &lt;int&gt;</span></span>
<span id="cb246-8"><a href="regex.html#cb246-8" tabindex="-1"></a><span class="do">##  1 Ereignisort: Charlottenburg-Wilmersdorf    2000</span></span>
<span id="cb246-9"><a href="regex.html#cb246-9" tabindex="-1"></a><span class="do">##  2 Ereignisort: Friedrichshain-Kreuzberg      2355</span></span>
<span id="cb246-10"><a href="regex.html#cb246-10" tabindex="-1"></a><span class="do">##  3 Ereignisort: Lichtenberg                   1231</span></span>
<span id="cb246-11"><a href="regex.html#cb246-11" tabindex="-1"></a><span class="do">##  4 Ereignisort: Marzahn-Hellersdorf           1131</span></span>
<span id="cb246-12"><a href="regex.html#cb246-12" tabindex="-1"></a><span class="do">##  5 Ereignisort: Mitte                         3303</span></span>
<span id="cb246-13"><a href="regex.html#cb246-13" tabindex="-1"></a><span class="do">##  6 Ereignisort: Neukölln                      1949</span></span>
<span id="cb246-14"><a href="regex.html#cb246-14" tabindex="-1"></a><span class="do">##  7 Ereignisort: Pankow                        1624</span></span>
<span id="cb246-15"><a href="regex.html#cb246-15" tabindex="-1"></a><span class="do">##  8 Ereignisort: Reinickendorf                 1193</span></span>
<span id="cb246-16"><a href="regex.html#cb246-16" tabindex="-1"></a><span class="do">##  9 Ereignisort: Spandau                       1170</span></span>
<span id="cb246-17"><a href="regex.html#cb246-17" tabindex="-1"></a><span class="do">## 10 Ereignisort: Steglitz-Zehlendorf           1045</span></span>
<span id="cb246-18"><a href="regex.html#cb246-18" tabindex="-1"></a><span class="do">## 11 Ereignisort: Tempelhof-Schöneberg          1735</span></span>
<span id="cb246-19"><a href="regex.html#cb246-19" tabindex="-1"></a><span class="do">## 12 Ereignisort: Treptow-Köpenick              1345</span></span>
<span id="cb246-20"><a href="regex.html#cb246-20" tabindex="-1"></a><span class="do">## 13 Ereignisort: berlinweit                     386</span></span>
<span id="cb246-21"><a href="regex.html#cb246-21" tabindex="-1"></a><span class="do">## 14 Ereignisort: bezirksübergreifend            951</span></span>
<span id="cb246-22"><a href="regex.html#cb246-22" tabindex="-1"></a><span class="do">## 15 Ereignisort: bundesweit                      60</span></span>
<span id="cb246-23"><a href="regex.html#cb246-23" tabindex="-1"></a><span class="do">## 16 &lt;NA&gt;                                        427</span></span></code></pre></div>
<p>If we want to remove the whitespace and unify the names in the process, we use
<code>str_remove()</code> and the regular expression <code>"\\s"</code>, being a shortcut for matching
all kinds of whitespace.</p>
<p>At this point we have to talk about <em>escape characters</em>. Some characters used in
regular expressions have a special meaning, e.g. <code>"."</code>, <code>"?"</code> or <code>"*"</code>. If we
just write one of those characters in a regular expression, R will not interpret
it as a literal character but by its special meaning. <code>"."</code> used in a regular
expression for example, stands for <em>any</em> character. If we want to match a
literal <code>.</code> in a string though, we have to escape the dot by using the escape
character <code>\</code> or actually two, telling R to take the next character
literally. So to match a dot, we write <code>"\\."</code>.</p>
<p>If this seems confusing and needlessly complicated, save your rage for when you
find out what you have to write to match <em>one</em> literal backslash in a string:
<code>\\\\</code>. Some commentary on this: <a href="https://xkcd.com/1638/" target="_blank">https://xkcd.com/1638/</a></p>
<p>Escape characters are hard to understand when starting out using regular
expressions, but for now it is enough to know that some characters have to be
escaped and that you find a full list of those in the cheat sheet linked above.</p>
<p>In a similar way, we have to use two escape characters in <code>"\\s"</code> to make R
interpret it not as an “s” but as the shortcut for whitespace characters we want
to use:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="regex.html#cb247-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span></span>
<span id="cb247-2"><a href="regex.html#cb247-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">str_remove</span>(District, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">s&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb247-3"><a href="regex.html#cb247-3" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">%&gt;%</span></span>
<span id="cb247-4"><a href="regex.html#cb247-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb247-5"><a href="regex.html#cb247-5" tabindex="-1"></a><span class="do">## # A tibble: 22 × 2</span></span>
<span id="cb247-6"><a href="regex.html#cb247-6" tabindex="-1"></a><span class="do">##    District                                 reports</span></span>
<span id="cb247-7"><a href="regex.html#cb247-7" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                                      &lt;int&gt;</span></span>
<span id="cb247-8"><a href="regex.html#cb247-8" tabindex="-1"></a><span class="do">##  1 Ereignisort:Charlottenburg - Wilmersdorf     579</span></span>
<span id="cb247-9"><a href="regex.html#cb247-9" tabindex="-1"></a><span class="do">##  2 Ereignisort:Charlottenburg-Wilmersdorf      1421</span></span>
<span id="cb247-10"><a href="regex.html#cb247-10" tabindex="-1"></a><span class="do">##  3 Ereignisort:Friedrichshain - Kreuzberg       661</span></span>
<span id="cb247-11"><a href="regex.html#cb247-11" tabindex="-1"></a><span class="do">##  4 Ereignisort:Friedrichshain-Kreuzberg        1694</span></span>
<span id="cb247-12"><a href="regex.html#cb247-12" tabindex="-1"></a><span class="do">##  5 Ereignisort:Lichtenberg                     1231</span></span>
<span id="cb247-13"><a href="regex.html#cb247-13" tabindex="-1"></a><span class="do">##  6 Ereignisort:Marzahn - Hellersdorf            253</span></span>
<span id="cb247-14"><a href="regex.html#cb247-14" tabindex="-1"></a><span class="do">##  7 Ereignisort:Marzahn-Hellersdorf              878</span></span>
<span id="cb247-15"><a href="regex.html#cb247-15" tabindex="-1"></a><span class="do">##  8 Ereignisort:Mitte                           3303</span></span>
<span id="cb247-16"><a href="regex.html#cb247-16" tabindex="-1"></a><span class="do">##  9 Ereignisort:Neukölln                        1949</span></span>
<span id="cb247-17"><a href="regex.html#cb247-17" tabindex="-1"></a><span class="do">## 10 Ereignisort:Pankow                          1624</span></span>
<span id="cb247-18"><a href="regex.html#cb247-18" tabindex="-1"></a><span class="do">## # ℹ 12 more rows</span></span></code></pre></div>
<p>This did not work as expected. The whitespace following the <code>":"</code> was removed,
but not the whitespace around the dashes. This is the case because most of the
stringr functions stop after they found the first match for the pattern in a
string. But there are versions of the functions that do not stop after their
first match, ending in <code>_all</code>: e.g. <code>str_replace_all()</code>. So if we use
<code>str_remove_all()</code> in our code, all occurrences of whitespace will be removed.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="regex.html#cb248-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span></span>
<span id="cb248-2"><a href="regex.html#cb248-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">str_remove_all</span>(District, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">s&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb248-3"><a href="regex.html#cb248-3" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">%&gt;%</span></span>
<span id="cb248-4"><a href="regex.html#cb248-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb248-5"><a href="regex.html#cb248-5" tabindex="-1"></a><span class="do">## # A tibble: 16 × 2</span></span>
<span id="cb248-6"><a href="regex.html#cb248-6" tabindex="-1"></a><span class="do">##    District                               reports</span></span>
<span id="cb248-7"><a href="regex.html#cb248-7" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                                    &lt;int&gt;</span></span>
<span id="cb248-8"><a href="regex.html#cb248-8" tabindex="-1"></a><span class="do">##  1 Ereignisort:Charlottenburg-Wilmersdorf    2000</span></span>
<span id="cb248-9"><a href="regex.html#cb248-9" tabindex="-1"></a><span class="do">##  2 Ereignisort:Friedrichshain-Kreuzberg      2355</span></span>
<span id="cb248-10"><a href="regex.html#cb248-10" tabindex="-1"></a><span class="do">##  3 Ereignisort:Lichtenberg                   1231</span></span>
<span id="cb248-11"><a href="regex.html#cb248-11" tabindex="-1"></a><span class="do">##  4 Ereignisort:Marzahn-Hellersdorf           1131</span></span>
<span id="cb248-12"><a href="regex.html#cb248-12" tabindex="-1"></a><span class="do">##  5 Ereignisort:Mitte                         3303</span></span>
<span id="cb248-13"><a href="regex.html#cb248-13" tabindex="-1"></a><span class="do">##  6 Ereignisort:Neukölln                      1949</span></span>
<span id="cb248-14"><a href="regex.html#cb248-14" tabindex="-1"></a><span class="do">##  7 Ereignisort:Pankow                        1624</span></span>
<span id="cb248-15"><a href="regex.html#cb248-15" tabindex="-1"></a><span class="do">##  8 Ereignisort:Reinickendorf                 1193</span></span>
<span id="cb248-16"><a href="regex.html#cb248-16" tabindex="-1"></a><span class="do">##  9 Ereignisort:Spandau                       1170</span></span>
<span id="cb248-17"><a href="regex.html#cb248-17" tabindex="-1"></a><span class="do">## 10 Ereignisort:Steglitz-Zehlendorf           1045</span></span>
<span id="cb248-18"><a href="regex.html#cb248-18" tabindex="-1"></a><span class="do">## 11 Ereignisort:Tempelhof-Schöneberg          1735</span></span>
<span id="cb248-19"><a href="regex.html#cb248-19" tabindex="-1"></a><span class="do">## 12 Ereignisort:Treptow-Köpenick              1345</span></span>
<span id="cb248-20"><a href="regex.html#cb248-20" tabindex="-1"></a><span class="do">## 13 Ereignisort:berlinweit                     386</span></span>
<span id="cb248-21"><a href="regex.html#cb248-21" tabindex="-1"></a><span class="do">## 14 Ereignisort:bezirksübergreifend            951</span></span>
<span id="cb248-22"><a href="regex.html#cb248-22" tabindex="-1"></a><span class="do">## 15 Ereignisort:bundesweit                      60</span></span>
<span id="cb248-23"><a href="regex.html#cb248-23" tabindex="-1"></a><span class="do">## 16 &lt;NA&gt;                                       427</span></span></code></pre></div>
</div>
<div id="detecting-robberies-in-police-reports" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Detecting robberies in police reports<a href="regex.html#detecting-robberies-in-police-reports" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When collecting the data on police reports, we also scraped the short
description of the report’s contents, but we did no analysis on these in
chapters <a href="dplyr.html#dplyr">11</a> &amp; <a href="ggplot.html#ggplot">12</a>. We could try to categorize the texts into
types of crimes using regular expressions. Doing this properly, would require a
lot of planning. We would have to decide which categories of crimes we want to
extract and construct flexible regular expressions for each of these. Please
understand the following merely as a first outline for how to approach such a
project.</p>
<p>Let us focus solely on robberies. To begin with, we want to detect all strings
that contain the term “raub” in some form. <code>str_detect()</code> determines whether a
pattern was found in a string, returning <code>TRUE</code> or <code>FALSE</code>. We can then count
the number of strings for which the result is <code>TRUE</code>– remember <code>TRUE</code> is equal
to <span class="math inline">\(1\)</span>, <code>FALSE</code> equal to <span class="math inline">\(0\)</span> – using <code>sum()</code>.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="regex.html#cb249-1" tabindex="-1"></a>reports<span class="sc">$</span>Report <span class="sc">%&gt;%</span></span>
<span id="cb249-2"><a href="regex.html#cb249-2" tabindex="-1"></a>  <span class="fu">str_detect</span>(<span class="at">pattern =</span> <span class="st">&quot;raub&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb249-3"><a href="regex.html#cb249-3" tabindex="-1"></a>  <span class="fu">sum</span>()</span>
<span id="cb249-4"><a href="regex.html#cb249-4" tabindex="-1"></a><span class="do">## [1] 520</span></span></code></pre></div>
<p>But what if a text begins with “Raub”. In this case the “R” will be upper case.
Pattern matching is case sensitive and that means that “Raub” is not equal to
“raub”. If we want both ways of writing the term to be counted as equal, we have
to write a regular expression that allows for either an upper or lower case “r”
as the first character. For this we can define a <em>class</em> which contains both
characters enclosed by <code>[]</code>. <code>"[Rr]aub"</code> means that we want to find <em>either</em> an
“R” or an “r” as the first character and “aub” after this; only one of the
characters from the class is matched.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="regex.html#cb250-1" tabindex="-1"></a>reports<span class="sc">$</span>Report <span class="sc">%&gt;%</span></span>
<span id="cb250-2"><a href="regex.html#cb250-2" tabindex="-1"></a>  <span class="fu">str_detect</span>(<span class="at">pattern =</span> <span class="st">&quot;[Rr]aub&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb250-3"><a href="regex.html#cb250-3" tabindex="-1"></a>  <span class="fu">sum</span>()</span>
<span id="cb250-4"><a href="regex.html#cb250-4" tabindex="-1"></a><span class="do">## [1] 1162</span></span></code></pre></div>
<p>If we also want to detect terms like “Räuber” or “räuberische”, we have to allow
for an “ä” instead of the “a” as the second character by defining a class for
the second position in the term:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="regex.html#cb251-1" tabindex="-1"></a>reports<span class="sc">$</span>Report <span class="sc">%&gt;%</span></span>
<span id="cb251-2"><a href="regex.html#cb251-2" tabindex="-1"></a>  <span class="fu">str_detect</span>(<span class="at">pattern =</span> <span class="st">&quot;[rR][aä]ub&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb251-3"><a href="regex.html#cb251-3" tabindex="-1"></a>  <span class="fu">sum</span>()</span>
<span id="cb251-4"><a href="regex.html#cb251-4" tabindex="-1"></a><span class="do">## [1] 1492</span></span></code></pre></div>
<p>Let us have a look at some of the strings which returned a <code>TRUE</code> match, using
<code>str_detect()</code> in <code>filter()</code>: telling R we want to see only lines from <code>reports</code>
for which the pattern could be found, and only the first <span class="math inline">\(10\)</span> of those.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="regex.html#cb252-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span></span>
<span id="cb252-2"><a href="regex.html#cb252-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(Report, <span class="at">pattern =</span> <span class="st">&quot;[Rr][aä]ub&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb252-3"><a href="regex.html#cb252-3" tabindex="-1"></a>  <span class="fu">select</span>(Report) <span class="sc">%&gt;%</span> </span>
<span id="cb252-4"><a href="regex.html#cb252-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb252-5"><a href="regex.html#cb252-5" tabindex="-1"></a><span class="do">## # A tibble: 10 × 1</span></span>
<span id="cb252-6"><a href="regex.html#cb252-6" tabindex="-1"></a><span class="do">##    Report                                                           </span></span>
<span id="cb252-7"><a href="regex.html#cb252-7" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                                                            </span></span>
<span id="cb252-8"><a href="regex.html#cb252-8" tabindex="-1"></a><span class="do">##  1 Raub auf Tankstelle - Wer kennt diesen Mann?                     </span></span>
<span id="cb252-9"><a href="regex.html#cb252-9" tabindex="-1"></a><span class="do">##  2 Nachtportier beraubt                                             </span></span>
<span id="cb252-10"><a href="regex.html#cb252-10" tabindex="-1"></a><span class="do">##  3 Ausgeraubt und mit Pistole bedroht                               </span></span>
<span id="cb252-11"><a href="regex.html#cb252-11" tabindex="-1"></a><span class="do">##  4 Raub auf Hotel - Rezeptionist wird bedroht und verletzt          </span></span>
<span id="cb252-12"><a href="regex.html#cb252-12" tabindex="-1"></a><span class="do">##  5 Raub in Hotel                                                    </span></span>
<span id="cb252-13"><a href="regex.html#cb252-13" tabindex="-1"></a><span class="do">##  6 Mutmaßlicher Räuber auf frischer Tat festgenommen                </span></span>
<span id="cb252-14"><a href="regex.html#cb252-14" tabindex="-1"></a><span class="do">##  7 Raubüberfall auf Filiale eines Lieferdienstes                    </span></span>
<span id="cb252-15"><a href="regex.html#cb252-15" tabindex="-1"></a><span class="do">##  8 Mann beraubt - Zeugin gesucht                                    </span></span>
<span id="cb252-16"><a href="regex.html#cb252-16" tabindex="-1"></a><span class="do">##  9 Haftbefehle wegen Raubtaten gegen zwei Tatverdächtige vollstreckt</span></span>
<span id="cb252-17"><a href="regex.html#cb252-17" tabindex="-1"></a><span class="do">## 10 Seniorin wird die Handtasche geraubt</span></span></code></pre></div>
<p>This looks good at a first glance, but consider this result:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="regex.html#cb253-1" tabindex="-1"></a>reports <span class="sc">%&gt;%</span></span>
<span id="cb253-2"><a href="regex.html#cb253-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(Report, <span class="at">pattern =</span> <span class="st">&quot;[Rr][aä]ub&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb253-3"><a href="regex.html#cb253-3" tabindex="-1"></a>  <span class="fu">filter</span>(Date <span class="sc">==</span> <span class="st">&quot;18.06.2021 10:20 Uhr&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb253-4"><a href="regex.html#cb253-4" tabindex="-1"></a>  <span class="fu">select</span>(Report)</span>
<span id="cb253-5"><a href="regex.html#cb253-5" tabindex="-1"></a><span class="do">## # A tibble: 1 × 1</span></span>
<span id="cb253-6"><a href="regex.html#cb253-6" tabindex="-1"></a><span class="do">##   Report                                                                        </span></span>
<span id="cb253-7"><a href="regex.html#cb253-7" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                                                                         </span></span>
<span id="cb253-8"><a href="regex.html#cb253-8" tabindex="-1"></a><span class="do">## 1 &quot;Mit dem Rettungshubschrauber ins Krankenhaus – Motorradfahrer schwer verletz…</span></span></code></pre></div>
<p>Why was a report on a motorcycle accident included? Because the word
“Rettungshubschrauber” also has “raub” in it. You see, how reliably detecting a
simple string such as “raub” gets complicated very quickly.</p>
<p>At this point, we would have to put in the hours and define a list of phrases
referring to robberies that we actually want to select while constructing
regular expressions that select those phrases and only those. This is beyond the
scope of this introductory example, but as a first approximation we could say
that we want to find all instances in which the words begin with a capital “R”,
as in “<em>Raub</em>” or “<em>Räub</em>er”, or where “aub” and “äub” are prefixed with
“ge”, “be” or “zu”, as in “<em>geraub</em>t”, “<em>beraub</em>t”, or “aus<em>zuraub</em>en”. To
achieve this, the regular expression has to allow for four optional substrings,
using <em>grouping</em> and the “OR” operator <code>|</code>. Groups are defined by enclosing
several expressions in parentheses. While groups have advanced functionality,
for now you can interpret them like parentheses in mathematics. The enclosed
expression is evaluated first and as a whole. If one of the prefixes, connected
by <code>|</code>, is found in a string and is then followed up by either “a” or “ä” and
“ub” after this, the pattern is matched.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="regex.html#cb254-1" tabindex="-1"></a>reports<span class="sc">$</span>Report <span class="sc">%&gt;%</span></span>
<span id="cb254-2"><a href="regex.html#cb254-2" tabindex="-1"></a>  <span class="fu">str_detect</span>(<span class="at">pattern =</span> <span class="st">&quot;(R|ger|ber|zur)[aä]ub&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb254-3"><a href="regex.html#cb254-3" tabindex="-1"></a>  <span class="fu">sum</span>()</span>
<span id="cb254-4"><a href="regex.html#cb254-4" tabindex="-1"></a><span class="do">## [1] 1289</span></span></code></pre></div>
<p>There are other words in the German language that are used to describe the
concept of robberies. Adding all of them and the several individual pre- and/or
suffixes that have to be taken into account to reliably select the terms we want
to select and none of those we do not want to select, is beyond the scope of
this example. But we can at least add one further word to the regular
expression. Using the <code>|</code> operator we extend the regular expression to also
detect “dieb” with an upper or lower case “d”. The expression now selects all
ways of writing “raub” and “dieb” we allowed for.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="regex.html#cb255-1" tabindex="-1"></a>reports<span class="sc">$</span>Report <span class="sc">%&gt;%</span></span>
<span id="cb255-2"><a href="regex.html#cb255-2" tabindex="-1"></a>  <span class="fu">str_detect</span>(<span class="at">pattern =</span> <span class="st">&quot;(R|ger|ber|zur)[aä]ub|[Dd]ieb&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb255-3"><a href="regex.html#cb255-3" tabindex="-1"></a>  <span class="fu">sum</span>()</span>
<span id="cb255-4"><a href="regex.html#cb255-4" tabindex="-1"></a><span class="do">## [1] 2052</span></span></code></pre></div>
<p>Now that we have constructed a provisional regular expression that can detect
reports that are related to robberies, we can also compute their relative
proportion. Remember, we are dealing with a logical vector of ones and zeros:
<code>sum()</code> counts all ones and thus returns the absolute number of reports and
<code>mean()</code> divides the number of ones by the number of all reports, thus returning
the relative proportion.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="regex.html#cb256-1" tabindex="-1"></a>reports<span class="sc">$</span>Report <span class="sc">%&gt;%</span></span>
<span id="cb256-2"><a href="regex.html#cb256-2" tabindex="-1"></a>  <span class="fu">str_detect</span>(<span class="at">pattern =</span> <span class="st">&quot;(R|ger|ber|zur)[aä]ub|[Dd]ieb&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb256-3"><a href="regex.html#cb256-3" tabindex="-1"></a>  <span class="fu">mean</span>()</span>
<span id="cb256-4"><a href="regex.html#cb256-4" tabindex="-1"></a><span class="do">## [1] 0.09367724</span></span></code></pre></div>
<p>So about <span class="math inline">\(9.4\)</span>% of police reports deal with robberies if we apply the regular
expression constructed above. Remember, that we might still match some words
that we do not want to match, while missing others that also relate to robberies.
Thus the actual percentage may differ.</p>
</div>
<div id="extracting-details-from-a-list-of-names" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> Extracting details from a list of names<a href="regex.html#extracting-details-from-a-list-of-names" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The website
<a href="https://www.bundeswahlleiter.de/bundestagswahlen/2021/gewaehlte/bund-99/" target="_blank">https://www.bundeswahlleiter.de/bundestagswahlen/2021/gewaehlte/bund-99/</a>
lists all German members of parliament in tables, with the first column holding
the full names and academic degrees in one character string. A common
application of regular expressions in the context of web scraping is to extract
substrings of interest from such text.</p>
<p>We will first scrape the data. The members of parliament are divided into 26
subpages, one for each first letter of their last names, in the form “a.html”,
“b.html” and so on. We construct links to all these pages using the base R
object <code>letters</code>, a character vector conveniently containing all 26 letters of
the alphabet in lower case. We then read the links and extract the table cells
containing the names into a character vector, which is then transformed into a
tibble.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="regex.html#cb257-1" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb257-2"><a href="regex.html#cb257-2" tabindex="-1"></a></span>
<span id="cb257-3"><a href="regex.html#cb257-3" tabindex="-1"></a>website <span class="ot">&lt;-</span> <span class="st">&quot;https://www.bundeswahlleiter.de/bundestagswahlen/2021/gewaehlte/bund-99/&quot;</span></span>
<span id="cb257-4"><a href="regex.html#cb257-4" tabindex="-1"></a>links <span class="ot">&lt;-</span> <span class="fu">str_c</span>(website, letters, <span class="st">&quot;.html&quot;</span>)</span>
<span id="cb257-5"><a href="regex.html#cb257-5" tabindex="-1"></a></span>
<span id="cb257-6"><a href="regex.html#cb257-6" tabindex="-1"></a>pages <span class="ot">&lt;-</span> links <span class="sc">%&gt;%</span></span>
<span id="cb257-7"><a href="regex.html#cb257-7" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> {</span>
<span id="cb257-8"><a href="regex.html#cb257-8" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb257-9"><a href="regex.html#cb257-9" tabindex="-1"></a>    <span class="fu">read_html</span>(.x)</span>
<span id="cb257-10"><a href="regex.html#cb257-10" tabindex="-1"></a>  })</span>
<span id="cb257-11"><a href="regex.html#cb257-11" tabindex="-1"></a></span>
<span id="cb257-12"><a href="regex.html#cb257-12" tabindex="-1"></a>names <span class="ot">&lt;-</span> pages <span class="sc">%&gt;%</span></span>
<span id="cb257-13"><a href="regex.html#cb257-13" tabindex="-1"></a>  <span class="fu">map</span>(html_elements, <span class="at">css =</span> <span class="st">&quot;th[scope=&#39;row&#39;]&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb257-14"><a href="regex.html#cb257-14" tabindex="-1"></a>  <span class="fu">map</span>(html_text, <span class="at">trim =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb257-15"><a href="regex.html#cb257-15" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb257-16"><a href="regex.html#cb257-16" tabindex="-1"></a></span>
<span id="cb257-17"><a href="regex.html#cb257-17" tabindex="-1"></a>names_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb257-18"><a href="regex.html#cb257-18" tabindex="-1"></a>  <span class="at">full_name =</span> names</span>
<span id="cb257-19"><a href="regex.html#cb257-19" tabindex="-1"></a>)</span></code></pre></div>
<p>Our goal is to extract the academic degree from strings of full names. We first
need to understand the pattern of how degrees are listed in those strings. Let
us look at some members of parliament with and without degrees. To filter a
tibble by row numbers, we can conveniently use <code>slice()</code> from <strong>dplyr</strong>:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="regex.html#cb258-1" tabindex="-1"></a>names_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="regex.html#cb258-2" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">186</span><span class="sc">:</span><span class="dv">189</span>)</span>
<span id="cb258-3"><a href="regex.html#cb258-3" tabindex="-1"></a><span class="do">## # A tibble: 4 × 1</span></span>
<span id="cb258-4"><a href="regex.html#cb258-4" tabindex="-1"></a><span class="do">##   full_name                        </span></span>
<span id="cb258-5"><a href="regex.html#cb258-5" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                            </span></span>
<span id="cb258-6"><a href="regex.html#cb258-6" tabindex="-1"></a><span class="do">## 1 Gramling, Fabian Benedikt Meinrad</span></span>
<span id="cb258-7"><a href="regex.html#cb258-7" tabindex="-1"></a><span class="do">## 2 Dr. Gräßle, Ingeborg Gabriele    </span></span>
<span id="cb258-8"><a href="regex.html#cb258-8" tabindex="-1"></a><span class="do">## 3 Prof. Dr. Grau, Armin Jürgen     </span></span>
<span id="cb258-9"><a href="regex.html#cb258-9" tabindex="-1"></a><span class="do">## 4 Gremmels, Timon</span></span></code></pre></div>
<p>If the members of parliament carry an academic degree, the string begins with
it and the abbreviated titles always end in a dot. Based on this, we can start
constructing a regular expression that will be used to detect and extract
academic degrees.</p>
<p>We know that if there is a degree, it is listed at the beginning of the string.
We can refer to the beginning and ending of a string by using an <em>anchor</em>.
Writing <code>^</code> in a regular expression refers to the beginning of a string, <code>$</code> to
the ending. Being a predefined class that includes all upper and lower case
letters of the alphabet, we will use <code>[:alpha:]</code> to refer to letters in general.
<code>"^[:alpha:]"</code> will select <em>one</em> upper or lower case letter that is the first
character in a string.</p>
<p>We do not want to select only one character but complete titles. For this we
need to use <em>quantifiers</em>. These are used to define how often elements of an
expression are allowed or required to be repeated. If we know the exact number
of repetitions, we can set this number contained in <code>{}</code> after an element.
<code>"^[:alpha:]{2}"</code> will select the first two letters in each string; always
exactly <em>two</em>. The actual titles vary in the number of letters they contain. To
allow for variation in the number of repetitions we use the quantifiers <code>?</code>, <code>*</code>
and <code>+</code>. <code>?</code> stands for zero or one, <code>*</code> for zero or multiple and <code>+</code> for one or
multiple repetitions, multiple meaning <span class="math inline">\(n &gt;=1\)</span>.</p>
<p><code>"^[:alpha:]+"</code> will select the word a string begins with. <code>[:alpha:]</code> does not
contain any whitespace or punctuation characters. Therefore, the regular
expression will begin selecting letters at the beginning of a string until it
“hits” a whitespace or punctuation character. For members of parliament without
a degree, this would select their last name. To make sure we only select titles,
we can make use of the fact that all titles in this data end with a “.”. As the
dot is a special character – standing for <em>any</em> character – we have to escape
it by using two backslashes.</p>
<p>The regular expression <code>"^[:alpha:]+\\."</code> selects all words at the beginning of
a string that end with a dot. We use it in the function <code>str_extract()</code> which
will extract the substring that is specified by the regular expression if it
could be matched in the string. We use the function inside of <code>mutate()</code> to
assign the extracted degrees into a new column. To get an overview of the
result, we group the data by this new column and count the occurrences per
group.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="regex.html#cb259-1" tabindex="-1"></a>names_tbl <span class="sc">%&gt;%</span></span>
<span id="cb259-2"><a href="regex.html#cb259-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">academic =</span> <span class="fu">str_extract</span>(full_name, <span class="at">pattern =</span> <span class="st">&quot;^[:alpha:]+</span><span class="sc">\\</span><span class="st">.&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb259-3"><a href="regex.html#cb259-3" tabindex="-1"></a>  <span class="fu">group_by</span>(academic) <span class="sc">%&gt;%</span></span>
<span id="cb259-4"><a href="regex.html#cb259-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">n</span>())</span>
<span id="cb259-5"><a href="regex.html#cb259-5" tabindex="-1"></a><span class="do">## # A tibble: 3 × 2</span></span>
<span id="cb259-6"><a href="regex.html#cb259-6" tabindex="-1"></a><span class="do">##   academic `n()`</span></span>
<span id="cb259-7"><a href="regex.html#cb259-7" tabindex="-1"></a><span class="do">##   &lt;chr&gt;    &lt;int&gt;</span></span>
<span id="cb259-8"><a href="regex.html#cb259-8" tabindex="-1"></a><span class="do">## 1 Dr.        111</span></span>
<span id="cb259-9"><a href="regex.html#cb259-9" tabindex="-1"></a><span class="do">## 2 Prof.        5</span></span>
<span id="cb259-10"><a href="regex.html#cb259-10" tabindex="-1"></a><span class="do">## 3 &lt;NA&gt;       620</span></span></code></pre></div>
<p>We successfully identified a high percentage of doctors, as well as some
professors. Let us also check, how it worked for the four members of parliament
we examined above.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="regex.html#cb260-1" tabindex="-1"></a>names_tbl <span class="sc">%&gt;%</span></span>
<span id="cb260-2"><a href="regex.html#cb260-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">academic =</span> <span class="fu">str_extract</span>(full_name, <span class="at">pattern =</span> <span class="st">&quot;^[:alpha:]+</span><span class="sc">\\</span><span class="st">.&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb260-3"><a href="regex.html#cb260-3" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">186</span><span class="sc">:</span><span class="dv">189</span>)</span>
<span id="cb260-4"><a href="regex.html#cb260-4" tabindex="-1"></a><span class="do">## # A tibble: 4 × 2</span></span>
<span id="cb260-5"><a href="regex.html#cb260-5" tabindex="-1"></a><span class="do">##   full_name                         academic</span></span>
<span id="cb260-6"><a href="regex.html#cb260-6" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                             &lt;chr&gt;   </span></span>
<span id="cb260-7"><a href="regex.html#cb260-7" tabindex="-1"></a><span class="do">## 1 Gramling, Fabian Benedikt Meinrad &lt;NA&gt;    </span></span>
<span id="cb260-8"><a href="regex.html#cb260-8" tabindex="-1"></a><span class="do">## 2 Dr. Gräßle, Ingeborg Gabriele     Dr.     </span></span>
<span id="cb260-9"><a href="regex.html#cb260-9" tabindex="-1"></a><span class="do">## 3 Prof. Dr. Grau, Armin Jürgen      Prof.   </span></span>
<span id="cb260-10"><a href="regex.html#cb260-10" tabindex="-1"></a><span class="do">## 4 Gremmels, Timon                   &lt;NA&gt;</span></span></code></pre></div>
<p>Members of parliament without a degree received an <code>NA</code>, which is correct. For
observations with one title, it also worked, but for cases with multiple titles
– i.e. “Prof. Dr.”, it did not. But we can extend the expression to allow for
multiple titles as well.</p>
<p>If there are two or more components to a title, they are separated by
whitespace; which we can refer to using <code>\\s</code>. After the whitespace there will
be another word ending in a dot. Thus we can reuse the first part of the
expression, without the anchor: <code>"\\s[:alpha:]+\\."</code>. Some members of parliament
have one title, others have multiple. We have to allow both. A quantifier that
follows a part of an expression grouped by enclosure in parentheses will refer
to the complete group. The regular expression <code>"(\\s[:alpha:]+\\.)*"</code> allows for
no additional title or for multiple ones. Appending this to the regular
expression used in the code above allows us to select and extract one or more
titles.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="regex.html#cb261-1" tabindex="-1"></a>names_tbl <span class="sc">%&gt;%</span></span>
<span id="cb261-2"><a href="regex.html#cb261-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">academic =</span> <span class="fu">str_extract</span>(full_name, <span class="at">pattern =</span> <span class="st">&quot;^[:alpha:]+</span><span class="sc">\\</span><span class="st">.(</span><span class="sc">\\</span><span class="st">s[:alpha:]+</span><span class="sc">\\</span><span class="st">.)*&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb261-3"><a href="regex.html#cb261-3" tabindex="-1"></a>  <span class="fu">group_by</span>(academic) <span class="sc">%&gt;%</span></span>
<span id="cb261-4"><a href="regex.html#cb261-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">n</span>())</span>
<span id="cb261-5"><a href="regex.html#cb261-5" tabindex="-1"></a><span class="do">## # A tibble: 3 × 2</span></span>
<span id="cb261-6"><a href="regex.html#cb261-6" tabindex="-1"></a><span class="do">##   academic  `n()`</span></span>
<span id="cb261-7"><a href="regex.html#cb261-7" tabindex="-1"></a><span class="do">##   &lt;chr&gt;     &lt;int&gt;</span></span>
<span id="cb261-8"><a href="regex.html#cb261-8" tabindex="-1"></a><span class="do">## 1 Dr.         111</span></span>
<span id="cb261-9"><a href="regex.html#cb261-9" tabindex="-1"></a><span class="do">## 2 Prof. Dr.     5</span></span>
<span id="cb261-10"><a href="regex.html#cb261-10" tabindex="-1"></a><span class="do">## 3 &lt;NA&gt;        620</span></span></code></pre></div>
<p>Let us confirm that it worked correctly:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="regex.html#cb262-1" tabindex="-1"></a>names_tbl <span class="sc">%&gt;%</span></span>
<span id="cb262-2"><a href="regex.html#cb262-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">academic =</span> <span class="fu">str_extract</span>(full_name, <span class="at">pattern =</span> <span class="st">&quot;^[:alpha:]+</span><span class="sc">\\</span><span class="st">.(</span><span class="sc">\\</span><span class="st">s[:alpha:]+</span><span class="sc">\\</span><span class="st">.)*&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb262-3"><a href="regex.html#cb262-3" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">186</span><span class="sc">:</span><span class="dv">189</span>)</span>
<span id="cb262-4"><a href="regex.html#cb262-4" tabindex="-1"></a><span class="do">## # A tibble: 4 × 2</span></span>
<span id="cb262-5"><a href="regex.html#cb262-5" tabindex="-1"></a><span class="do">##   full_name                         academic </span></span>
<span id="cb262-6"><a href="regex.html#cb262-6" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                             &lt;chr&gt;    </span></span>
<span id="cb262-7"><a href="regex.html#cb262-7" tabindex="-1"></a><span class="do">## 1 Gramling, Fabian Benedikt Meinrad &lt;NA&gt;     </span></span>
<span id="cb262-8"><a href="regex.html#cb262-8" tabindex="-1"></a><span class="do">## 2 Dr. Gräßle, Ingeborg Gabriele     Dr.      </span></span>
<span id="cb262-9"><a href="regex.html#cb262-9" tabindex="-1"></a><span class="do">## 3 Prof. Dr. Grau, Armin Jürgen      Prof. Dr.</span></span>
<span id="cb262-10"><a href="regex.html#cb262-10" tabindex="-1"></a><span class="do">## 4 Gremmels, Timon                   &lt;NA&gt;</span></span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ggplot.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/webscraping-tures/webscraping-tures.github.io/13-regex.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
