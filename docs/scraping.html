<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Scraping Berlin police reports | Web Scraping using R</title>
  <meta name="description" content="10 Scraping Berlin police reports | Web Scraping using R" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Scraping Berlin police reports | Web Scraping using R" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="jakobtures.github.io/web-scraping/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Scraping Berlin police reports | Web Scraping using R" />
  
  
  

<meta name="author" content="Jakob Tures" />


<meta name="date" content="2023-10-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="goodpractice.html"/>
<link rel="next" href="dplyr.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/echarts4r-4.8.0/echarts-en.min.js"></script>
<script src="libs/echarts4r-4.8.0/ecStat.min.js"></script>
<script src="libs/echarts4r-4.8.0/dataTool.min.js"></script>
<script src="libs/echarts4r-binding-0.4.5/echarts4r.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
Web Scraping using R

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-web-scraping"><i class="fa fa-check"></i>What is web scraping?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-contents"><i class="fa fa-check"></i>Course contents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#technical-requirements"><i class="fa fa-check"></i>Technical requirements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul></li>
<li class="part"><span><b>I R Basics, tidyverse &amp; R Markdown</b></span></li>
<li class="chapter" data-level="1" data-path="R1.html"><a href="R1.html"><i class="fa fa-check"></i><b>1</b> R &amp; R Studio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="R1.html"><a href="R1.html#installing-r"><i class="fa fa-check"></i><b>1.1</b> Installing R</a></li>
<li class="chapter" data-level="1.2" data-path="R1.html"><a href="R1.html#rstudio"><i class="fa fa-check"></i><b>1.2</b> RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="R1.html"><a href="R1.html#overview"><i class="fa fa-check"></i><b>1.2.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="R1.html"><a href="R1.html#hello-world"><i class="fa fa-check"></i><b>1.3</b> Hello World!</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="R1.html"><a href="R1.html#calculating-with-r"><i class="fa fa-check"></i><b>1.3.1</b> Calculating with R</a></li>
<li class="chapter" data-level="1.3.2" data-path="R1.html"><a href="R1.html#comparison"><i class="fa fa-check"></i><b>1.3.2</b> Comparison operators</a></li>
<li class="chapter" data-level="1.3.3" data-path="R1.html"><a href="R1.html#logical-operators"><i class="fa fa-check"></i><b>1.3.3</b> Logical operators</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="R1.html"><a href="R1.html#objects"><i class="fa fa-check"></i><b>1.4</b> Objects</a></li>
<li class="chapter" data-level="1.5" data-path="R1.html"><a href="R1.html#vectors"><i class="fa fa-check"></i><b>1.5</b> Vectors</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="R1.html"><a href="R1.html#subsetting"><i class="fa fa-check"></i><b>1.5.1</b> Subsetting</a></li>
<li class="chapter" data-level="1.5.2" data-path="R1.html"><a href="R1.html#types-of-vectors"><i class="fa fa-check"></i><b>1.5.2</b> Types of vectors</a></li>
<li class="chapter" data-level="1.5.3" data-path="R1.html"><a href="R1.html#a-brief-look-at-lists"><i class="fa fa-check"></i><b>1.5.3</b> A brief look at lists</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="R1.html"><a href="R1.html#functions"><i class="fa fa-check"></i><b>1.6</b> Functions</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="R1.html"><a href="R1.html#help"><i class="fa fa-check"></i><b>1.6.1</b> Help</a></li>
<li class="chapter" data-level="1.6.2" data-path="R1.html"><a href="R1.html#examples-basic-statistical-functions"><i class="fa fa-check"></i><b>1.6.2</b> Examples: Basic statistical functions</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="R1.html"><a href="R1.html#rstudio-workflow"><i class="fa fa-check"></i><b>1.7</b> RStudio Workflow</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="R1.html"><a href="R1.html#r-scripts"><i class="fa fa-check"></i><b>1.7.1</b> R Scripts</a></li>
<li class="chapter" data-level="1.7.2" data-path="R1.html"><a href="R1.html#projects"><i class="fa fa-check"></i><b>1.7.2</b> Projects</a></li>
<li class="chapter" data-level="1.7.3" data-path="R1.html"><a href="R1.html#comments"><i class="fa fa-check"></i><b>1.7.3</b> Comments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="R2.html"><a href="R2.html"><i class="fa fa-check"></i><b>2</b> Packages, the tidyverse and R Markdown</a>
<ul>
<li class="chapter" data-level="2.1" data-path="R2.html"><a href="R2.html#r-packages"><i class="fa fa-check"></i><b>2.1</b> R packages</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="R2.html"><a href="R2.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>2.1.1</b> Installing and loading packages</a></li>
<li class="chapter" data-level="2.1.2" data-path="R2.html"><a href="R2.html#namespaces"><i class="fa fa-check"></i><b>2.1.2</b> Namespaces</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="R2.html"><a href="R2.html#tidyverse"><i class="fa fa-check"></i><b>2.2</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="R2.html"><a href="R2.html#tibbles"><i class="fa fa-check"></i><b>2.2.1</b> Tibbles</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="R2.html"><a href="R2.html#additional-r-resources"><i class="fa fa-check"></i><b>2.3</b> Additional R resources</a></li>
<li class="chapter" data-level="2.4" data-path="R2.html"><a href="R2.html#intro-to-r-markdown"><i class="fa fa-check"></i><b>2.4</b> Intro to R Markdown</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="R2.html"><a href="R2.html#what-is-r-markdown"><i class="fa fa-check"></i><b>2.4.1</b> What is R Markdown?</a></li>
<li class="chapter" data-level="2.4.2" data-path="R2.html"><a href="R2.html#creating-a-r-markdown-file"><i class="fa fa-check"></i><b>2.4.2</b> Creating a R Markdown file</a></li>
<li class="chapter" data-level="2.4.3" data-path="R2.html"><a href="R2.html#writing-in-r-markdown"><i class="fa fa-check"></i><b>2.4.3</b> Writing in R Markdown</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Scraping</b></span></li>
<li class="chapter" data-level="3" data-path="html.html"><a href="html.html"><i class="fa fa-check"></i><b>3</b> HTML as a cornerstone of the internet</a>
<ul>
<li class="chapter" data-level="3.1" data-path="html.html"><a href="html.html#html-tags"><i class="fa fa-check"></i><b>3.1</b> HTML-Tags</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="html.html"><a href="html.html#hello_world.html"><i class="fa fa-check"></i><b>3.1.1</b> hello_world.html</a></li>
<li class="chapter" data-level="3.1.2" data-path="html.html"><a href="html.html#important-tags"><i class="fa fa-check"></i><b>3.1.2</b> Important tags</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="html.html"><a href="html.html#attribute"><i class="fa fa-check"></i><b>3.2</b> Attributes</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="html.html"><a href="html.html#links"><i class="fa fa-check"></i><b>3.2.1</b> Links</a></li>
<li class="chapter" data-level="3.2.2" data-path="html.html"><a href="html.html#images"><i class="fa fa-check"></i><b>3.2.2</b> Images</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="html.html"><a href="html.html#entities"><i class="fa fa-check"></i><b>3.3</b> Entities</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rvest1.html"><a href="rvest1.html"><i class="fa fa-check"></i><b>4</b> First scraping with rvest</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rvest1.html"><a href="rvest1.html#the-rvest-package"><i class="fa fa-check"></i><b>4.1</b> The rvest package</a></li>
<li class="chapter" data-level="4.2" data-path="rvest1.html"><a href="rvest1.html#hello_world.html-1"><i class="fa fa-check"></i><b>4.2</b> hello_world.html</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rvest1.html"><a href="rvest1.html#read_html"><i class="fa fa-check"></i><b>4.2.1</b> read_html()</a></li>
<li class="chapter" data-level="4.2.2" data-path="rvest1.html"><a href="rvest1.html#html_elements"><i class="fa fa-check"></i><b>4.2.2</b> html_elements()</a></li>
<li class="chapter" data-level="4.2.3" data-path="rvest1.html"><a href="rvest1.html#html_text"><i class="fa fa-check"></i><b>4.2.3</b> html_text()</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rvest1.html"><a href="rvest1.html#countries-of-the-world"><i class="fa fa-check"></i><b>4.3</b> Countries of the World</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rvest1.html"><a href="rvest1.html#country-names"><i class="fa fa-check"></i><b>4.3.1</b> Country names</a></li>
<li class="chapter" data-level="4.3.2" data-path="rvest1.html"><a href="rvest1.html#capitals-population-and-area"><i class="fa fa-check"></i><b>4.3.2</b> Capitals, population and area</a></li>
<li class="chapter" data-level="4.3.3" data-path="rvest1.html"><a href="rvest1.html#merge-into-one-tibble"><i class="fa fa-check"></i><b>4.3.3</b> Merge into one tibble</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html"><i class="fa fa-check"></i><b>5</b> CSS selectors &amp; Developer Tools</a>
<ul>
<li class="chapter" data-level="5.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#css"><i class="fa fa-check"></i><b>5.1</b> CSS selectors</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#classes"><i class="fa fa-check"></i><b>5.1.1</b> Classes</a></li>
<li class="chapter" data-level="5.1.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#ids"><i class="fa fa-check"></i><b>5.1.2</b> IDs</a></li>
<li class="chapter" data-level="5.1.3" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#attributes"><i class="fa fa-check"></i><b>5.1.3</b> Attributes</a></li>
<li class="chapter" data-level="5.1.4" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#hierarchy-levels"><i class="fa fa-check"></i><b>5.1.4</b> Hierarchy levels</a></li>
<li class="chapter" data-level="5.1.5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#further-selectors"><i class="fa fa-check"></i><b>5.1.5</b> Further selectors</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#developer-tools"><i class="fa fa-check"></i><b>5.2</b> Developer Tools</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rvest2.html"><a href="rvest2.html"><i class="fa fa-check"></i><b>6</b> Scraping of tables &amp; dynamic websites</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rvest2.html"><a href="rvest2.html#scraping-of-tables"><i class="fa fa-check"></i><b>6.1</b> Scraping of tables</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="rvest2.html"><a href="rvest2.html#table-with-css-selectors-from-wikipedia"><i class="fa fa-check"></i><b>6.1.1</b> Table with CSS selectors from Wikipedia</a></li>
<li class="chapter" data-level="6.1.2" data-path="rvest2.html"><a href="rvest2.html#scraping-multiple-tables"><i class="fa fa-check"></i><b>6.1.2</b> Scraping multiple tables</a></li>
<li class="chapter" data-level="6.1.3" data-path="rvest2.html"><a href="rvest2.html#tabellen-mit-nas"><i class="fa fa-check"></i><b>6.1.3</b> Tabellen mit NAs</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="rvest2.html"><a href="rvest2.html#dynamic-websites"><i class="fa fa-check"></i><b>6.2</b> Dynamic Websites</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rvest2.html"><a href="rvest2.html#html-forms-and-html-queries"><i class="fa fa-check"></i><b>6.2.1</b> HTML forms and HTML queries</a></li>
<li class="chapter" data-level="6.2.2" data-path="rvest2.html"><a href="rvest2.html#html-forms"><i class="fa fa-check"></i><b>6.2.2</b> HTML forms</a></li>
<li class="chapter" data-level="6.2.3" data-path="rvest2.html"><a href="rvest2.html#the-query"><i class="fa fa-check"></i><b>6.2.3</b> The query</a></li>
<li class="chapter" data-level="6.2.4" data-path="rvest2.html"><a href="rvest2.html#manipulating-the-query-and-scraping-the-result"><i class="fa fa-check"></i><b>6.2.4</b> Manipulating the query and scraping the result</a></li>
<li class="chapter" data-level="6.2.5" data-path="rvest2.html"><a href="rvest2.html#additional-resources"><i class="fa fa-check"></i><b>6.2.5</b> Additional resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rvest3.html"><a href="rvest3.html"><i class="fa fa-check"></i><b>7</b> Scraping of multi-page websites</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rvest3.html"><a href="rvest3.html#index-pages"><i class="fa fa-check"></i><b>7.1</b> Index-pages</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rvest3.html"><a href="rvest3.html#scraping-of-the-index"><i class="fa fa-check"></i><b>7.1.1</b> Scraping of the index</a></li>
<li class="chapter" data-level="7.1.2" data-path="rvest3.html"><a href="rvest3.html#iteration-with-map"><i class="fa fa-check"></i><b>7.1.2</b> Iteration with map()</a></li>
<li class="chapter" data-level="7.1.3" data-path="rvest3.html"><a href="rvest3.html#scraping-the-sub-pages"><i class="fa fa-check"></i><b>7.1.3</b> Scraping the sub-pages</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rvest3.html"><a href="rvest3.html#pagination"><i class="fa fa-check"></i><b>7.2</b> Pagination</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rvest3.html"><a href="rvest3.html#the-query-1"><i class="fa fa-check"></i><b>7.2.1</b> The query</a></li>
<li class="chapter" data-level="7.2.2" data-path="rvest3.html"><a href="rvest3.html#sub-pgs"><i class="fa fa-check"></i><b>7.2.2</b> Scraping the sub-pages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="files.html"><a href="files.html"><i class="fa fa-check"></i><b>8</b> Downloading and saving files</a>
<ul>
<li class="chapter" data-level="8.1" data-path="files.html"><a href="files.html#CSV"><i class="fa fa-check"></i><b>8.1</b> CSV files</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="files.html"><a href="files.html#parsing-a-csv-file"><i class="fa fa-check"></i><b>8.1.1</b> Parsing a CSV file</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="files.html"><a href="files.html#downloading-files"><i class="fa fa-check"></i><b>8.2</b> Downloading files</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="files.html"><a href="files.html#parsing-the-csv-files"><i class="fa fa-check"></i><b>8.2.1</b> Parsing the CSV files</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="files.html"><a href="files.html#saving-data-files"><i class="fa fa-check"></i><b>8.3</b> Saving data files</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="goodpractice.html"><a href="goodpractice.html"><i class="fa fa-check"></i><b>9</b> Good practice</a>
<ul>
<li class="chapter" data-level="9.1" data-path="goodpractice.html"><a href="goodpractice.html#we-aint-no-web-crawlers"><i class="fa fa-check"></i><b>9.1</b> We ain’t no web crawlers</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="goodpractice.html"><a href="goodpractice.html#on-robots.txt-files"><i class="fa fa-check"></i><b>9.1.1</b> On robots.txt files</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="goodpractice.html"><a href="goodpractice.html#reduce-traffic"><i class="fa fa-check"></i><b>9.2</b> Reduce traffic</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="goodpractice.html"><a href="goodpractice.html#waiting-times-in-action"><i class="fa fa-check"></i><b>9.2.1</b> Waiting times in action</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="goodpractice.html"><a href="goodpractice.html#citation-and-an-additional-resource"><i class="fa fa-check"></i><b>9.3</b> Citation and an additional resource</a></li>
</ul></li>
<li class="part"><span><b>III Sample project</b></span></li>
<li class="chapter" data-level="10" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>10</b> Scraping Berlin police reports</a>
<ul>
<li class="chapter" data-level="10.1" data-path="scraping.html"><a href="scraping.html#topic-and-data"><i class="fa fa-check"></i><b>10.1</b> Topic and data</a></li>
<li class="chapter" data-level="10.2" data-path="scraping.html"><a href="scraping.html#scraping-the-data"><i class="fa fa-check"></i><b>10.2</b> Scraping the data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="scraping.html"><a href="scraping.html#gathering-the-links"><i class="fa fa-check"></i><b>10.2.1</b> Gathering the links</a></li>
<li class="chapter" data-level="10.2.2" data-path="scraping.html"><a href="scraping.html#downloading-the-subpages"><i class="fa fa-check"></i><b>10.2.2</b> Downloading the subpages</a></li>
<li class="chapter" data-level="10.2.3" data-path="scraping.html"><a href="scraping.html#extracting-the-data-of-interest"><i class="fa fa-check"></i><b>10.2.3</b> Extracting the data of interest</a></li>
<li class="chapter" data-level="10.2.4" data-path="scraping.html"><a href="scraping.html#saving-the-data"><i class="fa fa-check"></i><b>10.2.4</b> Saving the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>11</b> Transformation with dplyr</a>
<ul>
<li class="chapter" data-level="11.1" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>11.1</b> <code>mutate()</code></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="dplyr.html"><a href="dplyr.html#computing-new-variables-from-existing-ones"><i class="fa fa-check"></i><b>11.1.1</b> Computing new variables from existing ones</a></li>
<li class="chapter" data-level="11.1.2" data-path="dplyr.html"><a href="dplyr.html#clean"><i class="fa fa-check"></i><b>11.1.2</b> Cleaning the data on police reports</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="dplyr.html"><a href="dplyr.html#select"><i class="fa fa-check"></i><b>11.2</b> <code>select()</code></a></li>
<li class="chapter" data-level="11.3" data-path="dplyr.html"><a href="dplyr.html#rename"><i class="fa fa-check"></i><b>11.3</b> <code>rename()</code></a></li>
<li class="chapter" data-level="11.4" data-path="dplyr.html"><a href="dplyr.html#filter"><i class="fa fa-check"></i><b>11.4</b> <code>filter()</code></a></li>
<li class="chapter" data-level="11.5" data-path="dplyr.html"><a href="dplyr.html#summarise-group_by"><i class="fa fa-check"></i><b>11.5</b> <code>summarise()</code> &amp; <code>group_by()</code></a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="dplyr.html"><a href="dplyr.html#number-of-reports-by-groups"><i class="fa fa-check"></i><b>11.5.1</b> Number of reports by groups</a></li>
<li class="chapter" data-level="11.5.2" data-path="dplyr.html"><a href="dplyr.html#summary-statistics-on-the-time"><i class="fa fa-check"></i><b>11.5.2</b> Summary statistics on the time</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="dplyr.html"><a href="dplyr.html#exporting-tables"><i class="fa fa-check"></i><b>11.6</b> Exporting tables</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="dplyr.html"><a href="dplyr.html#further-resources"><i class="fa fa-check"></i><b>11.6.1</b> Further resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>12</b> Graphical analysis with ggplot</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ggplot.html"><a href="ggplot.html#ggplot2-syntax"><i class="fa fa-check"></i><b>12.1</b> ggplot2 syntax</a></li>
<li class="chapter" data-level="12.2" data-path="ggplot.html"><a href="ggplot.html#geoms-and-aesthetics"><i class="fa fa-check"></i><b>12.2</b> Geoms and aesthetics</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="ggplot.html"><a href="ggplot.html#continuous-x-continuous-y"><i class="fa fa-check"></i><b>12.2.1</b> Continuous x, continuous y</a></li>
<li class="chapter" data-level="12.2.2" data-path="ggplot.html"><a href="ggplot.html#graphical-analysis-of-berlin-police-reports"><i class="fa fa-check"></i><b>12.2.2</b> Graphical analysis of Berlin police reports</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="ggplot.html"><a href="ggplot.html#exporting-plots"><i class="fa fa-check"></i><b>12.3</b> Exporting plots</a></li>
</ul></li>
<li class="part"><span><b>IV Regular expressions</b></span></li>
<li class="chapter" data-level="13" data-path="regex.html"><a href="regex.html"><i class="fa fa-check"></i><b>13</b> Regular expressions</a>
<ul>
<li class="chapter" data-level="13.1" data-path="regex.html"><a href="regex.html#cleaning-the-district-column"><i class="fa fa-check"></i><b>13.1</b> Cleaning the <code>district</code> column</a></li>
<li class="chapter" data-level="13.2" data-path="regex.html"><a href="regex.html#detecting-robberies-in-police-reports"><i class="fa fa-check"></i><b>13.2</b> Detecting robberies in police reports</a></li>
<li class="chapter" data-level="13.3" data-path="regex.html"><a href="regex.html#extracting-details-from-a-list-of-names"><i class="fa fa-check"></i><b>13.3</b> Extracting details from a list of names</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Web Scraping using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scraping" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Scraping Berlin police reports<a href="scraping.html#scraping" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Over the next three chapters we will follow a small sample project. In this
chapter we will briefly outline the research topic and scrape the data.
In the next two chapters we will concern ourselfes with cleaning, transforming
and analysing the data. First statistically, then grapically.</p>
<div id="topic-and-data" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Topic and data<a href="scraping.html#topic-and-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This sample project aims to analyse police reports in Berlin. Specifically, we
will try to answer two questions:</p>
<ul>
<li>Does the number of reports differ by district?</li>
<li>Does the number of reports differ over time?
<ul>
<li>over years</li>
<li>over months</li>
<li>over days of the week</li>
<li>over time of day</li>
</ul></li>
</ul>
<p>Note that these are ad hoc questions constructed for this sample project. In a real
research project, we would have to motivate the research question more clearly
and develop hyotheses based on theoretical considerations and existing research.
These steps are skipped here to keep the focus on scraping the data and basic
methods of data analysis.</p>
<p>Now that topic and questions are defined, we need some data to answer them.
The website
<a href="https://www.berlin.de/polizei/polizeimeldungen/archiv/" target="_blank">https://www.berlin.de/polizei/polizeimeldungen/archiv/</a>
contains reports by the Berlin police that are open to the public, beginning
with the year 2014. We will gather the links to all subpages, download them and
extract the text of the report, as well as the date, time and district where it
occurred.</p>
</div>
<div id="scraping-the-data" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Scraping the data<a href="scraping.html#scraping-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="gathering-the-links" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Gathering the links<a href="scraping.html#gathering-the-links" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="scraping.html#cb179-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb179-2"><a href="scraping.html#cb179-2" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code></pre></div>
<p>We begin by downloading the mainpage.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="scraping.html#cb180-1" tabindex="-1"></a>website <span class="ot">&lt;-</span> <span class="st">&quot;https://www.berlin.de/polizei/polizeimeldungen/archiv/&quot;</span> <span class="sc">%&gt;%</span> </span>
<span id="cb180-2"><a href="scraping.html#cb180-2" tabindex="-1"></a>  <span class="fu">read_html</span>()</span></code></pre></div>
<p>The next step is to extract the URLs for the yearly archives. All the <code>&lt;a&gt;</code> tags
that contain those links, have a <code>title=</code> attribute whose value begins with
“Link”. Also they are contained in a <code>&lt;div&gt;</code> tag with the class <code>textile</code>. We
can use this in selector construction, extract the value of the <code>href=</code>
attribute and, as they are incomplete URLs, append them to the base URL.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="scraping.html#cb181-1" tabindex="-1"></a>links <span class="ot">&lt;-</span> website <span class="sc">%&gt;%</span> </span>
<span id="cb181-2"><a href="scraping.html#cb181-2" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="at">css =</span> <span class="st">&quot;div.textile a[title^=&#39;Link&#39;]&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb181-3"><a href="scraping.html#cb181-3" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="at">name =</span> <span class="st">&quot;href&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb181-4"><a href="scraping.html#cb181-4" tabindex="-1"></a>  <span class="fu">str_c</span>(<span class="st">&quot;https://www.berlin.de&quot;</span>, .)</span></code></pre></div>
<p>Each yearly archive page contains several subpages for the reports in that year,
divided by pagination; to gather the links to all the subpages, we have to
understand how the pagination works. In this case, the URL for the yearly
archive is simply appended with the query “?page_at_1_0=” and a value indicating
the number of the subpage we want to access.
So “<a href="https://www.berlin.de/polizei/polizeimeldungen/archiv/2022/?page_at_1_0=5" class="uri">https://www.berlin.de/polizei/polizeimeldungen/archiv/2022/?page_at_1_0=5</a>”
for example gives access to the fifth page for 2022.</p>
<p>The number of police reports is not constant over the years; the number of
subpages per year will also differ. We do not know in advance, how many
subpages we will have to download, but we can scrape this information from the
last pagination link for each year. We are lucky, as the <code>&lt;a&gt;</code> tag for the last
subpage per year is a list item that can be identified by its two classes
<code>pager-item</code> and <code>last</code>. We parse the first page for each year, select
the <code>&lt;a&gt;</code> tag for the last subpage, extract the text from it and save it as a
number. Note that I also added a waiting time of two seconds between each
download, as shown in chapter <a href="goodpractice.html#goodpractice">9</a>.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="scraping.html#cb182-1" tabindex="-1"></a>max_pages <span class="ot">&lt;-</span> links <span class="sc">%&gt;%</span> </span>
<span id="cb182-2"><a href="scraping.html#cb182-2" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> {</span>
<span id="cb182-3"><a href="scraping.html#cb182-3" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb182-4"><a href="scraping.html#cb182-4" tabindex="-1"></a>    <span class="fu">read_html</span>(.x)</span>
<span id="cb182-5"><a href="scraping.html#cb182-5" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb182-6"><a href="scraping.html#cb182-6" tabindex="-1"></a>  <span class="fu">map</span>(html_element, <span class="at">css =</span> <span class="st">&quot;li.pager-item.last &gt; a&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb182-7"><a href="scraping.html#cb182-7" tabindex="-1"></a>  <span class="fu">map</span>(html_text) <span class="sc">%&gt;%</span> </span>
<span id="cb182-8"><a href="scraping.html#cb182-8" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span></code></pre></div>
<p>Now we can construct the links to all subpages; done by nesting two <em>for loops</em>
in the script. For this to be understandable, we should have a brief look on for
loops.</p>
<p>Like <code>map()</code>, for loops are used for iteration. We can use them to repeat one or
multiple commands for a fixed number of times. The following <strong>non-runable</strong>
code block, shows the basic for loop syntax.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="scraping.html#cb183-1" tabindex="-1"></a><span class="cf">for</span> (variable <span class="cf">in</span> vector) {</span>
<span id="cb183-2"><a href="scraping.html#cb183-2" tabindex="-1"></a>  Code</span>
<span id="cb183-3"><a href="scraping.html#cb183-3" tabindex="-1"></a>}</span></code></pre></div>
<p>We will replace <code>variable</code> with a name for our counter. Per convention lower
case letters are used, typically <code>i</code>. In <code>vector</code> we will define the values the
counter will take. If we define the vector <code>1:5</code>, the counter will take on the
value <code>1</code> in the first loop, <code>2</code> in the second and so on. After the loop runs
with the value <code>5</code>, it ends. The values in vector do not have to be ascending
numbers though. We could also use a numeric vector like <code>c(4, 8, 15, 16, 23, 42)</code>,
a character vector like <code>c("a", "s", "d", "f)</code>, or any other vector.</p>
<p>Between the <code>{}</code> brackets, we write the commands that shall be executed in each
iteration. The important thing is, that we can use the value the counter takes
in each iteration. For example, the following code prints the value of <code>i</code> for
each iteration into the console:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="scraping.html#cb184-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb184-2"><a href="scraping.html#cb184-2" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb184-3"><a href="scraping.html#cb184-3" tabindex="-1"></a>}</span>
<span id="cb184-4"><a href="scraping.html#cb184-4" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb184-5"><a href="scraping.html#cb184-5" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb184-6"><a href="scraping.html#cb184-6" tabindex="-1"></a><span class="do">## [1] 3</span></span>
<span id="cb184-7"><a href="scraping.html#cb184-7" tabindex="-1"></a><span class="do">## [1] 4</span></span>
<span id="cb184-8"><a href="scraping.html#cb184-8" tabindex="-1"></a><span class="do">## [1] 5</span></span></code></pre></div>
<p>For loops can also be nested. Then, the <em>inner loop</em> iterates completely for
each iteration of the <em>outer loop</em>. In the following example, the inner loop
iterates three times for each of the two iterations of the outer loop. So we
get six iterations in total. Note, that inner and outer loop have to have different
<code>variable</code> names for this to work. The <code>paste()</code> function in <code>print()</code> is used to
combine the values of <code>i</code> and <code>j</code> seperated by a <code>-</code> and print this combination
into the console, so we can see exactly in which order the iterations occur.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="scraping.html#cb185-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb185-2"><a href="scraping.html#cb185-2" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb185-3"><a href="scraping.html#cb185-3" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(i, j, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>))</span>
<span id="cb185-4"><a href="scraping.html#cb185-4" tabindex="-1"></a>  }</span>
<span id="cb185-5"><a href="scraping.html#cb185-5" tabindex="-1"></a>}</span>
<span id="cb185-6"><a href="scraping.html#cb185-6" tabindex="-1"></a><span class="do">## [1] &quot;1-1&quot;</span></span>
<span id="cb185-7"><a href="scraping.html#cb185-7" tabindex="-1"></a><span class="do">## [1] &quot;1-2&quot;</span></span>
<span id="cb185-8"><a href="scraping.html#cb185-8" tabindex="-1"></a><span class="do">## [1] &quot;1-3&quot;</span></span>
<span id="cb185-9"><a href="scraping.html#cb185-9" tabindex="-1"></a><span class="do">## [1] &quot;2-1&quot;</span></span>
<span id="cb185-10"><a href="scraping.html#cb185-10" tabindex="-1"></a><span class="do">## [1] &quot;2-2&quot;</span></span>
<span id="cb185-11"><a href="scraping.html#cb185-11" tabindex="-1"></a><span class="do">## [1] &quot;2-3&quot;</span></span></code></pre></div>
<p>With this knowledge, we can construct a nested for loop that builds a vector of
the links to all subpages for all years.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="scraping.html#cb186-1" tabindex="-1"></a>pag_links <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb186-2"><a href="scraping.html#cb186-2" tabindex="-1"></a></span>
<span id="cb186-3"><a href="scraping.html#cb186-3" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(links)) {</span>
<span id="cb186-4"><a href="scraping.html#cb186-4" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>max_pages[i]) {</span>
<span id="cb186-5"><a href="scraping.html#cb186-5" tabindex="-1"></a>    pag_links <span class="ot">&lt;-</span> <span class="fu">append</span>(pag_links, <span class="at">values =</span> <span class="fu">str_c</span>(links[i], <span class="st">&quot;?page_at_1_0=&quot;</span>, j))</span>
<span id="cb186-6"><a href="scraping.html#cb186-6" tabindex="-1"></a>  }</span>
<span id="cb186-7"><a href="scraping.html#cb186-7" tabindex="-1"></a>}</span></code></pre></div>
<p>The outer loop is a counter for the elements in the objects <code>links</code>; in this
case the loop counts from 1 to 9, one step for each yearly archive page. For
each of these iterations, the inner loop will count from 1 to the number of
the last subpage for this year, which we assigned to the vector <code>max_pages</code>.
Using subsetting with <code>max_pages[i]</code>, we select the correct number of subpages
for each year, i.e. each iteration of the outer loop.
Using both counters together, we can construct the links to the subpages using
<code>str_c()</code>. The function takes the link to a yearly archive indicated by the
counter in the outer loop <code>i</code>, appends “?page_at_1_0=” and after this the value
of the inner loop counter <code>j</code>, i.e. the subpages (1, 2, …, j) for this year.
The resulting link is then added to the vector
<code>pag_links</code> using the function <code>append()</code> which adds the data indicated by the
argument <code>values</code> to the object specified in the first argument. For this to
work, we first have to initialise the object as an empty object outside of the
loop. Here I created it as an empty character vector, using
<code>pag_links &lt;- character()</code>. If you want to create an empty object without any
data type assigned, you can also use <code>empty_vector &lt;- NULL</code>.</p>
</div>
<div id="downloading-the-subpages" class="section level3 hasAnchor" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Downloading the subpages<a href="scraping.html#downloading-the-subpages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that the links to all subpages are gathered, we can finally download
them. Please note that the download will take up to 20 minutes due to the number
of subpages (443 at the time of writing), and the additional waiting time of 2
seconds between each iteration.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="scraping.html#cb187-1" tabindex="-1"></a>pages <span class="ot">&lt;-</span> pag_links <span class="sc">%&gt;%</span> </span>
<span id="cb187-2"><a href="scraping.html#cb187-2" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> {</span>
<span id="cb187-3"><a href="scraping.html#cb187-3" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb187-4"><a href="scraping.html#cb187-4" tabindex="-1"></a>    <span class="fu">read_html</span>(.x)</span>
<span id="cb187-5"><a href="scraping.html#cb187-5" tabindex="-1"></a>  })</span></code></pre></div>
</div>
<div id="extracting-the-data-of-interest" class="section level3 hasAnchor" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> Extracting the data of interest<a href="scraping.html#extracting-the-data-of-interest" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The goal is to extract the text of the report, the date/time and the district
the report refers to. Looking into the source code, we find that all reports are
list items in an unordered list. Conveniently for us, all data fields we are
interested in have distinct classes we can use in scraping. Date and time are
enclosed by a <code>&lt;div&gt;</code> tag with the classes <code>cell</code>, <code>nowrap</code> and <code>date</code>. The
report headline is also part of a <code>&lt;div&gt;</code>. Here the classes are <code>cell</code> and
<code>text</code>. The same <code>&lt;div&gt;</code> also includes the district’s name, but we can discern
between the two. The text is included in a <code>&lt;a&gt;</code> tag, that is a child of the
<code>&lt;div&gt;</code> and the district is part of a <code>&lt;span&gt;</code> with the class <code>category</code>, which
is also a child of the <code>&lt;div&gt;</code>. We can use this information to construct
appropriate CSS selectors like this:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="scraping.html#cb188-1" tabindex="-1"></a>reports <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb188-2"><a href="scraping.html#cb188-2" tabindex="-1"></a>  <span class="at">Date =</span> pages <span class="sc">%&gt;%</span> </span>
<span id="cb188-3"><a href="scraping.html#cb188-3" tabindex="-1"></a>    <span class="fu">map</span>(html_elements, <span class="at">css =</span> <span class="st">&quot;div.cell.nowrap.date&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb188-4"><a href="scraping.html#cb188-4" tabindex="-1"></a>    <span class="fu">map</span>(html_text) <span class="sc">%&gt;%</span> </span>
<span id="cb188-5"><a href="scraping.html#cb188-5" tabindex="-1"></a>    <span class="fu">unlist</span>(),</span>
<span id="cb188-6"><a href="scraping.html#cb188-6" tabindex="-1"></a>  <span class="at">Report =</span> pages <span class="sc">%&gt;%</span> </span>
<span id="cb188-7"><a href="scraping.html#cb188-7" tabindex="-1"></a>    <span class="fu">map</span>(html_elements, <span class="at">css =</span> <span class="st">&quot;div.cell.text &gt; a&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb188-8"><a href="scraping.html#cb188-8" tabindex="-1"></a>    <span class="fu">map</span>(html_text) <span class="sc">%&gt;%</span> </span>
<span id="cb188-9"><a href="scraping.html#cb188-9" tabindex="-1"></a>    <span class="fu">unlist</span>(),</span>
<span id="cb188-10"><a href="scraping.html#cb188-10" tabindex="-1"></a>  <span class="at">District =</span> pages <span class="sc">%&gt;%</span> </span>
<span id="cb188-11"><a href="scraping.html#cb188-11" tabindex="-1"></a>    <span class="fu">map</span>(html_elements, <span class="at">css =</span> <span class="st">&quot;div.cell.text &gt; span.category&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb188-12"><a href="scraping.html#cb188-12" tabindex="-1"></a>    <span class="fu">map</span>(html_text) <span class="sc">%&gt;%</span> </span>
<span id="cb188-13"><a href="scraping.html#cb188-13" tabindex="-1"></a>    <span class="fu">unlist</span>()</span>
<span id="cb188-14"><a href="scraping.html#cb188-14" tabindex="-1"></a>)</span>
<span id="cb188-15"><a href="scraping.html#cb188-15" tabindex="-1"></a><span class="do">## Error in `tibble()`:</span></span>
<span id="cb188-16"><a href="scraping.html#cb188-16" tabindex="-1"></a><span class="do">## ! Tibble columns must have compatible</span></span>
<span id="cb188-17"><a href="scraping.html#cb188-17" tabindex="-1"></a><span class="do">##   sizes.</span></span>
<span id="cb188-18"><a href="scraping.html#cb188-18" tabindex="-1"></a><span class="do">## • Size 21952: Existing data.</span></span>
<span id="cb188-19"><a href="scraping.html#cb188-19" tabindex="-1"></a><span class="do">## • Size 21525: Column `District`.</span></span>
<span id="cb188-20"><a href="scraping.html#cb188-20" tabindex="-1"></a><span class="do">## ℹ Only values of size one are recycled.</span></span></code></pre></div>
<p>That did not work. But why? Let us look at the error message we received. It
informs us that the column “District” we tried to create, is shorter in length
compared to the other two. Since we can not create tibbles out of columns with
different lengths, we get this error.</p>
<p>The fact that the “District” column is shorter than the other two, must mean
that there are police reports where the information on the district is not
listed on the website, which we can confirm by browsing some of the subpages,
e.g.
<a href="https://www.berlin.de/polizei/polizeimeldungen/archiv/2014/" target="_blank">https://www.berlin.de/polizei/polizeimeldungen/archiv/2014/</a>.</p>
<div id="dealing-with-missing-data-in-lists" class="section level4 hasAnchor" number="10.2.3.1">
<h4><span class="header-section-number">10.2.3.1</span> Dealing with missing data in lists<a href="scraping.html#dealing-with-missing-data-in-lists" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Some of the <code>&lt;span&gt;</code> tags that contain the district are missing. Using the
approach presented above, <code>html_elements()</code> just extracts the <code>&lt;span&gt;</code> tags that
are present. We tell R that we do want all <code>&lt;span&gt;</code> tags of the class
“category”, and this is what R returns to us. For list items where the tag is
missing, nothing is returned. But this is not what we want; what we actually want is,
that R looks at every single police report and saves its text, date and time, as
well as the district, if it is not missing. If it is missing, we want R to save
a <code>NA</code> in the cell of the tibble, the representation of missing values in R.</p>
<p>The <code>&lt;div&gt;</code> and <code>&lt;span&gt;</code> tags that contain the data of interest are nested in
<code>&lt;li&gt;</code> tags in this case. The <code>&lt;li&gt;</code> tags thus contain the whole set of data,
the text, the date/time and the district. The approach here is to make R examine
every single <code>&lt;li&gt;</code> tag and extract the data that is present, as well as save an
<code>NA</code> for every piece of data that is missing.</p>
<p>To start, we have to extract all the <code>&lt;li&gt;</code> tags and their content from the
subpages. Right now, the subpages are saved in the object <code>pages</code>. We use a for
loop that takes every element of <code>pages</code>, extracts all the <code>&lt;li&gt;</code> tags from it
and adds them to a new list using <code>append()</code>. Note, that we have to use
<code>pages[[]]</code> to subset the list of subpages, as we want to access the actual list
elements, i.e. the node sets for the sub pages. As with tibbles, <code>pages[]</code> would
always return another list. The <code>&lt;li&gt;</code> tags are all children
of an <code>&lt;ul&gt;</code> with the class <code>list--tablelist</code>, which we can use in our selector.
<code>append()</code> takes an existing object as its first argument and adds the data
indicated in the <code>values =</code> argument to it. For this to work, we have to
initiate the new list as an empty object before the loop starts.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="scraping.html#cb189-1" tabindex="-1"></a>list_items <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb189-2"><a href="scraping.html#cb189-2" tabindex="-1"></a></span>
<span id="cb189-3"><a href="scraping.html#cb189-3" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pages)) {</span>
<span id="cb189-4"><a href="scraping.html#cb189-4" tabindex="-1"></a>  list_items <span class="ot">&lt;-</span> <span class="fu">append</span>(list_items, <span class="at">values =</span> <span class="fu">html_elements</span>(pages[[i]], <span class="at">css =</span> <span class="st">&quot;ul.list--tablelist &gt; li&quot;</span>))</span>
<span id="cb189-5"><a href="scraping.html#cb189-5" tabindex="-1"></a>}</span></code></pre></div>
<p>The newly created list <code>list_items</code> contains a node set for each <code>&lt;li&gt;</code> tag from
all subpages. Again, we have to use double brackets to access the node set.
With single brackets a new list containing the node set as its first element is
returned, as illustrated here:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="scraping.html#cb190-1" tabindex="-1"></a>list_items[[<span class="dv">1</span>]]</span>
<span id="cb190-2"><a href="scraping.html#cb190-2" tabindex="-1"></a><span class="do">## {html_node}</span></span>
<span id="cb190-3"><a href="scraping.html#cb190-3" tabindex="-1"></a><span class="do">## &lt;li&gt;</span></span>
<span id="cb190-4"><a href="scraping.html#cb190-4" tabindex="-1"></a><span class="do">## [1] &lt;div class=&quot;cell nowrap date&quot;&gt;16.10.2023 17:55 Uhr&lt;/div&gt;\n</span></span>
<span id="cb190-5"><a href="scraping.html#cb190-5" tabindex="-1"></a><span class="do">## [2] &lt;div class=&quot;cell text&quot;&gt;\n&lt;a href=&quot;/polizei/polizeimeldungen/2023/pressemi ...</span></span>
<span id="cb190-6"><a href="scraping.html#cb190-6" tabindex="-1"></a></span>
<span id="cb190-7"><a href="scraping.html#cb190-7" tabindex="-1"></a>list_items[<span class="dv">1</span>]</span>
<span id="cb190-8"><a href="scraping.html#cb190-8" tabindex="-1"></a><span class="do">## [[1]]</span></span>
<span id="cb190-9"><a href="scraping.html#cb190-9" tabindex="-1"></a><span class="do">## {html_node}</span></span>
<span id="cb190-10"><a href="scraping.html#cb190-10" tabindex="-1"></a><span class="do">## &lt;li&gt;</span></span>
<span id="cb190-11"><a href="scraping.html#cb190-11" tabindex="-1"></a><span class="do">## [1] &lt;div class=&quot;cell nowrap date&quot;&gt;16.10.2023 17:55 Uhr&lt;/div&gt;\n</span></span>
<span id="cb190-12"><a href="scraping.html#cb190-12" tabindex="-1"></a><span class="do">## [2] &lt;div class=&quot;cell text&quot;&gt;\n&lt;a href=&quot;/polizei/polizeimeldungen/2023/pressemi ...</span></span></code></pre></div>
<p>We can now make R examine every element of this list one after the other and
extract all the data they contain. But what happens when we try to extract a
element that is not present in one of the elements? R returns an <code>NA</code>:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="scraping.html#cb191-1" tabindex="-1"></a><span class="fu">html_element</span>(list_items[[<span class="dv">1</span>]], <span class="at">css =</span> <span class="st">&quot;span.notthere&quot;</span>)</span>
<span id="cb191-2"><a href="scraping.html#cb191-2" tabindex="-1"></a><span class="do">## {xml_missing}</span></span>
<span id="cb191-3"><a href="scraping.html#cb191-3" tabindex="-1"></a><span class="do">## &lt;NA&gt;</span></span></code></pre></div>
<p>Using a for loop that iterates over the elements in <code>list_items</code>, we write a
tibble row by row, filling the data cells with the extracted information and
with <code>NA</code> if a element could not be found for this element of <code>list_items</code>. We have
to initiate the tibble before the for loop starts: we define the column names,
the type of data to be saved and also the length of the columns. The
latter is not strictly necessary as we could also have created a tibble with a
column length of <span class="math inline">\(0\)</span>, but pre-defining their length increases computational
efficiency. Still, the for loop has to iterate over several thousand elements
and extract the data contained, which will take several minutes to complete.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="scraping.html#cb192-1" tabindex="-1"></a>reports <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb192-2"><a href="scraping.html#cb192-2" tabindex="-1"></a>  <span class="at">Date =</span> <span class="fu">character</span>()[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_items)],</span>
<span id="cb192-3"><a href="scraping.html#cb192-3" tabindex="-1"></a>  <span class="at">Report =</span> <span class="fu">character</span>()[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_items)],</span>
<span id="cb192-4"><a href="scraping.html#cb192-4" tabindex="-1"></a>  <span class="at">District =</span> <span class="fu">character</span>()[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_items)]</span>
<span id="cb192-5"><a href="scraping.html#cb192-5" tabindex="-1"></a>)</span>
<span id="cb192-6"><a href="scraping.html#cb192-6" tabindex="-1"></a></span>
<span id="cb192-7"><a href="scraping.html#cb192-7" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_items)) {</span>
<span id="cb192-8"><a href="scraping.html#cb192-8" tabindex="-1"></a>  reports[i, <span class="st">&quot;Date&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">html_element</span>(list_items[[i]], <span class="at">css =</span> <span class="st">&quot;div.cell.nowrap.date&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb192-9"><a href="scraping.html#cb192-9" tabindex="-1"></a>    <span class="fu">html_text</span>()</span>
<span id="cb192-10"><a href="scraping.html#cb192-10" tabindex="-1"></a>  reports[i, <span class="st">&quot;Report&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">html_element</span>(list_items[[i]], <span class="at">css =</span> <span class="st">&quot;div.cell.text &gt; a&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb192-11"><a href="scraping.html#cb192-11" tabindex="-1"></a>    <span class="fu">html_text</span>()</span>
<span id="cb192-12"><a href="scraping.html#cb192-12" tabindex="-1"></a>  reports[i, <span class="st">&quot;District&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">html_element</span>(list_items[[i]], <span class="at">css =</span> <span class="st">&quot;div.cell.text &gt; span.category&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb192-13"><a href="scraping.html#cb192-13" tabindex="-1"></a>    <span class="fu">html_text</span>()</span>
<span id="cb192-14"><a href="scraping.html#cb192-14" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s look at the tibble we just constructed:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="scraping.html#cb193-1" tabindex="-1"></a>reports</span>
<span id="cb193-2"><a href="scraping.html#cb193-2" tabindex="-1"></a><span class="do">## # A tibble: 21,952 × 3</span></span>
<span id="cb193-3"><a href="scraping.html#cb193-3" tabindex="-1"></a><span class="do">##    Date                 Report                                          District</span></span>
<span id="cb193-4"><a href="scraping.html#cb193-4" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                &lt;chr&gt;                                           &lt;chr&gt;   </span></span>
<span id="cb193-5"><a href="scraping.html#cb193-5" tabindex="-1"></a><span class="do">##  1 16.10.2023 17:55 Uhr Verdacht eines Tötungsdeliktes - Mordkommissio… Ereigni…</span></span>
<span id="cb193-6"><a href="scraping.html#cb193-6" tabindex="-1"></a><span class="do">##  2 16.10.2023 17:49 Uhr Gefährliche Körperverletzung durch Schuss - Du… Ereigni…</span></span>
<span id="cb193-7"><a href="scraping.html#cb193-7" tabindex="-1"></a><span class="do">##  3 16.10.2023 14:43 Uhr Vorkommnisse im Zusammenhang mit dem Nahost-Ko… Ereigni…</span></span>
<span id="cb193-8"><a href="scraping.html#cb193-8" tabindex="-1"></a><span class="do">##  4 16.10.2023 11:26 Uhr Festnahme nach räuberischem Diebstahl           Ereigni…</span></span>
<span id="cb193-9"><a href="scraping.html#cb193-9" tabindex="-1"></a><span class="do">##  5 16.10.2023 10:07 Uhr Verletzte Radfahrerin in Krankenhaus verstorben Ereigni…</span></span>
<span id="cb193-10"><a href="scraping.html#cb193-10" tabindex="-1"></a><span class="do">##  6 16.10.2023 09:53 Uhr Brandstiftung an mehreren Fahrzeugen            Ereigni…</span></span>
<span id="cb193-11"><a href="scraping.html#cb193-11" tabindex="-1"></a><span class="do">##  7 15.10.2023 21:07 Uhr Verkehrsunfall mit Sonder- und Wegerechten      Ereigni…</span></span>
<span id="cb193-12"><a href="scraping.html#cb193-12" tabindex="-1"></a><span class="do">##  8 15.10.2023 15:46 Uhr Raub im Juweliergeschäft                        Ereigni…</span></span>
<span id="cb193-13"><a href="scraping.html#cb193-13" tabindex="-1"></a><span class="do">##  9 15.10.2023 14:59 Uhr Einkaufswagen aus Hochhaus geworfen - Mordkomm… Ereigni…</span></span>
<span id="cb193-14"><a href="scraping.html#cb193-14" tabindex="-1"></a><span class="do">## 10 15.10.2023 14:47 Uhr Vorkommnisse im Zusammenhang mit den weltweite… Ereigni…</span></span>
<span id="cb193-15"><a href="scraping.html#cb193-15" tabindex="-1"></a><span class="do">## # ℹ 21,942 more rows</span></span></code></pre></div>
<p>This looks good, but we should also confirm, that <code>NA</code>s were handled correctly.
We can examine the entry for “31.12.2014 13:21 Uhr” that we saw on
<a href="https://www.berlin.de/polizei/polizeimeldungen/archiv/2014/" target="_blank">https://www.berlin.de/polizei/polizeimeldungen/archiv/2014/</a>,
and for which the district was missing. We can use subsetting to just look at
this one observation in our tibble. Remembet that when subsetting two
dimensional objects like tibbles, we have to supply an index for the row(s) as
well as for the column(s) we want to subset. Our goal is, to subset the row for which the
column “Date” holds the value “31.12.2014 13:21 Uhr”. We can thus write our row
index as <code>reports$Date == "31.12.2014 13:21 Uhr"</code>, which reads as:
<em>the row(s) for which the value of the column “Date” in the object “reports” is equal to “31.12.2014 13:21 Uhr”</em>.
As we want to see all columns for this observation, we do not need to supply a
column index. By writing nothing after the <code>,</code> we instruct R to show us all
columns.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="scraping.html#cb194-1" tabindex="-1"></a>reports[reports<span class="sc">$</span>Date <span class="sc">==</span> <span class="st">&quot;31.12.2014 13:21 Uhr&quot;</span>, ]</span>
<span id="cb194-2"><a href="scraping.html#cb194-2" tabindex="-1"></a><span class="do">## # A tibble: 1 × 3</span></span>
<span id="cb194-3"><a href="scraping.html#cb194-3" tabindex="-1"></a><span class="do">##   Date                 Report                                           District</span></span>
<span id="cb194-4"><a href="scraping.html#cb194-4" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                &lt;chr&gt;                                            &lt;chr&gt;   </span></span>
<span id="cb194-5"><a href="scraping.html#cb194-5" tabindex="-1"></a><span class="do">## 1 31.12.2014 13:21 Uhr Alkoholisiert geflüchtet und die Kontrolle verl… &lt;NA&gt;</span></span></code></pre></div>
<p>This also looks good. We now have extracted the data we need to answer our
questions.</p>
</div>
</div>
<div id="saving-the-data" class="section level3 hasAnchor" number="10.2.4">
<h3><span class="header-section-number">10.2.4</span> Saving the data<a href="scraping.html#saving-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As discussed in chapter <a href="files.html#files">8</a>, we save the scraped data at this point.
You have seen that we downloaded a lot of subpages, which took a considerable
amount of time; if we repeat this for every instance of further data analysis,
we create a lot of unnecessary traffic and waste a lot of our own time.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="scraping.html#cb195-1" tabindex="-1"></a><span class="fu">save</span>(reports, <span class="at">file =</span> <span class="st">&quot;reports.RData&quot;</span>)</span></code></pre></div>
<p>In the next chapter we will continue with cleaning the data, transforming it and
calculating some descriptive statistics on it.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="goodpractice.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dplyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/webscraping-tures/webscraping-tures.github.io/10-rvest4.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
